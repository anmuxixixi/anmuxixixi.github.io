<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>äºŒã€è¯­è¨€åŠå…¶æ–‡æ³•</title>
    <link href="/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/"/>
    <url>/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="äºŒã€è¯­è¨€åŠæ–‡æ³•"><a href="#äºŒã€è¯­è¨€åŠæ–‡æ³•" class="headerlink" title="äºŒã€è¯­è¨€åŠæ–‡æ³•"></a>äºŒã€è¯­è¨€åŠæ–‡æ³•</h1><h2 id="1-å­—æ¯è¡¨"><a href="#1-å­—æ¯è¡¨" class="headerlink" title="1.å­—æ¯è¡¨"></a>1.å­—æ¯è¡¨</h2><p>å­—æ¯è¡¨Î£æ˜¯ä¸€ä¸ªæœ‰ç©·ç¬¦å·é›†åˆï¼›è¿™é‡Œçš„ç¬¦å·å¯ä»¥æ˜¯å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·â€¦â€¦ä¸‹é¢çš„ä¾‹å­éƒ½æ˜¯å­—æ¯è¡¨</p><ul><li>äºŒè¿›åˆ¶å­—æ¯è¡¨ï¼š{0,1}</li><li>ASCIIå­—ç¬¦é›†</li><li>Unicodeå­—ç¬¦é›†</li></ul><p>å­—æ¯è¡¨æœ‰ä¸‹é¢å‡ ç§è¿ç®—ï¼š</p><ul><li>ä¹˜ç§¯</li></ul><img src="/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/image-20230302235051480.png" alt="image-20230302235051480" style="zoom:50%;"><ul><li>næ¬¡å¹‚</li></ul><img src="/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/image-20230302235116133.png" alt="image-20230302235116133" style="zoom:50%;"><ul><li>æ­£é—­åŒ…</li></ul><img src="/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/image-20230302235140690.png" alt="image-20230302235140690" style="zoom:50%;"><ul><li>å…‹æ—é—­åŒ…</li></ul><img src="/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/image-20230302235156202.png" alt="image-20230302235156202" style="zoom:50%;"><h2 id="2-ä¸²"><a href="#2-ä¸²" class="headerlink" title="2.ä¸²"></a>2.ä¸²</h2><img src="/2023/03/02/%E4%BA%8C%E3%80%81%E8%AF%AD%E8%A8%80%E5%8F%8A%E5%85%B6%E6%96%87%E6%B3%95/image-20230302235218276.png" alt="image-20230302235218276" style="zoom:80%;">]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ã€ç¼–è¯‘åŸç†ç»ªè®º</title>
    <link href="/2023/03/02/%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%BB%AA%E8%AE%BA/"/>
    <url>/2023/03/02/%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%BB%AA%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ç¼–è¯‘åŸç†ç»ªè®º"><a href="#ä¸€ã€ç¼–è¯‘åŸç†ç»ªè®º" class="headerlink" title="ä¸€ã€ç¼–è¯‘åŸç†ç»ªè®º"></a>ä¸€ã€ç¼–è¯‘åŸç†ç»ªè®º</h1><h2 id="1-ä»€ä¹ˆæ˜¯ç¼–è¯‘"><a href="#1-ä»€ä¹ˆæ˜¯ç¼–è¯‘" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ç¼–è¯‘"></a>1.ä»€ä¹ˆæ˜¯ç¼–è¯‘</h2><p>ğŸ«<strong>ç¼–è¯‘</strong>ï¼šå°†é«˜çº§è¯­è¨€ã€æºè¯­è¨€ã€‘ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€æˆ–æœºå™¨è¯­è¨€ã€ç›®æ ‡è¯­è¨€ã€‘çš„è¿‡ç¨‹</p><img src="/2023/03/02/%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%BB%AA%E8%AE%BA/image-20230302225554584.png" alt="image-20230302225554584" style="zoom:67%;"><p>æˆ‘ä»¬æŠŠCè¯­è¨€ä¸­çš„x &#x3D; 2ç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€<code>MOV X,2</code>ï¼Œæˆ–æ˜¯ç›´æ¥ç¼–è¯‘æˆæœºå™¨è¯­è¨€<code>C706 0000 0002</code></p><p><strong>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•´ä¸ªç¼–è¯‘çš„æµç¨‹ï¼š</strong></p><img src="/2023/03/02/%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%BB%AA%E8%AE%BA/image-20230302225855228.png" alt="image-20230302225855228" style="zoom: 67%;"><ul><li>é¢„å¤„ç†å™¨ï¼šæŠŠå­˜å‚¨åœ¨ä¸åŒæ–‡ä»¶ä¸­çš„æºç¨‹åºèšåˆåœ¨ä¸€èµ·ï¼›æŠŠè¢«ç§°ä¸ºå®çš„ç¼©å†™è¯­å¥è½¬æ¢ä¸ºåŸå§‹è¯­å¥</li><li>å¯é‡å®šä½çš„æœºå™¨ä»£ç ï¼šæ±‡ç¼–å™¨ç”Ÿæˆçš„å¯é‡å®šä½èµ·å§‹ä»£ç åœ¨å†…å­˜ä¸­å­˜æ”¾çš„èµ·å§‹ä½ç½®ä¸æ˜¯å›ºå®šçš„ï¼Œæ‰€æœ‰åœ°å€éƒ½æ˜¯ç›¸å¯¹äºèµ·å§‹ä½ç½®çš„ç›¸å¯¹åœ°å€</li><li>åŠ è½½å™¨ï¼šä¿®æ”¹å¯é‡å®šä½åœ°å€ï¼›å°†ä¿®æ”¹åçš„æŒ‡ä»¤å’Œæ•°æ®æ”¾åœ¨å†…å­˜ä¸­é€‚åˆçš„ä½ç½®</li><li>é“¾æ¥å™¨ï¼šå°†å¤šä¸ªå¯é‡å®šä½çš„æœºå™¨ä»£ç æ–‡ä»¶ï¼ˆåŒ…æ‹¬åº“æ–‡ä»¶ï¼‰è¿æ¥åˆ°ä¸€èµ·ï¼›è§£å†³å¤–éƒ¨å†…éƒ¨åœ°å€é—®é¢˜</li></ul><h2 id="2-ç¼–è¯‘å™¨çš„ç»“æ„"><a href="#2-ç¼–è¯‘å™¨çš„ç»“æ„" class="headerlink" title="2.ç¼–è¯‘å™¨çš„ç»“æ„"></a>2.ç¼–è¯‘å™¨çš„ç»“æ„</h2><img src="/2023/03/02/%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%BB%AA%E8%AE%BA/image-20230302230959458.png" alt="image-20230302230959458" style="zoom:67%;"><p>ç¼–è¯‘å™¨å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>å‰ç«¯éƒ¨åˆ†ï¼Œä¸æºè¯­è¨€ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯ä¸æˆ‘ä»¬å†™çš„é«˜çº§è¯­è¨€C&#x2F;Javaç­‰æœ‰å…³</p></li><li><p>åç«¯éƒ¨åˆ†ï¼Œä¸ç›®æ ‡è¯­è¨€ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆçš„ç›®æ ‡æœºå™¨è¯­è¨€</p></li><li><p>ä¸­é—´éƒ¨åˆ†ï¼šæœºå™¨æ— å…³ä»£ç ä¼˜åŒ–å™¨</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç¼–è¯‘åŸç†&amp;æ‰‹å†™Cè¯­è¨€ç¼–è¯‘å™¨</title>
    <link href="/2023/03/01/%E3%80%8A%E5%93%88%E5%B7%A5%E5%A4%A7%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/03/01/%E3%80%8A%E5%93%88%E5%B7%A5%E5%A4%A7%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ã€Šå“ˆå·¥å¤§ç¼–è¯‘åŸç†ã€‹å­¦ä¹ ç¬”è®°"><a href="#ã€Šå“ˆå·¥å¤§ç¼–è¯‘åŸç†ã€‹å­¦ä¹ ç¬”è®°" class="headerlink" title="ã€Šå“ˆå·¥å¤§ç¼–è¯‘åŸç†ã€‹å­¦ä¹ ç¬”è®°"></a>ã€Šå“ˆå·¥å¤§ç¼–è¯‘åŸç†ã€‹å­¦ä¹ ç¬”è®°</h1><blockquote><p>æœ¬ç³»åˆ—åšå®¢ä¸»è¦è®°å½•è‡ªå·±å­¦ä¹ ç¼–è¯‘åŸç†çš„ç¬”è®°ï¼Œå¹¶æ‰‹å†™ä¸€ä¸ªCè¯­è¨€ç¼–è¯‘å™¨</p><ul><li>â˜ƒï¸<strong>ç¼–è¯‘åŸç†å­¦ä¹ èµ„æ–™</strong>ï¼šå“ˆå·¥å¤§é™ˆé„è€å¸ˆçš„ã€Šç¼–è¯‘åŸç†ã€‹</li></ul></blockquote><ul><li>ç¬¬ä¸€ç« ï¼š<a href="https://anmuxixixi.github.io/2023/03/02/%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%BB%AA%E8%AE%BA/">ç¼–è¯‘åŸç†ç»ªè®º</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>kernelä¸‹è¾“å…¥è¾“å‡ºconsoleå¦‚ä½•å®ç°</title>
    <link href="/2023/02/25/kernel%E4%B8%8B%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BAconsole%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/"/>
    <url>/2023/02/25/kernel%E4%B8%8B%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BAconsole%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="kernelä¸‹è¾“å…¥è¾“å‡ºconsoleå¦‚ä½•å®ç°"><a href="#kernelä¸‹è¾“å…¥è¾“å‡ºconsoleå¦‚ä½•å®ç°" class="headerlink" title="kernelä¸‹è¾“å…¥è¾“å‡ºconsoleå¦‚ä½•å®ç°"></a>kernelä¸‹è¾“å…¥è¾“å‡ºconsoleå¦‚ä½•å®ç°</h1><blockquote><p>ğŸ›<strong>å¤§éƒ¨åˆ†å†…å®¹è½¬è½½è‡ª</strong>ï¼š</p><ul><li><a href="https://www.cnblogs.com/lifexy/p/7993136.html">https://www.cnblogs.com/lifexy/p/7993136.html</a></li><li><a href="https://blog.csdn.net/skyflying2012/article/details/41078349?spm=1001.2014.3001.5506">https://blog.csdn.net/skyflying2012/article/details/41078349?spm=1001.2014.3001.5506</a></li></ul></blockquote><h2 id="1-åœ¨é©±åŠ¨è°ƒè¯•ä¸­-ä½¿ç”¨printk-æ˜¯æœ€ç®€å•-æœ€æ–¹ä¾¿çš„åŠæ³•"><a href="#1-åœ¨é©±åŠ¨è°ƒè¯•ä¸­-ä½¿ç”¨printk-æ˜¯æœ€ç®€å•-æœ€æ–¹ä¾¿çš„åŠæ³•" class="headerlink" title="1.åœ¨é©±åŠ¨è°ƒè¯•ä¸­,ä½¿ç”¨printk(),æ˜¯æœ€ç®€å•,æœ€æ–¹ä¾¿çš„åŠæ³•"></a>1.åœ¨é©±åŠ¨è°ƒè¯•ä¸­,ä½¿ç”¨printk(),æ˜¯æœ€ç®€å•,æœ€æ–¹ä¾¿çš„åŠæ³•</h2><p>âœ¨<strong>å…ˆè¯´ç»“è®ºï¼Œå½“ubootå‘½ä»¤è¡Œä¸­è®¾ç½®ä¸åŒçš„consoleå‚æ•°ï¼Œè¾“å‡ºåˆ°çš„è®¾å¤‡ä¸åŒï¼š</strong></p><ul><li><p>å½“ubootçš„å‘½ä»¤è¡Œé‡Œçš„<strong>â€œconsole&#x3D;tty1â€</strong>æ—¶,è¡¨ç¤ºprintk()è¾“å‡ºåœ¨å¼€å‘æ¿çš„LCDå±ä¸Š</p></li><li><p>å½“ubootçš„å‘½ä»¤è¡Œé‡Œçš„<strong>â€œconsole&#x3D;ttySA0,115200â€</strong>æ—¶,è¡¨ç¤ºprintk()è¾“å‡ºåœ¨ä¸²å£UART0ä¸Š,æ³¢ç‰¹ç‡&#x3D;115200</p></li><li><p>å½“ubootçš„å‘½ä»¤è¡Œé‡Œçš„<strong>â€œconsole&#x3D;tty1 console&#x3D;ttySA0,115200â€</strong>æ—¶,è¡¨ç¤ºprintk()åŒæ—¶è¾“å‡ºåœ¨ä¸²å£ä¸Š,ä»¥åŠå¼€å‘æ¿çš„LCDå±ä¸Š</p></li></ul><p>å†…æ ¸åˆæ˜¯æ€ä¹ˆæ ¹æ®ä¸Šé¢å‘½ä»¤è¡Œå‚æ•°æ¥ç¡®å®šprintk()çš„è¾“å‡ºè®¾å¤‡ï¼Ÿ</p><h2 id="2-ä»¥console-ttySA0-115200ä¸ºä¾‹åˆ†æprintk"><a href="#2-ä»¥console-ttySA0-115200ä¸ºä¾‹åˆ†æprintk" class="headerlink" title="2.ä»¥console=ttySA0,115200ä¸ºä¾‹åˆ†æprintk"></a>2.ä»¥<code>console=ttySA0,115200</code>ä¸ºä¾‹åˆ†æprintk</h2><h3 id="2-1-å‘½ä»¤è¡Œæ¿€æ´»-setup"><a href="#2-1-å‘½ä»¤è¡Œæ¿€æ´»-setup" class="headerlink" title="2.1 å‘½ä»¤è¡Œæ¿€æ´»__setup"></a>2.1 å‘½ä»¤è¡Œæ¿€æ´»__setup</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel\printk\printk.c</span><br>__setup(<span class="hljs-string">&quot;console=&quot;</span>, console_setup);<br></code></pre></td></tr></table></figure><p>**__setup()**çš„ä½œç”¨å°±æ˜¯ï¼šè‹¥ubootä¼ é€’è¿›æ¥çš„å‘½ä»¤è¡Œå­—ç¬¦ä¸²é‡Œå«æœ‰â€œconsole&#x3D;â€,ä¾¿è°ƒç”¨console_setup()å‡½æ•°,å¹¶å¯¹â€œconsole&#x3D;â€åé¢å¸¦çš„å­—ç¬¦ä¸²â€ttySA0,115200â€è¿›è¡Œåˆ†æ</p><h3 id="2-2-è°ƒç”¨console-setupå‡½æ•°"><a href="#2-2-è°ƒç”¨console-setupå‡½æ•°" class="headerlink" title="2.2 è°ƒç”¨console_setupå‡½æ•°"></a>2.2 è°ƒç”¨console_setupå‡½æ•°</h3><p>æˆ‘ä»¬ä»¥ttySA0,115200ä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸ª<code>console_setup</code>å‡½æ•°ï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œç»“æ„ä½“å’Œæ•°ç»„åŒåï¼Œéƒ½æ˜¯<code>console_cmdline</code>ï¼ŒåŒºåˆ†ä¸€ä¸‹ğŸ–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CMDLINECONSOLES 8</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console_cmdline</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-type">char</span>name[<span class="hljs-number">16</span>];<span class="hljs-comment">/* Name of the driver    */</span><br><span class="hljs-type">int</span>    index;<span class="hljs-comment">/* Minor dev. to use    */</span><br><span class="hljs-type">char</span>*options;<span class="hljs-comment">/* Options for the driver   */</span><br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console_cmdline</span> <span class="hljs-title">console_cmdline</span>[<span class="hljs-title">MAX_CMDLINECONSOLES</span>];</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">console_setup</span><span class="hljs-params">(<span class="hljs-type">char</span> *str)</span>                    <span class="hljs-comment">//*str=&quot;ttySA0,115200&quot;</span><br>&#123;<br>    <span class="hljs-type">char</span> name[<span class="hljs-keyword">sizeof</span>(console_cmdline[<span class="hljs-number">0</span>].name)];     <span class="hljs-comment">// char name[16]</span><br>    <span class="hljs-type">char</span> *s, *options;<br>    <span class="hljs-type">int</span> idx; <br><br>    <span class="hljs-keyword">if</span> (str[<span class="hljs-number">0</span>] &gt;= <span class="hljs-string">&#x27;0&#x27;</span> &amp;&amp; str[<span class="hljs-number">0</span>] &lt;= <span class="hljs-string">&#x27;9&#x27;</span>) &#123;                    <br>            <span class="hljs-built_in">strcpy</span>(name, <span class="hljs-string">&quot;ttyS&quot;</span>);<br>            <span class="hljs-built_in">strncpy</span>(name + <span class="hljs-number">4</span>, str, <span class="hljs-keyword">sizeof</span>(name) - <span class="hljs-number">5</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">strncpy</span>(name, str, <span class="hljs-keyword">sizeof</span>(name) - <span class="hljs-number">1</span>);   <span class="hljs-comment">//*name=&quot;ttySA0,115200&quot;</span><br>    &#125;<br><br>    name[<span class="hljs-keyword">sizeof</span>(name) - <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;  <br>    <span class="hljs-keyword">if</span> ((options = <span class="hljs-built_in">strchr</span>(str, <span class="hljs-string">&#x27;,&#x27;</span>)) != <span class="hljs-literal">NULL</span>)   <span class="hljs-comment">// æ‰¾åˆ°&#x27;,&#x27;,è¿”å›ç»™options</span><br>            *(options++) = <span class="hljs-number">0</span>;                <span class="hljs-comment">//*options=&quot;115200&quot;</span><br><br><br>    <span class="hljs-keyword">for</span> (s = name; *s; s++)                                     <span class="hljs-comment">//*s=&quot;0&quot;</span><br>            <span class="hljs-keyword">if</span> ((*s &gt;= <span class="hljs-string">&#x27;0&#x27;</span> &amp;&amp; *s &lt;= <span class="hljs-string">&#x27;9&#x27;</span>) || *s == <span class="hljs-string">&#x27;,&#x27;</span>)<br>                    <span class="hljs-keyword">break</span>;<br><br>idx = simple_strtoul(s, <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>);   <span class="hljs-comment">//å’Œstrtoul()ä¸€æ ·,å°†sä¸­çš„&quot;0&quot;æå‡ºæ¥,æ‰€ä»¥idx=0</span><br>    *s = <span class="hljs-number">0</span>;<br><br>add_preferred_console(name, idx, options);      <br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä»£ç å’Œæ³¨é‡Šå¾—åˆ°ï¼Œæœ€ç»ˆè°ƒç”¨add_preferred_console(â€œttySAâ€, 0, â€œ115200â€)å‡½æ•°æ¥æ·»åŠ æ§åˆ¶å°</p><h3 id="2-3-è°ƒç”¨add-preferred-consoleå‡½æ•°"><a href="#2-3-è°ƒç”¨add-preferred-consoleå‡½æ•°" class="headerlink" title="2.3 è°ƒç”¨add_preferred_consoleå‡½æ•°"></a>2.3 è°ƒç”¨add_preferred_consoleå‡½æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">add_preferred_console</span><span class="hljs-params">(<span class="hljs-type">char</span> *name, <span class="hljs-type">int</span> idx, <span class="hljs-type">char</span> *options)</span><br>&#123;<br><span class="hljs-keyword">return</span> __add_preferred_console(name, idx, options, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __add_preferred_console(<span class="hljs-type">char</span> *name, <span class="hljs-type">int</span> idx, <span class="hljs-type">char</span> *options, <span class="hljs-type">char</span> *brl_options)<br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console_cmdline</span> *<span class="hljs-title">c</span>;</span><br><span class="hljs-type">int</span> i;<br><br>    <span class="hljs-comment">// MAX_CMDLINECONSOLES=8,è¡¨ç¤ºæœ€å¤šæ·»åŠ 8ä¸ªæ§åˆ¶å°</span><br>    <span class="hljs-comment">// è¿™æ˜¯ç›´æ¥å°†cæŒ‡å‘äº†å…¨å±€å˜é‡console_cmdline</span><br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, c = console_cmdline; i &lt; MAX_CMDLINECONSOLES &amp;&amp; c-&gt;name[<span class="hljs-number">0</span>]; i++, c++) &#123;<br>        <span class="hljs-comment">// è¯¥consoleåå­—å’Œä¸‹æ ‡å¥½å·²ç»å­˜åœ¨äº†ã€ç›®çš„æ˜¯ä¸ºäº†å»é‡ã€‘</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(c-&gt;name, name) == <span class="hljs-number">0</span> &amp;&amp; c-&gt;index == idx) &#123;<br><span class="hljs-keyword">if</span> (!brl_options)<br>selected_console = i;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>&#125;<br>    <br>    <span class="hljs-comment">// i == 8,è¡¨ç¤ºæ•°ç»„å­˜æ»¡äº†</span><br><span class="hljs-keyword">if</span> (i == MAX_CMDLINECONSOLES)<br><span class="hljs-keyword">return</span> -E2BIG;<br><span class="hljs-keyword">if</span> (!brl_options)<br>selected_console = i; <span class="hljs-comment">// å°†selected_consoleè®¾ç½®ä¸ºæœ€æ–°æ·»åŠ çš„console_cmdlineçš„ä¸‹æ ‡å·</span><br><br>strlcpy(c-&gt;name, name, <span class="hljs-keyword">sizeof</span>(c-&gt;name));<br>c-&gt;options = options;<br>braille_set_options(c, brl_options);<br><br>c-&gt;index = idx;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>__add_preferred_console</code>å°†name idx optionsä¿å­˜åˆ°æ•°ç»„ä¸‹ä¸€ä¸ªæˆå‘˜console_cmdlineç»“æ„ä½“ä¸­ï¼Œå¦‚æœæ•°ç»„ä¸­å·²æœ‰é‡åï¼Œåˆ™ä¸æ·»åŠ ï¼Œå¹¶ç½®selected_consoleä¸ºæœ€æ–°æ·»åŠ çš„console_cmdlineçš„ä¸‹æ ‡å·ã€‚</p><p>æ¯”å¦‚cmdlineä¸­æœ‰â€œconsole&#x3D;ttyS0,115200 console&#x3D;ttyS1,9600â€</p><p>åˆ™åœ¨console_cmdline[8]æ•°ç»„ä¸­console_cmdline[0]ä»£è¡¨ttyS0ï¼Œconsole_cmdline[1]ä»£è¡¨ttyS1ï¼Œè€Œselected_console&#x3D;1.</p><h3 id="2-4-kernelä¸‹å¦‚ä½•é€‰æ‹©printk-console"><a href="#2-4-kernelä¸‹å¦‚ä½•é€‰æ‹©printk-console" class="headerlink" title="2.4 kernelä¸‹å¦‚ä½•é€‰æ‹©printk console"></a>2.4 kernelä¸‹å¦‚ä½•é€‰æ‹©printk console</h3><p>æ ¹æ®<a href="https://anmuxixixi.github.io/2023/02/21/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91linux%E5%86%85%E6%A0%B8%E8%BE%93%E5%87%BA%E7%9A%84%E6%97%A5%E5%BF%97%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86/">printkçš„å®ç°åŸç†</a>ï¼Œprintkæœ€åè°ƒç”¨console_unlockå®ç°log_bufæ•°æ®åˆ·å‡ºåˆ°æŒ‡å®šè®¾å¤‡ã€‚</p><p>è¿™é‡Œå…ˆä¸å…³å¿ƒprintkå¦‚ä½•å¤„ç†log bufæ•°æ®(æ¯”å¦‚æ·»åŠ å†…å®¹çº§åˆ«)ï¼Œåªå…³å¿ƒprintkå¦‚ä½•ä¸€æ­¥æ­¥æ‰¾åˆ°æŒ‡å®šçš„è¾“å‡ºè®¾å¤‡ï¼Œæ ¹æ®printk.cä»£ç ï¼Œå¯ä»¥æ‰¾åˆ°å¦‚ä¸‹çº¿ç´¢ã€‚</p><p><strong>printk-&gt;vprintk-&gt;console_unlock-&gt;call_console_drivers</strong></p><p>çœ‹çº¿ç´¢æœ€åº•å±‚çš„call_console_drivers</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console</span> *<span class="hljs-title">console_drivers</span>;</span> <span class="hljs-comment">// å…¨å±€</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> for_each_console(con) \</span><br><span class="hljs-meta">for (con = console_drivers; con != NULL; con = con-&gt;next)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">call_console_drivers</span><span class="hljs-params">(<span class="hljs-type">int</span> level, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *text, <span class="hljs-type">size_t</span> len)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console</span> *<span class="hljs-title">con</span>;</span><br><br>trace_console(text, len);<br><br><span class="hljs-keyword">if</span> (level &gt;= console_loglevel &amp;&amp; !ignore_loglevel)<br><span class="hljs-keyword">return</span>;<br><span class="hljs-keyword">if</span> (!console_drivers)<br><span class="hljs-keyword">return</span>;<br><br>for_each_console(con) &#123;<br><span class="hljs-keyword">if</span> (exclusive_console &amp;&amp; con != exclusive_console)  <span class="hljs-comment">// å¦‚æœæŒ‡æ˜äº†å”¯ä¸€çš„consoleï¼Œä¸”å½“å‰ä¸æ˜¯é‚£ä¸ªconsole</span><br><span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">if</span> (!(con-&gt;flags &amp; CON_ENABLED))  <span class="hljs-comment">// å½“å‰çš„consoleä¸æ˜¯enabledçš„</span><br><span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">if</span> (!con-&gt;write)   <span class="hljs-comment">// å½“å‰consoleæ²¡æœ‰writeå‡½æ•°</span><br><span class="hljs-keyword">continue</span>;<br>con-&gt;write(con, text, len);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éå†console_driversé“¾è¡¨æ‰€æœ‰console structï¼Œè°ƒç”¨æ‰€æœ‰<u><strong>ENABLE</strong></u>çš„consoleçš„writeæ–¹æ³•å°†log bufä¸­startåˆ°endçš„å†…å®¹å‘å‡ºã€‚</p><blockquote><p>åˆ°è¿™é‡Œå°±å¾ˆæ˜äº†äº†ï¼Œkernelä¸‹æ¯æ¬¡printkæ‰“å°ï¼Œé¦–å…ˆå­˜log_bufï¼Œç„¶åéå†console_driversï¼Œæ‰¾åˆ°åˆé€‚consoleï¼Œåˆ·å‡ºlogã€‚</p><p>console_driversé“¾è¡¨çš„æˆå‘˜æ˜¯å“ªé‡Œæ¥çš„ï¼Œæ¥ç€æ¥çœ‹ä¸‹ä¸€éƒ¨åˆ†ï¼Œkernelä¸‹consoleçš„æ³¨å†Œ</p></blockquote><h3 id="2-5-consoleé©±åŠ¨æ³¨å†Œ"><a href="#2-5-consoleé©±åŠ¨æ³¨å†Œ" class="headerlink" title="2.5 consoleé©±åŠ¨æ³¨å†Œ"></a>2.5 consoleé©±åŠ¨æ³¨å†Œ</h3><p>æ¥ä¸‹æ¥æ¥æœç´¢è¯¥æ•°ç»„ï¼Œçœ‹çœ‹printk()å¦‚ä½•è°ƒç”¨æ§åˆ¶å°çš„ç¡¬ä»¶å¤„ç†å‡½æ•°çš„ã€‚æœç´¢åˆ°åœ¨<code>Printk.c</code>é‡Œçš„<code>register_console(struct console *console)</code>å‡½æ•°,æœ‰ç”¨åˆ°console_cmdline[]</p><p>æ˜¾ç„¶,register_console()å‡½æ•°å°±ç”¨æ¥æ³¨å†Œæ§åˆ¶å°çš„,ç»§ç»­æœç´¢register_console</p><img src="/2023/02/25/kernel%E4%B8%8B%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BAconsole%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/image-20230225225234632.png" alt="image-20230225225234632" style="zoom:67%;"><p>æˆ‘ä»¬ä»¥<code>drivers\tty\serial\serial_ks8695.c</code>ä¸ºä¾‹ï¼Œè¿›è¡Œåˆ†æ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">ks8695_console_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>add_preferred_console(SERIAL_KS8695_DEVNAME, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>register_console(&amp;ks8695_console);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>console_initcall(ks8695_console_init); <span class="hljs-comment">// å£°æ˜æ§åˆ¶å°åˆå§‹åŒ–å‡½æ•°</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢é€šè¿‡register_console()æ¥æ³¨å†Œ<code>ks8695_console</code>ç»“æ„ä½“,è¯¥ç»“æ„ä½“æˆå‘˜å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SERIAL_KS8695_DEVNAME<span class="hljs-string">&quot;ttyAM&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console</span> <span class="hljs-title">ks8695_console</span> =</span> &#123;<br>.name= SERIAL_KS8695_DEVNAME,  <span class="hljs-comment">// æ§åˆ¶å°åç§°</span><br>.write= ks8695_console_write,   <span class="hljs-comment">// æ‰“å°ä¸²å£æ•°æ®çš„ç¡¬ä»¶å¤„ç†å‡½æ•°</span><br>.device= uart_console_device,    <span class="hljs-comment">// ttyé©±åŠ¨</span><br>.setup= ks8695_console_setup,   <span class="hljs-comment">// ç”¨æ¥è®¾ç½®UARTçš„æ³¢ç‰¹ç‡ï¼Œå‘é€ï¼Œæ¥æ”¶ç­‰åŠŸèƒ½</span><br>.flags= CON_PRINTBUFFER,        <span class="hljs-comment">// æ ‡å¿—ä½</span><br>.index= <span class="hljs-number">-1</span>,                     <span class="hljs-comment">// ç´¢å¼•</span><br>.data= &amp;ks8695_reg,            <span class="hljs-comment">// å¯„å­˜å™¨</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨register_console()é‡Œï¼Œä¾¿ä¼šé€šè¿‡<code>ttyAM</code>æ¥åŒ¹é…console_cmdline[i]çš„åç§°,å½“åŒ¹é…æˆåŠŸï¼Œprintk()è°ƒç”¨çš„consoleç»“æ„ä½“ä¾¿æ˜¯ks8695_consoleäº†</p><p>â˜ƒï¸å½“é©±åŠ¨åŠ è½½çš„æ—¶å€™ï¼Œä¼šèµ°åˆ°MODULE_INITï¼Œç„¶åèµ°åˆ°å¯¹åº”é©±åŠ¨æ³¨å†Œçš„initå‡½æ•°ä¸­ï¼Œåœ¨è¿™é‡Œå°±æ˜¯<code>ks8695_console_init</code>ï¼Œç´§æ¥ç€ä¼šè°ƒç”¨<code>register_console</code>ï¼Œè¿™é‡Œçš„register_consoleå°±æ˜¯<code>printk.c</code>ä¸­çš„register_consoleã€‚</p><hr><p>å› æ­¤æˆ‘ä»¬æ¥çœ‹ä¸‹printk.cä¸­çš„register_console</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">register_console</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> console *newcon)</span><br>&#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">console</span> *<span class="hljs-title">bcon</span> =</span> <span class="hljs-literal">NULL</span>;<br> <br>    <span class="hljs-comment">//å¦‚æœæ³¨å†Œçš„æ˜¯bootconsoleï¼ˆkernelæ—©æœŸå¯åŠ¨æ‰“å°ï¼‰ï¼Œéœ€è¦æ£€æŸ¥console_driversä¸­</span><br>    <span class="hljs-comment">//æ²¡æœ‰â€œreal consoleâ€ä¹Ÿå°±æ˜¯è¯´bootconsoleå¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªæ³¨å†Œçš„consoleã€‚</span><br>    <span class="hljs-keyword">if</span> (console_drivers &amp;&amp; newcon-&gt;flags &amp; CON_BOOT) &#123;<br>        <span class="hljs-comment">/* find the last or real console */</span><br>        for_each_console(bcon) &#123;<br>            <span class="hljs-keyword">if</span> (!(bcon-&gt;flags &amp; CON_BOOT)) &#123;<br>                printk(KERN_INFO <span class="hljs-string">&quot;Too late to register bootconsole %s%d\n&quot;</span>,<br>                    newcon-&gt;name, newcon-&gt;index);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-keyword">if</span> (console_drivers &amp;&amp; console_drivers-&gt;flags &amp; CON_BOOT)<br>        bcon = console_drivers;<br> <br>    <span class="hljs-comment">//preferred consoleä¸ºconsole_cmdlineä¸­æœ€åä¸€ä¸ªconsole</span><br>    <span class="hljs-keyword">if</span> (preferred_console &lt; <span class="hljs-number">0</span> || bcon || !console_drivers)<br>        preferred_console = selected_console;<br> <br>    <span class="hljs-keyword">if</span> (newcon-&gt;early_setup)<br>        newcon-&gt;early_setup();<br> <br>    <span class="hljs-keyword">if</span> (preferred_console &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> (newcon-&gt;index &lt; <span class="hljs-number">0</span>)<br>            newcon-&gt;index = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (newcon-&gt;setup == <span class="hljs-literal">NULL</span> ||<br>            newcon-&gt;setup(newcon, <span class="hljs-literal">NULL</span>) == <span class="hljs-number">0</span>) &#123;<br>            newcon-&gt;flags |= CON_ENABLED;<br>            <span class="hljs-keyword">if</span> (newcon-&gt;device) &#123;<br>                newcon-&gt;flags |= CON_CONSDEV;<br>                preferred_console = <span class="hljs-number">0</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">//æ£€æŸ¥newconæ˜¯å¦æ˜¯cmdlineæŒ‡å®šçš„consoleï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä½¿èƒ½(CON_ENABLE)å¹¶åˆå§‹åŒ–è¯¥console</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAX_CMDLINECONSOLES &amp;&amp; console_cmdline[i].name[<span class="hljs-number">0</span>];<br>            i++) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(console_cmdline[i].name, newcon-&gt;name) != <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">continue</span>;<br>        <span class="hljs-keyword">if</span> (newcon-&gt;index &gt;= <span class="hljs-number">0</span> &amp;&amp;<br>            newcon-&gt;index != console_cmdline[i].index)<br>            <span class="hljs-keyword">continue</span>;<br>        <span class="hljs-keyword">if</span> (newcon-&gt;index &lt; <span class="hljs-number">0</span>)<br>            newcon-&gt;index = console_cmdline[i].index;<br>        <span class="hljs-keyword">if</span> (newcon-&gt;setup &amp;&amp;<br>            newcon-&gt;setup(newcon, console_cmdline[i].options) != <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        newcon-&gt;flags |= CON_ENABLED;<br>        newcon-&gt;index = console_cmdline[i].index;<br>        <span class="hljs-keyword">if</span> (i == selected_console) &#123;<br>            <span class="hljs-comment">//å¦‚æœnewconæ˜¯cmdlineæŒ‡å®šçš„æœ€æ–°çš„consoleï¼Œåˆ™ç½®ä½CONSDEV</span><br>            newcon-&gt;flags |= CON_CONSDEV;<br>            preferred_console = selected_console;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br> <br>    <span class="hljs-comment">//è¯¥consoleæ²¡æœ‰ä½¿èƒ½ï¼Œé€€å‡º</span><br>    <span class="hljs-keyword">if</span> (!(newcon-&gt;flags &amp; CON_ENABLED))<br>        <span class="hljs-keyword">return</span>;<br> <br>    <span class="hljs-comment">//å¦‚æœæœ‰bootconsoleï¼Œåˆ™newconä¸éœ€è¦è¾“å‡ºregisterä¹‹å‰çš„logï¼Œå› ä¸ºå¦‚æœbootconsoleå’Œnewconæ˜¯åŒä¸€ä¸ªè®¾å¤‡</span><br>    <span class="hljs-comment">//åˆ™ä¹‹å‰çš„logå°±è¾“å‡º2æ¬¡</span><br>    <span class="hljs-keyword">if</span> (bcon &amp;&amp; ((newcon-&gt;flags &amp; (CON_CONSDEV | CON_BOOT)) == CON_CONSDEV))<br>        newcon-&gt;flags &amp;= ~CON_PRINTBUFFER;<br> <br>    <span class="hljs-comment">//æŠŠnewconåŠ å…¥console_driversé“¾è¡¨ï¼Œå¯¹äºç½®ä½CON_CONSDEVçš„conï¼Œæ”¾åœ¨é“¾è¡¨é¦–</span><br>    console_lock();<br>    <span class="hljs-keyword">if</span> ((newcon-&gt;flags &amp; CON_CONSDEV) || console_drivers == <span class="hljs-literal">NULL</span>) &#123;<br>        newcon-&gt;next = console_drivers;<br>        console_drivers = newcon;<br>        <span class="hljs-keyword">if</span> (newcon-&gt;next)<br>            newcon-&gt;next-&gt;flags &amp;= ~CON_CONSDEV;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        newcon-&gt;next = console_drivers-&gt;next;<br>        console_drivers-&gt;next = newcon;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (newcon-&gt;flags &amp; CON_PRINTBUFFER) &#123;<br>        <span class="hljs-comment">//å¦‚æœnewconç½®ä½PRINTBUFFER,åˆ™å°†logå…¨éƒ¨åˆ·å‡º</span><br>        raw_spin_lock_irqsave(&amp;logbuf_lock, flags);<br>        con_start = log_start;<br>        raw_spin_unlock_irqrestore(&amp;logbuf_lock, flags);<br>        <span class="hljs-comment">//ä¿®æ”¹printkè¾“å‡ºçš„æŒ‡å®šå”¯ä¸€exclusive_consoleä¸ºnewcon</span><br>        <span class="hljs-comment">//ä¿è¯å°†ä¹‹å‰çš„logåªè¾“å‡ºåˆ°newcon</span><br>        exclusive_console = newcon;<br>    &#125;<br>    <span class="hljs-comment">//è§£é”consoleï¼Œåˆ·å‡ºlogåˆ°newcon</span><br>    console_unlock();<br>    console_sysfs_notify();<br> <br>    <span class="hljs-comment">//å¦‚æœæœ‰bootconsoleï¼Œåˆ™unregister bootconsoleï¼ˆä»console_driversä¸­åˆ æ‰ï¼‰</span><br>    <span class="hljs-comment">//å¹¶å‘Šè¯‰ä½¿ç”¨è€…ç°åœ¨consoleåˆ‡æ¢</span><br>    <span class="hljs-keyword">if</span> (bcon &amp;&amp;<br>        ((newcon-&gt;flags &amp; (CON_CONSDEV | CON_BOOT)) == CON_CONSDEV) &amp;&amp;<br>        !keep_bootcon) &#123;<br>        printk(KERN_INFO <span class="hljs-string">&quot;console [%s%d] enabled, bootconsole disabled\n&quot;</span>,<br>            newcon-&gt;name, newcon-&gt;index);<br>        for_each_console(bcon)<br>            <span class="hljs-keyword">if</span> (bcon-&gt;flags &amp; CON_BOOT)<br>                unregister_console(bcon);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        printk(KERN_INFO <span class="hljs-string">&quot;%sconsole [%s%d] enabled\n&quot;</span>,<br>            (newcon-&gt;flags &amp; CON_BOOT) ? <span class="hljs-string">&quot;boot&quot;</span> : <span class="hljs-string">&quot;&quot;</span> ,<br>            newcon-&gt;name, newcon-&gt;index);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¹‹å‰æ³¨å†Œäº†bootconsoleï¼Œåˆ™ä¸ä¼šå°†è¯¥æ¬¡registerä¹‹å‰çš„logåˆ·å‡ºï¼Œé˜²æ­¢bootconsoleå’Œè¯¥æ¬¡æ³¨å†Œçš„newconæ˜¯åŒä¸€ä¸ªç‰©ç†è®¾å¤‡æ—¶ï¼Œlogæ‰“å°2æ¬¡ã€‚</p><p>å¦‚æœæ²¡æœ‰bootconsoleï¼Œåˆ™ä¼šæŒ‡å®šexclusive_console&#x3D;newconï¼Œconsole_unlockæ—¶ï¼Œåˆ·æ–°å…¨éƒ¨logåˆ°è¯¥æŒ‡å®šexclusive consoleã€‚</p><p>console_unlockç»“æŸæ—¶ä¼šå°†exclusive_consoleç½®NULLï¼Œæ‰€ä»¥exclusive consoleé»˜è®¤æƒ…å†µä¸‹å°±æ˜¯NULLã€‚</p><p>æœ€åä¼šunregister bootconsoleï¼Œæ˜¯å°†bootconsoleä»console_driversä¸­åˆ é™¤ï¼Œè¿™æ ·ä¹‹åçš„printkå°±ä¸ä¼šå‘bootconsoleè¾“å‡ºäº†ã€‚</p><p>æœ‰æ„æ€çš„ä¸€ä¸ªåœ°æ–¹æ˜¯ï¼Œåœ¨unregister bootconsoleä¹‹å‰çš„printkï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">printk(KERN_INFO <span class="hljs-string">&quot;console [%s%d] enabled, bootconsole disabled\n&quot;</span>,<br>            newcon-&gt;name, newcon-&gt;index);<br></code></pre></td></tr></table></figure><p><u>å› ä¸ºæ­¤æ—¶bootconsoleè¿˜æ²¡åˆ æ‰ï¼Œè€Œnewconsoleå·²ç»åŠ å…¥console_driversï¼Œå¦‚æœbootconsoleå’Œnewconsoleæ˜¯åŒä¸€ä¸ªç‰©ç†è®¾å¤‡ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™å¥printkä¼šå‡ºç°2æ¬¡å“¦ï¼</u></p><p>å¦‚æœåœ¨cmdlineæŒ‡å®š2ä¸ªI&#x2F;Oè®¾å¤‡ï¼Œå¦‚<code>&quot;console==ttyS0,115200 console=ttyS1,115200&quot;</code>ï¼Œå› ttySè®¾å¤‡éƒ½æ˜¯serial driverä¸­æ³¨å†Œçš„real consoleï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°kernelçš„æ‰“å°åˆ†åˆ«å‡ºç°åœ¨2ä¸ªä¸²å£ä¸Šï¼</p><p><u><strong>boot console</strong>å’Œ<strong>real console</strong>å·®åˆ«åœ¨äºbootconsoleæ³¨å†Œäºkernelå¯åŠ¨æ—©æœŸï¼Œæ–¹ä¾¿å¯¹äºkernelæ—©æœŸå¯åŠ¨è¿›è¡Œè°ƒè¯•æ‰“å°ã€‚</u></p><p>é‚£è¿™äº›consoleæ˜¯åœ¨å“ªé‡Œè°ƒç”¨register_consoleè¿›è¡Œæ³¨å†Œçš„ï¼Ÿ</p><ul><li><p>bootconsoleçš„æ³¨å†Œï¼Œå¦‚arch&#x2F;arm&#x2F;kernel&#x2F;early_printk.cï¼Œæ˜¯åœ¨parse_argså‚æ•°è§£æé˜¶æ®µæ³¨å†Œbootconsoleã€‚</p><ul><li>åœ¨start_kernelä¸­console_initå‡½æ•°ä¹Ÿä¼šéå†.con_initcall.initæ®µä¸­æ‰€æœ‰æ³¨å†Œå‡½æ•°ï¼Œè€Œè¿™äº›æ³¨å†Œå‡½æ•°ä¹Ÿå¯ä»¥æ¥æ³¨å†Œbootconsoleã€‚</li><li>.con_initcall.initæ®µä¸­å‡½æ•°çš„æ³¨å†Œå¯ä»¥ä½¿ç”¨å®å®šä¹‰console_initcallã€‚è¿™äº›å‡½æ•°ä¸­è°ƒç”¨register_consoleï¼Œæ–¹ä¾¿åœ¨kernelåˆæœŸå®ç°printkæ‰“å°ã€‚</li></ul></li><li><p>realconsoleçš„æ³¨å†Œï¼Œæ˜¯åœ¨å„ä¸ªdriverï¼Œå¦‚serialåŠ è½½æ—¶å®Œæˆã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linuxå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€è½¬è½½ã€‘linuxå†…æ ¸è¾“å‡ºçš„æ—¥å¿—å»å“ªé‡Œäº†</title>
    <link href="/2023/02/21/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91linux%E5%86%85%E6%A0%B8%E8%BE%93%E5%87%BA%E7%9A%84%E6%97%A5%E5%BF%97%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86/"/>
    <url>/2023/02/21/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91linux%E5%86%85%E6%A0%B8%E8%BE%93%E5%87%BA%E7%9A%84%E6%97%A5%E5%BF%97%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86/</url>
    
    <content type="html"><![CDATA[<h1 id="linuxå†…æ ¸è¾“å‡ºçš„æ—¥å¿—å»å“ªé‡Œäº†"><a href="#linuxå†…æ ¸è¾“å‡ºçš„æ—¥å¿—å»å“ªé‡Œäº†" class="headerlink" title="linuxå†…æ ¸è¾“å‡ºçš„æ—¥å¿—å»å“ªé‡Œäº†"></a>linuxå†…æ ¸è¾“å‡ºçš„æ—¥å¿—å»å“ªé‡Œäº†</h1><blockquote><p>ğŸ•è½¬è½½è‡ªï¼š<a href="https://mp.weixin.qq.com/s/mdDLw6AIp9ws9LTaHg64pg">https://mp.weixin.qq.com/s/mdDLw6AIp9ws9LTaHg64pg</a></p><p>ğŸ¥¯æ„Ÿè°¢å¤§ä½¬ç²¾å½©çš„æ–‡ç« ï¼ï¼ï¼</p></blockquote><p><img src="/2023/02/21/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91linux%E5%86%85%E6%A0%B8%E8%BE%93%E5%87%BA%E7%9A%84%E6%97%A5%E5%BF%97%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86/image-20230221230542976.png" alt="image-20230221230542976">æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™å¼ å›¾ï¼Œæ¥ç†è§£printkçš„æ•´ä½“æ¶æ„ã€‚</p><h2 id="1-printkå®ç°ç®€è¿°"><a href="#1-printkå®ç°ç®€è¿°" class="headerlink" title="1.printkå®ç°ç®€è¿°"></a>1.printkå®ç°ç®€è¿°</h2><h3 id="1-1-å†…æ ¸æ€printk"><a href="#1-1-å†…æ ¸æ€printk" class="headerlink" title="1.1 å†…æ ¸æ€printk"></a>1.1 å†…æ ¸æ€printk</h3><p>åœ¨å†…æ ¸ç¼–ç æ—¶ï¼Œå¦‚æœæƒ³è¦è¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œé€šå¸¸å¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨printkï¼Œè€Œæ˜¯ä¼šä½¿ç”¨å…¶è¡ç”Ÿå‡½æ•°ï¼Œæ¯”å¦‚ pr_err &#x2F; pr_info &#x2F; pr_debug ç­‰ï¼Œè¿™äº›è¡ç”Ÿå‡½æ•°é™„å¸¦äº†æ—¥å¿—çº§åˆ«ã€æ‰€å±æ¨¡å—ç­‰å…¶ä»–ä¿¡æ¯ï¼Œæ¯”è¾ƒå‹å¥½ï¼Œä½†å…¶æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†printkã€‚</p><p>printkå‡½æ•°ä¼šå°†æ¯æ¬¡è¾“å‡ºçš„æ—¥å¿—ï¼Œæ”¾åˆ°å†…æ ¸ä¸ºå…¶ä¸“é—¨åˆ†é…çš„åä¸º<strong>ring buffer</strong>çš„ä¸€ä¸ªæ§½ä½é‡Œã€‚</p><ul><li><p>ring bufferå…¶å®å°±æ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„ç¯å½¢é˜Ÿåˆ—ï¼Œä¸è¿‡æ—¢ç„¶æ˜¯ç¯å½¢é˜Ÿåˆ—ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³å½“ring bufferæ»¡äº†çš„æ—¶å€™ï¼Œä¸‹ä¸€æ¡æ–°çš„æ—¥å¿—ï¼Œä¼šè¦†ç›–æœ€å¼€å§‹çš„æ—§çš„æ—¥å¿—ã€‚</p></li><li><p>ring bufferçš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å†…æ ¸å‚æ•°æ¥ä¿®æ”¹ã€‚</p></li><li><p>printkåœ¨å°†æ—¥å¿—æ”¾åˆ°ring bufferåï¼Œä¼šå†è°ƒç”¨ç³»ç»Ÿconsoleçš„ç›¸å…³æ–¹æ³•ï¼Œå°†è¿˜æœªè¾“å‡ºåˆ°ç³»ç»Ÿæ§åˆ¶å°çš„æ¶ˆæ¯ï¼Œç»§ç»­è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¿™ä¸ªåé¢ä¼šè¯¦ç»†è¯´ï¼Œè¿™é‡Œå°±æš‚ä¸èµ˜è¿°ã€‚</p></li></ul><p>ä»¥ä¸Šå°±æ˜¯printkåœ¨å†…æ ¸æ€çš„å®ç°ã€‚</p><h3 id="1-2-ç”¨æˆ·æ€printk"><a href="#1-2-ç”¨æˆ·æ€printk" class="headerlink" title="1.2 ç”¨æˆ·æ€printk"></a>1.2 ç”¨æˆ·æ€printk</h3><p>åœ¨ç”¨æˆ·æ€ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªæ–¹å¼ï¼Œå¯ä»¥æŸ¥çœ‹printkè¾“å‡ºçš„å†…æ ¸æ—¥å¿—ï¼Œæ¯”å¦‚ä½¿ç”¨dmesgå‘½ä»¤ï¼Œcat &#x2F;proc&#x2F;kmsgæ–‡ä»¶ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨klogctlå‡½æ•°ç­‰ï¼Œè¿™äº›æ–¹å¼åˆ†åˆ«å¯¹åº”äºå…¨æ™¯å›¾ä¸­ç”¨æˆ·æ€çš„æ©™è‰²ã€ç»¿è‰²ã€å’Œè“è‰²çš„éƒ¨åˆ†ã€‚</p><p><strong>ï¼ˆ1ï¼‰dmesgå‘½ä»¤</strong></p><p><strong>dmesgå‘½ä»¤ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯é€šè¿‡è¯»å–&#x2F;dev&#x2F;kmsgæ–‡ä»¶</strong>ï¼Œæ¥å®ç°æŸ¥çœ‹å†…æ ¸æ—¥å¿—çš„ã€‚</p><p>å½“è¯¥å‘½ä»¤è¿è¡Œæ—¶ï¼Œdmesgä¼šå…ˆè°ƒç”¨openå‡½æ•°ï¼Œæ‰“å¼€&#x2F;dev&#x2F;kmsgæ–‡ä»¶ï¼Œè¯¥æ‰“å¼€æ“ä½œåœ¨å†…æ ¸ä¸­çš„é€»è¾‘ï¼Œä¼šä¸ºdmesgåˆ†é…ä¸€ä¸ªfileå®ä¾‹ï¼Œåœ¨è¿™ä¸ªfileå®ä¾‹é‡Œï¼Œä¼šæœ‰ä¸€ä¸ªseqå˜é‡ï¼Œè¯¥å˜é‡è®°å½•ç€ä¸‹ä¸€æ¡è¦è¯»å–çš„å†…æ ¸æ—¥å¿—åœ¨ring bufferä¸­çš„ä½ç½®ã€‚</p><p>åˆšæ‰“å¼€&#x2F;dev&#x2F;kmsgæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªseqæŒ‡å‘çš„å°±æ˜¯ring bufferä¸­æœ€å¼€å§‹çš„é‚£æ¡æ—¥å¿—ã€‚</p><p>ä¹‹åï¼Œdmesgä¼šä»¥æ‰“å¼€çš„&#x2F;dev&#x2F;kmsgæ–‡ä»¶ä¸ºåª’ä»‹ï¼Œä¸æ–­çš„è°ƒç”¨readå‡½æ•°ï¼Œä»å†…æ ¸ä¸­è¯»å–æ—¥å¿—æ¶ˆæ¯ï¼Œæ¯è¯»å–å‡ºä¸€æ¡ï¼Œseqçš„å€¼éƒ½ä¼šåŠ ä¸€ï¼Œå³æŒ‡å‘ä¸‹ä¸€æ¡æ—¥å¿—çš„ä½ç½®ï¼Œä¾æ¬¡å¾€å¤ï¼Œç›´åˆ°æ‰€æœ‰çš„å†…æ ¸æ—¥å¿—è¯»å–å®Œæ¯•ï¼Œdmesgé€€å‡ºã€‚</p><p>ä»¥ä¸Šå°±æ˜¯dmesgçš„ä¸»ä½“å®ç°ã€‚</p><p><strong>ï¼ˆ2ï¼‰cat &#x2F;proc&#x2F;kmsg å‘½ä»¤</strong></p><p>ç¬¬äºŒç§æŸ¥çœ‹å†…æ ¸æ—¥å¿—çš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡ cat &#x2F;proc&#x2F;kmsg å‘½ä»¤ã€‚</p><p>è¯¥å‘½ä»¤å’Œdmesgå‘½ä»¤çš„å®ç°æœºåˆ¶åŸºæœ¬ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡è¯»æ–‡ä»¶ï¼Œåªä¸è¿‡catè¯»å–çš„æ˜¯&#x2F;proc&#x2F;kmsgæ–‡ä»¶ï¼Œè€Œdmesgè¯»å–çš„æ˜¯&#x2F;dev&#x2F;kmsgæ–‡ä»¶ã€‚</p><p>è¯»å–è¿™ä¸¤ä¸ªæ–‡ä»¶æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼Œ&#x2F;dev&#x2F;kmsgæ–‡ä»¶æ¯æ¬¡æ‰“å¼€æ—¶ï¼Œå†…æ ¸éƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªå•ç‹¬çš„seqå˜é‡ï¼Œè€Œ&#x2F;proc&#x2F;kmsgæ–‡ä»¶æ¯æ¬¡æ‰“å¼€æ—¶ï¼Œç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå…¨å±€çš„é™æ€seqå˜é‡ï¼Œå«åšsyslog_seqã€‚</p><p>syslog_seqæŒ‡å‘çš„ä¹Ÿæ˜¯ä¸‹ä¸€æ¡è¦è¯»å–çš„å†…æ ¸æ—¥å¿—åœ¨ring bufferä¸­çš„ä½ç½®ï¼Œä½†å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå…¨å±€çš„é™æ€å˜é‡ï¼Œå½“æœ‰å¤šä¸ªè¿›ç¨‹è¦è¯»å–&#x2F;proc&#x2F;kmsgæ–‡ä»¶æ—¶ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œå³å†…æ ¸æ—¥å¿—ä¼šè¢«è¿™å‡ ä¸ªè¿›ç¨‹éšæœºæŠ¢å è¯»å–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªè¿›ç¨‹è¯»åˆ°çš„éƒ½æ˜¯æ•´ä¸ªå†…æ ¸æ—¥å¿—çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸å®Œæ•´çš„ï¼Œè¿™ä¹Ÿæ˜¯dmesgå‘½ä»¤é»˜è®¤ä¸ä½¿ç”¨&#x2F;proc&#x2F;kmsgæ–‡ä»¶çš„åŸå› ã€‚</p><p><strong>ï¼ˆ3ï¼‰klogctlå‡½æ•°</strong></p><p>ç¬¬ä¸‰ç§æŸ¥çœ‹å†…æ ¸æ—¥å¿—çš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡klogctlå‡½æ•°ã€‚</p><p>è¯¥å‡½æ•°æ˜¯glibcå¯¹syslogç³»ç»Ÿè°ƒç”¨çš„ä¸€ä¸ªç®€å•å°è£…ï¼Œå…¶å…·ä½“ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒå…¨æ™¯å›¾ä¸­ç”¨æˆ·æ€çš„è“è‰²éƒ¨åˆ†ã€‚</p><p>klogctlå‡½æ•°å¯ä»¥æŒ‡å®šå¾ˆå¤šå‘½ä»¤ï¼Œåœ¨ä¸Šå›¾çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯SYSLOG_ACTION_READå‘½ä»¤ï¼Œä»¥æ­¤æ¥æ¨¡æ‹Ÿ cat &#x2F;proc&#x2F;kmsg è¡Œä¸ºã€‚</p><p>å…¶å®åœ¨å†…æ ¸å±‚é¢ï¼Œcat &#x2F;proc&#x2F;kmsgå‘½ä»¤ï¼Œä½¿ç”¨çš„å°±æ˜¯klogctlå¯¹åº”çš„syslogç³»ç»Ÿè°ƒç”¨çš„SYSLOG_ACTION_READå‘½ä»¤çš„å¤„ç†é€»è¾‘ï¼Œæ‰€ä»¥ç¤ºä¾‹ä¸­çš„klogctlå‡½æ•°ç›¸å…³ä»£ç ï¼Œå’Œ cat &#x2F;proc&#x2F;kmsg å‘½ä»¤å…¶å®æ˜¯ç­‰ä»·çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œklogctlå‡½æ•°åœ¨å†…æ ¸é‡Œä½¿ç”¨çš„ä¹Ÿæ˜¯syslog_seqå˜é‡ï¼Œå®ƒä¹Ÿæœ‰å’Œ&#x2F;proc&#x2F;kmsgæ–‡ä»¶åŒæ ·çš„é—®é¢˜ã€‚</p><p><strong>ï¼ˆ4ï¼‰ç³»ç»Ÿæ§åˆ¶å°</strong></p><p>å…¶å®è¿˜æœ‰ä¸€ç§æ–¹å¼å¯ä»¥æŸ¥çœ‹å†…æ ¸æ—¥å¿—ï¼Œå°±æ˜¯é€šè¿‡ç³»ç»Ÿæ§åˆ¶å°ã€‚</p><p>ä½†è¿™ç§æ–¹å¼å’Œå‰é¢è®²çš„ä¸‰ç§æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯å®Œå…¨è¢«åŠ¨çš„ï¼Œæ˜¯å†…æ ¸åœ¨è°ƒç”¨printkå‡½æ•°ï¼Œå°†æ—¥å¿—ä¿¡æ¯æ”¾åˆ°ring bufferåï¼Œå†å»é€šçŸ¥ç³»ç»Ÿæ§åˆ¶å°ï¼Œå‘ŠçŸ¥å…¶å¯ä»¥è¾“å‡ºè¿™äº›æ—¥å¿—ã€‚</p><p>ç³»ç»Ÿæ§åˆ¶å°ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªconsole_seqå˜é‡ï¼Œè®°å½•ä¸‹ä¸€æ¡è¦è¾“å‡ºå†…æ ¸æ—¥å¿—çš„æ‰€åœ¨ä½ç½®ã€‚</p><p>ç³»ç»Ÿæ§åˆ¶å°è¾“å‡ºçš„å†…å®¹ï¼Œæ˜¯è¢«æ—¥å¿—çº§åˆ«è¿‡æ»¤è¿‡çš„ï¼Œå†…æ ¸é»˜è®¤çš„æ—¥å¿—è¿‡æ»¤çº§åˆ«æ˜¯7ï¼Œå³debugçº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—ï¼Œæ¯”å¦‚info &#x2F; err ç­‰ï¼Œè¿™äº›éƒ½ä¼šè¾“å‡ºï¼Œä½†debugçº§åˆ«ä¸ä¼šè¾“å‡ºã€‚</p><p>è¯¥æ—¥å¿—è¿‡æ»¤çº§åˆ«ï¼Œå¯ä»¥é€šè¿‡å¾ˆå¤šæ–¹å¼æ”¹å˜ï¼Œæ¯”å¦‚è¯´ï¼Œå¯ä»¥é€šè¿‡å†…æ ¸å‚æ•° loglevelï¼Œæ‰€ä»¥ï¼Œå¦‚æœå‘ç°ç³»ç»Ÿæ§åˆ¶å°æ²¡æœ‰è¾“å‡ºæƒ³è¦çš„æ—¥å¿—ä¿¡æ¯ï¼Œå…ˆçœ‹ä¸‹å…¶æ˜¯å¦è¢«è¿‡æ»¤æ‰äº†ã€‚</p><h2 id="2-kernelæ—¥å¿—è°ƒè¯•è®¾ç½®"><a href="#2-kernelæ—¥å¿—è°ƒè¯•è®¾ç½®" class="headerlink" title="2.kernelæ—¥å¿—è°ƒè¯•è®¾ç½®"></a>2.kernelæ—¥å¿—è°ƒè¯•è®¾ç½®</h2><h3 id="2-1-æŸ¥çœ‹æ—¥å¿—çº§åˆ«"><a href="#2-1-æŸ¥çœ‹æ—¥å¿—çº§åˆ«" class="headerlink" title="2.1 æŸ¥çœ‹æ—¥å¿—çº§åˆ«"></a>2.1 æŸ¥çœ‹æ—¥å¿—çº§åˆ«</h3><p>è¾“å…¥<code>cat proc/sys/kernel/printk</code></p><p>è¿™å››ä¸ªæ•°å­—ä¾æ¬¡å¯¹åº” console_loglevelï¼Œdefault_message_loglevelï¼Œminimum_console_loglevelï¼Œdefault_console_loglevelã€‚</p><ul><li><p><strong>console_loglevelï¼š</strong>æ§åˆ¶å°ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ï¼›</p></li><li><p><strong>default_message_loglevelï¼š</strong>è°ƒç”¨ printk() æœªæŒ‡å®šæ—¥å¿—çº§åˆ«æ—¶ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ï¼›</p></li><li><p><strong>minimum_console_loglevelï¼š</strong>å…è®¸è®¾ç½®çš„æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼ˆconsole_loglevelï¼‰æœ€å°å€¼ï¼›</p></li><li><p><strong>default_console_loglevelï¼š</strong>ç³»ç»Ÿå¯åŠ¨æ—¶ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ã€‚</p></li></ul><h3 id="2-2-ä¿®æ”¹kernelæ—¥å¿—çº§åˆ«"><a href="#2-2-ä¿®æ”¹kernelæ—¥å¿—çº§åˆ«" class="headerlink" title="2.2 ä¿®æ”¹kernelæ—¥å¿—çº§åˆ«"></a>2.2 ä¿®æ”¹kernelæ—¥å¿—çº§åˆ«</h3><p>ï¼ˆ1ï¼‰æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯ï¼š<code>echo xxx &gt; proc/sys/kernel/printk</code>ï¼Œå…¶ä½™æ–¹å¼å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_34597963/article/details/128669281">https://blog.csdn.net/qq_34597963/article/details/128669281</a></p><p>æ—¥å¿—çº§åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_EMERG      KERN_SOH <span class="hljs-string">&quot;0&quot;</span>    /* system is unusable */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_ALERT      KERN_SOH <span class="hljs-string">&quot;1&quot;</span>    /* action must be taken immediately */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_CRIT       KERN_SOH <span class="hljs-string">&quot;2&quot;</span>    /* critical conditions */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_ERR        KERN_SOH <span class="hljs-string">&quot;3&quot;</span>    /* error conditions */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_WARNING    KERN_SOH <span class="hljs-string">&quot;4&quot;</span>    /* warning conditions */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_NOTICE     KERN_SOH <span class="hljs-string">&quot;5&quot;</span>    /* normal but significant condition */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_INFO       KERN_SOH <span class="hljs-string">&quot;6&quot;</span>    /* informational */</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">define KERN_DEBUG      KERN_SOH <span class="hljs-string">&quot;7&quot;</span>    /* debug-level messages */</span><br><br>-----------------<br><br>è‡´å‘½çº§(KERN_EMESG),<br>è­¦æˆ’çº§(KERN_ALERT),<br>ä¸´ç•Œçº§(KERN_CRIT),<br>é”™è¯¯çº§(KERN_ERR),<br>å‘Šè­¦çº§(KERN_WARN)<br>æ³¨æ„çº§(KERN_NOTICE),<br>é€šçŸ¥çº§(KERN_INFO),<br>è°ƒè¯•çº§(KERN_DEBUG).<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰åœ¨kernelä¸­ä¿®æ”¹logé»˜è®¤ç­‰çº§</p><p>æ‰¾åˆ°<code>/include/linux/printk.h</code>ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªå‡½æ•°ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title function_">console_verbose</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">console_loglevel = CONSOLE_LOGLEVEL_MIN; <span class="hljs-comment">//CONSOLE_LOGLEVEL_MOTORMOUTH;</span><br></code></pre></td></tr></table></figure><h3 id="2-3-Android-Initè¿›ç¨‹æ—¥å¿—æ‰“å°ä¸å…¨"><a href="#2-3-Android-Initè¿›ç¨‹æ—¥å¿—æ‰“å°ä¸å…¨" class="headerlink" title="2.3 Android Initè¿›ç¨‹æ—¥å¿—æ‰“å°ä¸å…¨"></a>2.3 Android Initè¿›ç¨‹æ—¥å¿—æ‰“å°ä¸å…¨</h3><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/superlee1125/article/details/114099144?spm=1001.2014.3001.5506">https://blog.csdn.net/superlee1125/article/details/114099144?spm=1001.2014.3001.5506</a></p></blockquote><p>åœ¨æŠ“Androidå†…æ ¸çš„logæ—¶ï¼Œinitè¿›ç¨‹çš„logå¾€å¾€æ‰“å°ä¸å…¨ï¼Œè¿™æ˜¯å› ä¸ºå†…æ ¸é™åˆ¶äº†logçš„è¾“å‡ºï¼Œåœ¨å†…æ ¸ä»£ç ä¸­æ‰¾åˆ°ä¸‹é¢çš„æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§ä¸‹é¢çš„æç¤ºæŠŠä»£ç æ³¨é‡Šæ‰ï¼Œç„¶åé‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œå†åˆ·åˆ°è®¾å¤‡ä¸­ï¼Œinitè¿›ç¨‹çš„æ‰“å°å°±å®Œæ•´äº†ã€‚</p><p>å†…æ ¸ä»£ç ä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ <code>kernel/printk/printk.c</code>ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªå‡½æ•°ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">ssize_t</span> <span class="hljs-title function_">devkmsg_write</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> kiocb *iocb, <span class="hljs-keyword">struct</span> iov_iter *from)</span><br></code></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰ä¸‹é¢è¿™ä¸¤å¥è¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">    <span class="hljs-comment">/* Ratelimit when not explicitly enabled. */</span><br>    <span class="hljs-keyword">if</span> (!(devkmsg_log &amp; DEVKMSG_LOG_MASK_ON)) &#123;<br>-       <span class="hljs-keyword">if</span> (!___ratelimit(&amp;user-&gt;rs, current-&gt;comm))<br>-           <span class="hljs-keyword">return</span> ret;<br>+       <span class="hljs-comment">//if (!___ratelimit(&amp;user-&gt;rs, current-&gt;comm))</span><br>+           <span class="hljs-comment">//return ret;</span><br>    &#125;<br>    buf = kmalloc(len+<span class="hljs-number">1</span>, GFP_KERNEL);<br></code></pre></td></tr></table></figure><h3 id="2-4-Androidä¿®æ”¹æ—¥å¿—çº§åˆ«"><a href="#2-4-Androidä¿®æ”¹æ—¥å¿—çº§åˆ«" class="headerlink" title="2.4 Androidä¿®æ”¹æ—¥å¿—çº§åˆ«"></a>2.4 Androidä¿®æ”¹æ—¥å¿—çº§åˆ«</h3><p>ä»¥Android 10.0 qcomå¹³å°ä¸ºä¾‹ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š<code>device/qcom/common/rootdir/etc/init.qcom.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">case &quot;$buildvariant&quot; in<br>    &quot;userdebug&quot; | &quot;eng&quot;)<br>        #set default loglevel to KERN_INFO<br>        echo &quot;6 6 1 7&quot; &gt; /proc/sys/kernel/printk  ##### æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹<br><br>        ;;<br>    *)<br>        #set default loglevel to KERN_WARNING<br>        echo &quot;4 4 1 4&quot; &gt; /proc/sys/kernel/printk<br>        ;;<br>esac<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linuxå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Kernel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidé€šç”¨å†…æ ¸GKI</title>
    <link href="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/"/>
    <url>/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/</url>
    
    <content type="html"><![CDATA[<h1 id="Androidé€šç”¨å†…æ ¸GKI"><a href="#Androidé€šç”¨å†…æ ¸GKI" class="headerlink" title="Androidé€šç”¨å†…æ ¸GKI"></a>Androidé€šç”¨å†…æ ¸GKI</h1><h2 id="1-GKIæ¦‚è¿°"><a href="#1-GKIæ¦‚è¿°" class="headerlink" title="1.GKIæ¦‚è¿°"></a>1.GKIæ¦‚è¿°</h2><p><strong>å¿«é€Ÿäº†è§£</strong>ï¼š GKIå…¨ç§°ä¸ºGeneric kernel Imageã€‚è‡ª2019å¹´å¼€å§‹ï¼Œæ¥è‡ªGoogle Androidçš„Kernel teamç»è¿‡å¤šå¹´å‡†å¤‡ï¼Œå¼€å§‹åœ¨Android 11.0çš„ç ”å‘ç‰ˆæœ¬ä¸Šæ¨è¡ŒGKIè®¾è®¡ã€‚GKIçš„ç›®æ ‡åœ¨äºæ¶ˆé™¤Androidé˜µè¥Linux Kernelçš„ç¢ç‰‡åŒ–çŠ¶æ€ã€‚ <strong>GKIçš„ç»ˆæç›®æ ‡æ˜¯ç”±Googleç»Ÿä¸€å‘å¸ƒboot.imageé•œåƒç»™å…¨çƒç”¨æˆ·ä½¿ç”¨</strong>ã€‚GKIæ˜¯Google Trebleé¡¹ç›®çš„é‡è¦ä¸¾æªä¹‹ä¸€ã€‚</p><h3 id="1-1-è°·æ­Œä¸ºä»€ä¹ˆè¦æå‡ºGKI"><a href="#1-1-è°·æ­Œä¸ºä»€ä¹ˆè¦æå‡ºGKI" class="headerlink" title="1.1 è°·æ­Œä¸ºä»€ä¹ˆè¦æå‡ºGKI"></a>1.1 è°·æ­Œä¸ºä»€ä¹ˆè¦æå‡ºGKI</h3><p>ç›´æ¥æ¬è¿å®˜ç½‘ï¼Œè®²çš„å¤ªè¯¦ç»†äº†ã€‚</p><p><u><strong>Android é€šç”¨å†…æ ¸ (ACK)</strong></u> æ˜¯æ‰€æœ‰ Android äº§å“å†…æ ¸çš„åŸºç¡€ã€‚ä¾›åº”å•†å†…æ ¸å’Œè®¾å¤‡å†…æ ¸ä½äº ACK çš„ä¸‹æ¸¸ã€‚ä¾›åº”å•†é€šè¿‡ä¿®æ”¹å†…æ ¸æºä»£ç å¹¶æ·»åŠ è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œæ·»åŠ äº†å¯¹ SoC å’Œå¤–å›´è®¾å¤‡çš„æ”¯æŒã€‚è¿™äº›ä¿®æ”¹å†…å®¹å¯èƒ½å¾ˆå¤šï¼Œä»¥è‡³äºè®¾å¤‡ä¸Šè¿è¡Œçš„ä»£ç ä¸­æœ‰å¤šè¾¾ 50% æ˜¯æ ‘å¤–ä»£ç ï¼ˆå¹¶éæ¥è‡ªä¸Šæ¸¸ Linux å’Œ AOSP é€šç”¨å†…æ ¸ï¼‰ã€‚</p><p>å› æ­¤ï¼Œè®¾å¤‡å†…æ ¸ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ä¸Šæ¸¸ï¼šæ¥è‡ª kernel.org çš„ Linux å†…æ ¸</li><li>AOSPï¼šAOSP é€šç”¨å†…æ ¸çš„å…¶ä»– Android ä¸“ç”¨è¡¥ä¸ç¨‹åº</li><li>ä¾›åº”å•†ï¼šä¾›åº”å•†æä¾›çš„ SoC å’Œå¤–å›´è®¾å¤‡æ”¯æŒä»¥åŠä¼˜åŒ–è¡¥ä¸ç¨‹åº</li><li>åŸå§‹è®¾å¤‡åˆ¶é€ å•† (OEM)&#x2F;è®¾å¤‡ï¼šå…¶ä»–è®¾å¤‡é©±åŠ¨ç¨‹åºå’Œè‡ªå®šä¹‰é¡¹</li></ul><img src="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/image-20230217234034047.png" alt="image-20230217234034047" style="zoom: 67%;"><p>Kernelä»Linuxåˆ†æ”¯ä¸€è·¯åˆ°OEMå‚å•†ï¼Œä¸æ–­è¿›è¡Œä¿®æ”¹ï¼Œå…¨çƒè¿™ä¹ˆå¤švendorå‚å•†ï¼Œè¿™ä¹ˆå¤šoemå‚å•†ï¼Œæ¯å®¶éƒ½æ¥è¿™ä¹ˆä¸€å¥—è‡ªå·±çš„kernelï¼Œç¢ç‰‡åŒ–å¤ªå¤ªå¤ªä¸¥é‡äº†ï¼Œè°·æ­ŒçœŸçš„å¾ˆéš¾ç»´æŠ¤ã€‚ç”¨å®˜ç½‘çš„è¯ï¼Œ<strong>å†…æ ¸ç¢ç‰‡åŒ–ä¼šå¯¹ Android ç¤¾åŒºäº§ç”Ÿè‹¥å¹²è´Ÿé¢å½±å“</strong>ã€‚</p><ul><li>å®‰å…¨æ›´æ–°éœ€è¦è€—è´¹å¤§é‡äººåŠ›<ul><li>Android å®‰å…¨å…¬å‘Š (ASB) ä¸­å¼•ç”¨çš„å®‰å…¨è¡¥ä¸ç¨‹åºå¿…é¡»å‘åç§»æ¤åˆ°æ¯ä¸ªè®¾å¤‡å†…æ ¸ä¸­ã€‚ä½†æ˜¯ï¼Œç”±äºå­˜åœ¨å†…æ ¸ç¢ç‰‡åŒ–é—®é¢˜ï¼Œå‘æ­£å¸¸ä½¿ç”¨çš„ Android è®¾å¤‡ä¼ æ’­å®‰å…¨ä¿®å¤çš„ä»£ä»·éå¸¸ä¹‹é«˜ã€‚</li></ul></li><li>å¾ˆéš¾åˆå¹¶é•¿æœŸæ”¯æŒçš„æ›´æ–°<ul><li>é•¿æœŸæ”¯æŒ (LTS) ç‰ˆæœ¬åŒ…å«å®‰å…¨ä¿®å¤å’Œå…¶ä»–é‡å¤§é—®é¢˜ä¿®å¤ã€‚äº‹å®è¯æ˜ï¼Œä½¿ç”¨æœ€æ–°çš„ LTS ç‰ˆæœ¬æ˜¯æä¾›å®‰å…¨ä¿®å¤çš„æœ€æœ‰æ•ˆæ–¹å¼ã€‚æˆ‘ä»¬å‘ç°ï¼ŒASB æŠ¥å‘Šçš„å†…æ ¸å®‰å…¨é—®é¢˜ä¸­æœ‰ 90% éƒ½å·²åœ¨ä¿æŒæœ€æ–°çŠ¶æ€çš„ Pixel è®¾å¤‡ä¸Šå¾—åˆ°ä¿®å¤ã€‚</li></ul></li><li>å¦¨ç¢ Android å¹³å°è¿›è¡Œç‰ˆæœ¬å‡çº§<ul><li>ç”±äºç¢ç‰‡åŒ–é—®é¢˜ï¼Œå¾ˆéš¾å‘æ­£å¸¸ä½¿ç”¨çš„è®¾å¤‡æ·»åŠ éœ€è¦æ›´æ”¹å†…æ ¸çš„ Android æ–°åŠŸèƒ½ã€‚Android æ¡†æ¶ä»£ç å¿…é¡»å‡è®¾æ”¯æŒçš„å†…æ ¸ç‰ˆæœ¬å¤šè¾¾ 5 ä¸ªï¼Œå¹¶ä¸”æ²¡æœ‰é’ˆå¯¹æ–°çš„å¹³å°ç‰ˆæœ¬è¿›è¡Œä»»ä½•å†…æ ¸æ›´æ”¹ï¼ˆAndroid 10 æ”¯æŒå†…æ ¸ç‰ˆæœ¬ 3.18ã€4.4ã€4.9ã€4.14 å’Œ 4.19ï¼›åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›ç‰ˆæœ¬è‡ª 2017 å¹´ Android 8 å‘å¸ƒä»¥æ¥è¿˜æœªæ·»åŠ æ–°åŠŸèƒ½ï¼‰ã€‚</li></ul></li><li>å¾ˆéš¾å°†å†…æ ¸æ›´æ”¹è´¡çŒ®å›ä¸Šæ¸¸ Linux<ul><li>å¯¹å†…æ ¸è¿›è¡Œå®Œæ‰€æœ‰æ›´æ”¹åï¼Œå¤§å¤šæ•°æ——èˆ°è®¾å¤‡é™„å¸¦çš„å†…æ ¸ç‰ˆæœ¬å·²ç»è‡³å°‘å­˜åœ¨ 18 ä¸ªæœˆäº†ã€‚ä¾‹å¦‚ï¼Œ<code>kernel.org</code> äº 2017 å¹´ 11 æœˆå‘å¸ƒäº† 4.14 ç‰ˆå†…æ ¸ï¼Œè€Œé¦–æ‰¹ä½¿ç”¨ 4.14 ç‰ˆå†…æ ¸çš„ Android æ‰‹æœºäº 2019 å¹´æ˜¥å­£æ‰å‘å¸ƒã€‚</li><li>ä¸Šæ¸¸å†…æ ¸å‘å¸ƒä¸äº§å“å‘å¸ƒä¹‹é—´çš„è¿™ç§é•¿æ—¶é—´å»¶è¿Ÿå¯¼è‡´ Android ç¤¾åŒºå¾ˆéš¾å°†æ‰€éœ€çš„åŠŸèƒ½å’Œé©±åŠ¨ç¨‹åºé¦ˆé€åˆ°ä¸Šæ¸¸å†…æ ¸ä¸­ï¼Œå› æ­¤è§£å†³ç¢ç‰‡åŒ–é—®é¢˜å¹¶éæ˜“äº‹ã€‚</li></ul></li></ul><h3 id="1-2-è°·æ­Œå¦‚ä½•è§£å†³ç¢ç‰‡åŒ–"><a href="#1-2-è°·æ­Œå¦‚ä½•è§£å†³ç¢ç‰‡åŒ–" class="headerlink" title="1.2 è°·æ­Œå¦‚ä½•è§£å†³ç¢ç‰‡åŒ–"></a>1.2 è°·æ­Œå¦‚ä½•è§£å†³ç¢ç‰‡åŒ–</h3><p>é€šç”¨å†…æ ¸æ˜ åƒ (GKI) é¡¹ç›®é€šè¿‡ç»Ÿä¸€æ ¸å¿ƒå†…æ ¸å¹¶å°† SoC å’Œæ¿çº§æ”¯æŒä»æ ¸å¿ƒå†…æ ¸ç§»è‡³å¯åŠ è½½æ¨¡å—ä¸­ï¼Œè§£å†³äº†å†…æ ¸ç¢ç‰‡åŒ–é—®é¢˜ã€‚GKI å†…æ ¸ä¸ºå†…æ ¸æ¨¡å—æä¾›äº†ç¨³å®šçš„å†…æ ¸æ¨¡å—æ¥å£ (KMI)ï¼Œå› æ­¤æ¨¡å—å’Œå†…æ ¸å¯ä»¥ç‹¬ç«‹è¿›è¡Œæ›´æ–°ã€‚</p> <img src="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/image-20230217234449847.png" style="zoom: 80%;"><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒGoogle ä¼šæä¾› KMI æ¥å£ï¼Œç”¨äº vendor modules å’Œ GKI çš„é€šè®¯ã€‚</p><blockquote><p>ç›´ç™½ç‚¹è¯´ï¼Œå°±æ˜¯è°·æ­ŒæŠŠæ‰€æœ‰é€šç”¨çš„Kernelæ”¾åœ¨äº†<code>Generic Kernel</code>é‡Œé¢ï¼ŒæŠŠé€šç”¨çš„Moudulesæ”¾åœ¨äº†<code>GKI Modules</code>é‡Œé¢ã€‚è€Œä¸ç¡¬ä»¶å¼ºç›¸å…³çš„ï¼Œä¸å„å‚å•†ç´§å¯†è”ç³»çš„æ¨¡å—æ”¾åœ¨äº†<code>Vendor Modules</code>é‡Œé¢ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ç”¨æˆ·å¯ä»¥å¿«é€Ÿå‡çº§ï¼Œåªè¦åˆ°è°·æ­Œå®˜ç½‘æ‰¾åˆ°æœ€æ–°çš„GKIï¼Œå°±å¯ä»¥ç”¨ä¸Šæœ€æ–°ï¼Œæœ€å®‰å…¨çš„Kernelï¼è€Œä¸ç¡¬ä»¶å¼ºç›¸å…³çš„ï¼Œæ™šç‚¹å‡çº§ä¹Ÿæ²¡äº‹ï¼Œæ—¢ç„¶æ‰‹æœºèƒ½ç”¨ï¼Œè¯´æ˜å„å¤§å‚å•†å¯¹äºé©±åŠ¨ç­‰æ—©å°±é€‚é…å¥½äº†ã€‚</p></blockquote><h3 id="1-3-GKIå‘å±•å†ç¨‹"><a href="#1-3-GKIå‘å±•å†ç¨‹" class="headerlink" title="1.3 GKIå‘å±•å†ç¨‹"></a>1.3 GKIå‘å±•å†ç¨‹</h3><p>Gogole GKI åˆ†ä¸ºä¸‹é¢ä¸¤ä¸ªé˜¶æ®µæ¨è¿›ï¼š</p><blockquote><p><em>â€¢</em> I. GKI å…¼å®¹æ€§ï¼šAndroid 11(R) + linux-5.4 require GKI compatibility test.</p><p><em>â€¢</em> II. GKI äº§å“åŒ–ï¼šAndroid 12(S) + linux-5.x åŠä¹‹å require GKI kernel</p></blockquote><p><strong>GKI 1.0 - GKI å…¼å®¹æ€§è¦æ±‚</strong></p><p>å¯¹äº Android 11 å¹³å°ç‰ˆæœ¬ï¼Œä¸ºäº†ä¿è¯ä¸ Treble å…¼å®¹ï¼Œå¿…é¡»å¯¹è¿è¡Œ v5.4 å†…æ ¸çš„è®¾å¤‡è¿›è¡Œ GKI æµ‹è¯•ã€‚</p><p>å…·å¤‡ GKI å…¼å®¹æ€§æ˜¯æŒ‡è®¾å¤‡é€šè¿‡å°† GKI å¯åŠ¨æ˜ åƒåˆ·å†™åˆ° <code>boot</code> åˆ†åŒºå¹¶å°† GSI ç³»ç»Ÿæ˜ åƒåˆ·å†™åˆ° <code>system</code> åˆ†åŒºæ¥å®‰è£…é€šç”¨ç³»ç»Ÿæ˜ åƒ (GSI) å’Œ GKI å†…æ ¸ï¼Œå› æ­¤é€šè¿‡äº† VTS å’Œ CTS-on-GSI+GKI æµ‹è¯•ã€‚è®¾å¤‡å¯ä»¥é™„å¸¦ä¸åŒçš„äº§å“å†…æ ¸ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ GKI æœªæä¾›çš„å¯åŠ è½½æ¨¡å—ã€‚ä¸è¿‡ï¼Œäº§å“å†…æ ¸å’Œ GKI å†…æ ¸éƒ½å¿…é¡»ä»ç›¸åŒçš„ <code>vendor_boot</code> å’Œ <code>vendor</code> åˆ†åŒºåŠ è½½æ¨¡å—ã€‚å› æ­¤ï¼Œæ‰€æœ‰äº§å“å†…æ ¸éƒ½å¿…é¡»å…·æœ‰ç›¸åŒçš„äºŒè¿›åˆ¶å†…æ ¸æ¨¡å—æ¥å£ (KMI)ã€‚ä¾›åº”å•†å¯ä»¥æ‰©å±•äº§å“å†…æ ¸çš„ KMIï¼Œå‰ææ˜¯å®ƒä¸ GKI KMI å…¼å®¹ã€‚GKI 1.0 ä¸è¦æ±‚ä¾›åº”å•†æ¨¡å—å¯å¸è½½ã€‚</p><p><strong>GKI 2.0 - GKI äº§å“</strong></p><p>æ­è½½ Android S (2021) å¹³å°ç‰ˆæœ¬ä¸”ä½¿ç”¨å†…æ ¸ç‰ˆæœ¬ v5.xï¼ˆ5.x æ˜¯ 2020 å¹´å¹´åº•è¢«é€‰ä¸º LTS çš„å†…æ ¸ç‰ˆæœ¬ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡å¿…é¡»é™„å¸¦ GKI å†…æ ¸ã€‚å°†æä¾›å·²ç­¾åçš„å¯åŠ¨æ˜ åƒï¼Œå¹¶é€šè¿‡ LTS å’Œé‡å¤§é—®é¢˜ä¿®å¤å®šæœŸå¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚ç”±äº KMI å°†ä¿æŒäºŒè¿›åˆ¶ç¨³å®šæ€§ï¼Œå› æ­¤æ— éœ€å¯¹ä¾›åº”å•†æ˜ åƒè¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œå³å¯å®‰è£…è¿™äº›å¯åŠ¨æ˜ åƒã€‚</p><h2 id="2-GKIåå„é•œåƒçš„å˜åŒ–"><a href="#2-GKIåå„é•œåƒçš„å˜åŒ–" class="headerlink" title="2.GKIåå„é•œåƒçš„å˜åŒ–"></a>2.GKIåå„é•œåƒçš„å˜åŒ–</h2><h3 id="2-1-bootåˆ†åŒºå˜åŒ–"><a href="#2-1-bootåˆ†åŒºå˜åŒ–" class="headerlink" title="2.1 bootåˆ†åŒºå˜åŒ–"></a>2.1 bootåˆ†åŒºå˜åŒ–</h3><img src="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/image-20230219232030518.png" style="zoom:67%;"><p><code>boot</code> åˆ†åŒºåŒ…æ‹¬å¤´æ–‡ä»¶ã€å†…æ ¸ä»¥åŠå†…å«å¯åŠ¨ ramdisk é€šç”¨éƒ¨åˆ†çš„ CPIO å½’æ¡£ã€‚</p><p><code>boot</code> åˆ†åŒºä½¿ç”¨ v3 ç‰ˆå¯åŠ¨å¤´æ–‡ä»¶åï¼Œå…ˆå‰çš„ <code>boot</code> åˆ†åŒºçš„ä»¥ä¸‹éƒ¨åˆ†å°†ä¸å¤å­˜åœ¨ï¼š</p><ul><li>ç¬¬äºŒé˜¶æ®µå¼•å¯¼åŠ è½½ç¨‹åºï¼šå¦‚æœè®¾å¤‡å…·æœ‰ç¬¬äºŒé˜¶æ®µå¼•å¯¼åŠ è½½ç¨‹åºï¼Œåˆ™å¿…é¡»å°†ç›¸åº”å¼•å¯¼åŠ è½½ç¨‹åºå­˜å‚¨åœ¨è‡ªå·±çš„åˆ†åŒºä¸­ã€‚</li><li>DTBï¼šDTB å­˜å‚¨åœ¨ä¾›åº”å•†å¯åŠ¨åˆ†åŒºä¸­ã€‚</li></ul><p><code>boot</code> åˆ†åŒºåŒ…å«ä¸€ä¸ª CPIOå‹ç¼©åŒ…ï¼Œå†…å«ä»¥ä¸‹ GKI ç»„ä»¶ï¼š</p><ul><li>ä½äº <code>/lib/modules/</code> çš„ GKI å†…æ ¸æ¨¡å—</li><li><code>first_stage_init</code> åŠå…¶ä¾èµ–çš„åº“</li><li><code>fastbootd</code> å’Œ <code>recovery</code>ï¼ˆç”¨äº A&#x2F;B å’Œè™šæ‹Ÿ A&#x2F;B è®¾å¤‡ï¼‰</li></ul><h3 id="2-2-å‡ºç°vendor-bootåˆ†åŒº"><a href="#2-2-å‡ºç°vendor-bootåˆ†åŒº" class="headerlink" title="2.2 å‡ºç°vendor_bootåˆ†åŒº"></a>2.2 å‡ºç°vendor_bootåˆ†åŒº</h3><p><code>vendor_boot</code> åˆ†åŒºéš GKI å¼•å…¥ã€‚è¯¥åˆ†åŒºæ˜¯é‡‡ç”¨A&#x2F;B åˆ†åŒºï¼ŒåŒ…å«ä¸€ä¸ªå¤´æ–‡ä»¶ã€ä¾›åº”å•† ramdisk å’Œè®¾å¤‡æ ‘ Blobã€‚vendor ramdisk æ˜¯ä¸€ä¸ª CPIO å‹ç¼©åŒ…ï¼Œå…¶ä¸­åŒ…å«è®¾å¤‡å¯åŠ¨æ‰€éœ€çš„ä¾›åº”å•†æ¨¡å—ã€‚è¿™åŒ…æ‹¬ç”¨äºå¯ç”¨å…³é”® SoC åŠŸèƒ½çš„æ¨¡å—ï¼Œä»¥åŠå¯åŠ¨è®¾å¤‡å’Œæ˜¾ç¤ºå¯åŠ¨ç”»é¢æ‰€éœ€çš„å­˜å‚¨å’Œæ˜¾ç¤ºé©±åŠ¨ç¨‹åºã€‚</p><p>è¯¥ CPIO å‹ç¼©åŒ…åŒ…å«ï¼š</p><ul><li>ç¬¬ä¸€é˜¶æ®µ <code>init</code> ä¾›åº”å•†å†…æ ¸æ¨¡å—ï¼Œä½äº <code>/lib/modules/</code></li><li><code>modprobe</code> é…ç½®æ–‡ä»¶ï¼Œä½äº <code>/lib/modules</code></li><li><code>modules.load</code> æ–‡ä»¶ï¼Œç”¨äºæŒ‡ç¤ºè¦åœ¨ç¬¬ä¸€é˜¶æ®µ <code>init</code> æœŸé—´åŠ è½½çš„æ¨¡å—</li></ul><h3 id="2-3-æ€»ç»“"><a href="#2-3-æ€»ç»“" class="headerlink" title="2.3 æ€»ç»“"></a>2.3 æ€»ç»“</h3><blockquote><p>å…¨å¿—çš„æ–‡æ¡£å†™çš„å¤ªå¥½ï¼Œéå¸¸æ„Ÿè°¢ğŸ˜¸</p></blockquote><img src="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/image-20230219232422846.png"><p>ä¸Šå›¾æ˜¯ boot åˆ†åŒºæ”¯æŒ GKI çš„å˜åŒ–æƒ…å†µï¼Œè¿™å¼ å›¾å¾ˆæœ‰æŒ‡å¯¼æ„ä¹‰ï¼Œå…¶ä¸­å…³é”®ç‚¹æœ‰ï¼š</p><ul><li>boot.img å˜ä¸º boot.img + vendor-boot.imgï¼Œå…¶ä¸­ boot.img ä¸­æ”¾çš„æ˜¯ GKI é•œåƒ + ramdiskï¼Œ<u>vendor-boot.img ä¸­æ”¾çš„æ˜¯éœ€è¦å¯åŠ¨åŠ è½½çš„ vendor æ¨¡å— ko</u>ï¼›</li><li>å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ bootloader åŠ è½½å¹¶æ•´åˆ boot.img å’Œ vendor-boot.imgä¸­çš„ä¸¤ä¸ªramdisk</li><li>ä¸ GKI å¯¹åº”çš„ï¼ŒGoogle è¿˜æ¨å‡º GSIï¼Œä¹Ÿå°±æ˜¯é€šç”¨ system é•œåƒï¼›</li><li>vendor.img å¯ä»¥å­˜æ”¾ä¸éœ€è¦è¦å¯åŠ¨åŠ è½½çš„ koï¼Œè¿™ä¸ªè·Ÿä»¥å‰æ˜¯ä¸€æ ·çš„ã€‚</li></ul><p>bootloader å¼€å‘éœ€è¦æ³¨æ„çš„åœ°æ–¹æœ‰ï¼š</p><ul><li>boot header V3.0</li><li>DTB çš„å­˜æ”¾ä½ç½®ä» boot.img æ”¹åˆ°äº† vendor-boot</li><li>å¯åŠ¨è¿‡ç¨‹ä¸­ boot éœ€è¦åŠ è½½ boot.img å’Œ vendor-boot.img ä¸­çš„ ramdisk å¹¶åšæ•´åˆï¼Œè€Œä¸” boot.img çš„ ramdisk ä¼˜å…ˆçº§é«˜</li></ul><h3 id="2-4-ramdiskæ‹¼æ¥"><a href="#2-4-ramdiskæ‹¼æ¥" class="headerlink" title="2.4 ramdiskæ‹¼æ¥"></a>2.4 ramdiskæ‹¼æ¥</h3><ul><li>Android 11ä¸­ï¼Œramdisk åˆ†ä¸ºä¸¤ä»½ï¼Œä¸€ä»½ä¸º<strong>boot_ramdisk</strong>ï¼Œå­˜æ”¾åœ¨ <strong>boot.img</strong>ä¸­ã€‚ä¸€ä»½ä¸º<strong>vendor_boot_ramdisk</strong> å­˜æ”¾åœ¨ <strong>vendor_boot.img</strong> ä¸­ã€‚</li><li>åœ¨ bootloader å¯åŠ¨æ—¶éœ€è¦å…ˆååŠ è½½ boot_ramdiskï¼Œvendor_boot_ramdisk å¹¶è¿›è¡Œå‰åæ‹¼æ¥ã€‚</li><li>ramdisk ç”¨çš„æ˜¯ cpio.lz4 æ ¼å¼ï¼Œå¯ä»¥è¿›è¡Œç®€å•çš„é¦–å°¾æ‹¼æ¥ï¼Œ<u><strong>ä½†æ˜¯ bootloader éœ€è¦æ³¨æ„ä¸¤ä¸ªramdisk ä¸­é—´å¿…é¡»ç´§å¯†æ‹¼æ¥ï¼Œä¸èƒ½å¯¹é½å†æ‹¼æ¥ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…æ ¸è§£å‹æ—¶å¤±è´¥</strong></u>ï¼ŒåŒæ—¶æ‹¼æ¥åæ”¹å˜ramdisk çš„å¤§å°ã€‚</li></ul><h2 id="3-å¦‚ä½•ä¸‹è½½æœ€æ–°çš„GKI"><a href="#3-å¦‚ä½•ä¸‹è½½æœ€æ–°çš„GKI" class="headerlink" title="3.å¦‚ä½•ä¸‹è½½æœ€æ–°çš„GKI"></a>3.å¦‚ä½•ä¸‹è½½æœ€æ–°çš„GKI</h2><h3 id="3-1-å®‰å“å®˜ç½‘æè¿°"><a href="#3-1-å®‰å“å®˜ç½‘æè¿°" class="headerlink" title="3.1 å®‰å“å®˜ç½‘æè¿°"></a>3.1 å®‰å“å®˜ç½‘æè¿°</h3><p>Androidå®˜ç½‘ï¼š<a href="https://source.android.com/docs/core/architecture/kernel/gki-android12-5_10-release-builds?hl=zh-cn">https://source.android.com/docs/core/architecture/kernel/gki-android12-5_10-release-builds?hl=zh-cn</a></p><p>å¦‚æœè¦ä½¿ç”¨<code>boot.img</code>ï¼Œé€‰æ‹©boot-xxx.img</p><img src="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/image-20230221223931378.png" alt="image-20230221223931378" style="zoom:67%;"><p>å¦‚æœä½¿ç”¨GKIï¼Œåˆ™ç‚¹å‡»kernelï¼Œé€‰æ‹©image</p><img src="/2023/02/19/Android%E9%80%9A%E7%94%A8%E5%86%85%E6%A0%B8GKI/image-20230221224045860.png" alt="image-20230221224045860" style="zoom:67%;"><blockquote><p>boot-xxx.imgä¸­çš„kernelå’Œè¿™ä¸ªimageæ˜¯å®Œå…¨ä¸€æ¨¡ä¸€æ ·çš„ï¼ï¼ï¼</p></blockquote><h3 id="3-2-å…¨å¿—æ–‡æ¡£"><a href="#3-2-å…¨å¿—æ–‡æ¡£" class="headerlink" title="3.2 å…¨å¿—æ–‡æ¡£"></a>3.2 å…¨å¿—æ–‡æ¡£</h3><p>æ ¹æ®å…¨å¿—æ–‡æ¡£ï¼ŒAndroid 12ä¸‹è½½ç¼–è¯‘æµç¨‹å¦‚ä¸‹ï¼š</p><p><strong>1ï¼‰ä¸‹è½½</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir android-kernel<br>cd android-kernel/<br>repo init -u https://android.googlesource.com/kernel/manifest -b common-android12-5.4<br>repo sync<br>repo start --all android12-5.4<br></code></pre></td></tr></table></figure><p><strong>2ï¼‰ ä½¿ç”¨ Google æºç ç¼–è¯‘ GKI é•œåƒ</strong></p><p>åœ¨ google æºç ç›®å½•ä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">BUILD_BOOT_IMG=1 SKIP_VENDOR_BOOT=1 KERNEL_BINARY=Image GKI_RAMDISK_PREBUILT_BINARY=gki-<br>ramdisk.img BUILD_CONFIG=common/build.config.gki.aarch64 build/build.sh<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘è¿‡ç¨‹ä¸­åœ¨ LTO vmlinux.o é˜¶æ®µå¯èƒ½ä¼šå¡ä¸»ä¸€æ®µæ—¶é—´ï¼ˆå¤§æ¦‚ååˆ†é’Ÿï¼‰ï¼Œå±äºæ­£å¸¸ç°åœºï¼Œç¬¬ä¸€æ¬¡ç¼–è¯‘ä¼šæ¯”è¾ƒè€—æ—¶ã€‚</p><p>ç¼–è¯‘å®Œæˆä»¥åï¼Œboot.imgå­˜æ”¾åœ¨<code>android-kernel/out/android12-5.4/dist/boot.img</code></p><h2 id="4-GKIå¯åŠ¨æµç¨‹"><a href="#4-GKIå¯åŠ¨æµç¨‹" class="headerlink" title="4. GKIå¯åŠ¨æµç¨‹"></a>4. GKIå¯åŠ¨æµç¨‹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">boot0<br><span class="hljs-meta prompt_">--&gt; </span><span class="language-bash">uboot: åŠ è½½boot.imgä¸­çš„GKIå’Œramdisk_1ï¼ŒåŠ è½½vendor-boot.imgçš„ramdisk_2ï¼Œæ•´åˆramdisk_1å’Œ</span><br>ramdisk_2,jump to GKI<br><span class="hljs-meta prompt_">--&gt; </span><span class="language-bash">GKI: core kernel init</span><br>--&gt; kernel initï¼š load modules ko<br>--&gt; android bringup<br></code></pre></td></tr></table></figure><h2 id="5-å‚è€ƒ"><a href="#5-å‚è€ƒ" class="headerlink" title="5.å‚è€ƒ"></a>5.å‚è€ƒ</h2><ul><li><a href="https://bbs.16rd.com/thread-583693-1-1.html">https://bbs.16rd.com/thread-583693-1-1.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/240117889">https://zhuanlan.zhihu.com/p/240117889</a></li><li><a href="https://source.android.com/docs/core/architecture/kernel/generic-kernel-image?hl=zh-cn">https://source.android.com/docs/core/architecture/kernel/generic-kernel-image?hl=zh-cn</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Androidå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>udevè®¾å¤‡ç®¡ç†</title>
    <link href="/2023/02/16/udev%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86/"/>
    <url>/2023/02/16/udev%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="udevè®¾å¤‡ç®¡ç†å™¨"><a href="#udevè®¾å¤‡ç®¡ç†å™¨" class="headerlink" title="udevè®¾å¤‡ç®¡ç†å™¨"></a>udevè®¾å¤‡ç®¡ç†å™¨</h1><p>ğŸ‹ğŸ‹ğŸ‹<strong>ååˆ†æ¨èé˜…è¯»</strong>ï¼š<a href="http://www.kroah.com/linux/talks/ols_2003_udev_paper/Reprint-Kroah-Hartman-OLS2003.pdf">http://www.kroah.com/linux/talks/ols_2003_udev_paper/Reprint-Kroah-Hartman-OLS2003.pdf</a></p><h2 id="1-ä¸ºä»€ä¹ˆä¼šå‡ºç°udev"><a href="#1-ä¸ºä»€ä¹ˆä¼šå‡ºç°udev" class="headerlink" title="1.ä¸ºä»€ä¹ˆä¼šå‡ºç°udev"></a>1.ä¸ºä»€ä¹ˆä¼šå‡ºç°udev</h2><p><strong>devfs</strong>(è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ)æ˜¯ç”±Linux2.4å†…æ ¸å¼•å…¥çš„ï¼Œå½“æ—¶è¢«è®¸å¤šå·¥ç¨‹å¸ˆåŸºäºäº†é«˜åº¦çš„è¯„ä»·ï¼Œdevfsçš„å‡ºç°ä½¿å¾—è®¾å¤‡é©±åŠ¨ç¨‹åºèƒ½å¤Ÿè‡ªä¸»çš„ç®¡ç†è‡ªå·±çš„è®¾å¤‡æ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œå¯ä»¥é€šè¿‡ç¨‹åºåœ¨è®¾å¤‡åˆå§‹åŒ–çš„æ—¶å€™åœ¨ &#x2F;dev ç›®å½•ä¸‹åˆ›å»ºè®¾å¤‡æ–‡ä»¶ï¼Œå¸è½½æ—¶å°†ä»–åˆ é™¤ï¼Œè€Œä¸”è®¾å¤‡é©±åŠ¨ç¨‹åºå¯ä»¥æŒ‡å®šè®¾å¤‡åï¼Œæ‰€æœ‰è€…å’Œæƒé™ä½ï¼Œè€Œä¸”ç”¨æˆ·ç©ºé—´ç¨‹åºå¯ä»¥ä¿®æ”¹æ‰€æœ‰è€…å’Œæƒé™ä½ï¼Œå¹¶ä¸”ä¸å†éœ€è¦ä¸ºè®¾å¤‡é©±åŠ¨ç¨‹åºåˆ†é…ä¸»è®¾å¤‡å·ä»¥åŠæ¬¡è®¾å¤‡å·ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥ç›´æ¥ç»™ register_chrdev()ä¼ é€’0ä¸»è®¾å¤‡å·ç”¨æ¥è·å–å¯ç”¨çš„ä¸»è®¾å¤‡å·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ devfs_register() ä¸­æŒ‡å®šæ¬¡è®¾å¤‡å·ã€‚</p><p>ğŸ¦‹å°½ç®¡devfsæœ‰è¿™æ ·å’Œé‚£æ ·çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯ï¼Œåœ¨Linux 2.6å†…æ ¸ä¸­ï¼Œdevfsè¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„æ–¹æ³•ï¼Œå¹¶æœ€ç»ˆè¢«æŠ›å¼ƒäº†ï¼Œ<strong>udevå–ä»£äº†å®ƒ</strong>ã€‚</p><p>ğŸ¬<strong>Linux VFSå†…æ ¸ç»´æŠ¤è€…Al ViroæŒ‡å‡ºäº†å‡ ç‚¹udevå–ä»£devfsçš„åŸå› ï¼š</strong></p><ul><li>devfsæ‰€åšçš„å·¥ä½œè¢«ç¡®ä¿¡å¯ä»¥åœ¨ç”¨æˆ·æ€æ¥å®Œæˆã€‚</li><li>devfsè¢«åŠ å…¥å†…æ ¸ä¹‹æ—¶ï¼Œå¤§å®¶æœŸæœ›å®ƒçš„è´¨é‡å¯ä»¥è¿å¤´èµ¶ä¸Š</li><li>å‘ç°devfsæœ‰ä¸€äº›å¯ä¿®å¤å’Œæ— æ³•ä¿®å¤çš„bugã€‚</li><li>å¯¹äºå¯ä¿®å¤çš„bugï¼Œå‡ ä¸ªæœˆå‰å°±å·²ç»è¢«ä¿®å¤äº†ï¼Œå…¶ç»´æŠ¤è€…è®¤ä¸ºä¸€åˆ‡è‰¯å¥½</li><li>å¯¹äºåè€…ï¼Œåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¹è§‚</li><li>devfsçš„ç»´æŠ¤è€…å’Œä½œè€…å¯¹å®ƒæ„Ÿåˆ°å¤±æœ›å¹¶ä¸”å·²ç»åœæ­¢äº†å¯¹ä»£ç çš„ç»´æŠ¤å·¥ä½œ</li></ul><h2 id="2-udevç®€ä»‹"><a href="#2-udevç®€ä»‹" class="headerlink" title="2.udevç®€ä»‹"></a>2.udevç®€ä»‹</h2><p>udevæ˜¯ä¸€ä¸ªè®¾å¤‡ç®¡ç†å·¥å…·ï¼Œ**<u>udevä»¥å®ˆæŠ¤è¿›ç¨‹çš„å½¢å¼è¿è¡Œ</u>**ï¼Œé€šè¿‡ä¾¦å¬å†…æ ¸å‘å‡ºæ¥çš„ueventæ¥ç®¡ç†&#x2F;devç›®å½•ä¸‹çš„è®¾å¤‡æ–‡ä»¶ã€‚udevåœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œï¼Œè€Œä¸åœ¨å†…æ ¸ç©ºé—´ è¿è¡Œã€‚å®ƒèƒ½å¤Ÿæ ¹æ®ç³»ç»Ÿä¸­çš„ç¡¬ä»¶è®¾å¤‡çš„çŠ¶æ€åŠ¨æ€æ›´æ–°è®¾å¤‡æ–‡ä»¶ï¼ŒåŒ…æ‹¬è®¾å¤‡æ–‡ä»¶çš„åˆ›å»ºï¼Œåˆ é™¤ç­‰ã€‚è®¾å¤‡æ–‡ä»¶é€šå¸¸æ”¾åœ¨&#x2F;devç›®å½•ä¸‹ã€‚ä½¿ç”¨udevåï¼Œåœ¨&#x2F;devç›®å½•ä¸‹å°±åªåŒ…å«ç³»ç»Ÿä¸­çœŸæ­£å­˜åœ¨çš„è®¾å¤‡ã€‚</p><blockquote><p><strong>DEVFSä¸UDEVçš„ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«ï¼š</strong></p><ul><li>é‡‡ç”¨devfsï¼Œå½“ä¸€ä¸ª<strong>å¹¶ä¸å­˜åœ¨çš„&#x2F;devèŠ‚ç‚¹</strong>è¢«æ‰“å¼€çš„æ—¶å€™ï¼Œdevfsèƒ½<strong>è‡ªåŠ¨åŠ è½½å¯¹åº”çš„é©±åŠ¨</strong>ï¼Œè€Œ<strong>udevåˆ™ä¸è¿™ä¹ˆåš</strong></li><li>è¿™æ˜¯å› ä¸ºudevçš„è®¾è®¡è€…è®¤ä¸ºLinuxåº”è¯¥åœ¨è®¾å¤‡è¢«å‘ç°çš„æ—¶å€™åŠ è½½é©±åŠ¨æ¨¡å—ï¼Œè€Œä¸æ˜¯å½“å®ƒè¢«è®¿é—®çš„æ—¶å€™ã€‚udevçš„è®¾è®¡è€…è®¤ä¸ºdevfsæ‰€æä¾›çš„æ‰“å¼€&#x2F;devèŠ‚ç‚¹æ—¶è‡ªåŠ¨åŠ è½½é©±åŠ¨çš„åŠŸèƒ½<strong>å¯¹ä¸€ä¸ªé…ç½®æ­£ç¡®çš„è®¡ç®—æœºæ¥è¯´æ˜¯å¤šä½™çš„</strong>ã€‚ç³»ç»Ÿä¸­æ‰€æœ‰çš„è®¾å¤‡éƒ½åº”è¯¥äº§ç”Ÿçƒ­æ’æ‹”äº‹ä»¶å¹¶åŠ è½½æ°å½“çš„é©±åŠ¨ï¼Œ è€Œudevèƒ½æ³¨æ„åˆ°è¿™ç‚¹å¹¶ä¸”ä¸ºå®ƒåˆ›å»ºå¯¹åº”çš„è®¾å¤‡èŠ‚ç‚¹</li></ul></blockquote><h2 id="3-udevçš„é…ç½®æ–‡ä»¶"><a href="#3-udevçš„é…ç½®æ–‡ä»¶" class="headerlink" title="3.udevçš„é…ç½®æ–‡ä»¶"></a>3.udevçš„é…ç½®æ–‡ä»¶</h2><p>ä¸»è¦çš„udevé…ç½®æ–‡ä»¶æ˜¯&#x2F;etc&#x2F;udev&#x2F;udev.confæ–‡ä»¶ã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">udev_root=<span class="hljs-string">&quot;/dev/&quot;</span><br><br>udev_rules=<span class="hljs-string">&quot;/etc/udev/rules.d/&quot;</span><br><br>udev_log=<span class="hljs-string">&quot;err&quot;</span><br></code></pre></td></tr></table></figure><ul><li>udev_rootï¼šä»£è¡¨ç€è®¾å¤‡æ–‡ä»¶æ·»åŠ åˆ°å“ªã€‚</li><li>udev_rulesï¼šä»£è¡¨ç€udevçš„è§„åˆ™å­˜å‚¨çš„ç›®å½•ã€‚è¿™ä¸ªç›®å½•å­˜å‚¨çš„æ˜¯ä»¥.rulesç»“æŸçš„æ–‡ä»¶ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶å¤„ç†ä¸€ç³»åˆ—è§„åˆ™æ¥å¸®åŠ©udevåˆ†é…åå­—ç»™è®¾å¤‡æ–‡ä»¶ä»¥ä¿è¯èƒ½è¢«å†…æ ¸è¯†åˆ«ã€‚ä½ çš„&#x2F;etc&#x2F;udev&#x2F;rules.dä¸‹é¢å¯èƒ½æœ‰å¥½å‡ ä¸ªudevè§„åˆ™æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸€éƒ¨åˆ†æ˜¯udevåŒ…å®‰è£…çš„ï¼Œå¦å¤–ä¸€éƒ¨åˆ†åˆ™æ˜¯å¯èƒ½æ˜¯åˆ«çš„ç¡¬ä»¶æˆ–è€…è½¯ä»¶åŒ…ç”Ÿæˆçš„ã€‚è¯¥ç›®å½•ä¸‹æœ‰å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œudevè¯»å–æ–‡ä»¶æ˜¯æŒ‰ç…§æ–‡ä»¶åçš„ASCIIå­—æ¯é¡ºåºæ¥è¯»å–çš„ï¼Œå¦‚æœudevä¸€æ—¦æ‰¾åˆ°äº†ä¸æ–°åŠ å…¥çš„è®¾å¤‡åŒ¹é…çš„è§„åˆ™ï¼Œudev å°±ä¼šæ ¹æ®è§„åˆ™å®šä¹‰çš„æªæ–½å¯¹æ–°è®¾å¤‡è¿›è¡Œé…ç½®ã€‚åŒæ—¶ä¸å†è¯»åç»­çš„è§„åˆ™æ–‡ä»¶ã€‚</li><li>udev_logï¼šä»£è¡¨ç€udevçš„æ—¥å¿—çº§åˆ«ï¼Œç”¨syslogè®°å½•é”™è¯¯ä¿¡æ¯ã€‚</li></ul><h2 id="4-udevçš„å·¥ä½œæµç¨‹å›¾"><a href="#4-udevçš„å·¥ä½œæµç¨‹å›¾" class="headerlink" title="4.udevçš„å·¥ä½œæµç¨‹å›¾"></a>4.udevçš„å·¥ä½œæµç¨‹å›¾</h2><img src="/2023/02/16/udev%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86/image-20230215234615127.png" style="zoom:80%;"><h2 id="5-udevçš„åŒ¹é…è§„åˆ™"><a href="#5-udevçš„åŒ¹é…è§„åˆ™" class="headerlink" title="5.udevçš„åŒ¹é…è§„åˆ™"></a>5.udevçš„åŒ¹é…è§„åˆ™</h2><p>åœ¨&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ç³»åˆ—çš„.rulesæ–‡ä»¶ï¼Œåœ¨è¿™äº›æ–‡ä»¶ä¸­æœ‰ä¸€äº›åŒ¹é…è§„åˆ™ï¼š</p><h3 id="5-1-udevè§„åˆ™çš„æ‰€æœ‰æ“ä½œç¬¦"><a href="#5-1-udevè§„åˆ™çš„æ‰€æœ‰æ“ä½œç¬¦" class="headerlink" title="5.1 udevè§„åˆ™çš„æ‰€æœ‰æ“ä½œç¬¦"></a>5.1 udevè§„åˆ™çš„æ‰€æœ‰æ“ä½œç¬¦</h3><ul><li><p>&#x3D;&#x3D; ï¼šæ¯”è¾ƒé”®ã€å€¼ï¼Œè‹¥ç­‰äºï¼Œåˆ™è¯¥æ¡ä»¶æ»¡è¶³ï¼›</p></li><li><p>!&#x3D;  ï¼šæ¯”è¾ƒé”®ã€å€¼ï¼Œè‹¥ä¸ç­‰äºï¼Œåˆ™è¯¥æ¡ä»¶æ»¡è¶³ï¼›</p></li><li><p>&#x3D;   ï¼šå¯¹ä¸€ä¸ªé”®èµ‹å€¼ï¼›</p></li><li><p>+&#x3D; ï¼šä¸ºä¸€ä¸ªè¡¨ç¤ºå¤šä¸ªæ¡ç›®çš„é”®èµ‹å€¼ã€‚</p></li><li><p>:&#x3D;  ï¼šå¯¹ä¸€ä¸ªé”®èµ‹å€¼ï¼Œå¹¶æ‹’ç»ä¹‹åæ‰€æœ‰å¯¹è¯¥é”®çš„æ”¹åŠ¨ã€‚ç›®çš„æ˜¯é˜²æ­¢åé¢çš„è§„åˆ™æ–‡ä»¶å¯¹è¯¥é”®èµ‹å€¼ã€‚</p></li></ul><h3 id="5-2-udevè§„åˆ™çš„åŒ¹é…é”®"><a href="#5-2-udevè§„åˆ™çš„åŒ¹é…é”®" class="headerlink" title="5.2 udevè§„åˆ™çš„åŒ¹é…é”®"></a>5.2 <strong>udevè§„åˆ™çš„åŒ¹é…é”®</strong></h3><ul><li>ACTIONï¼šäº‹ä»¶(uevent)çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼šadd(æ·»åŠ è®¾å¤‡)ã€remove(åˆ é™¤è®¾å¤‡)ã€‚</li><li>KERNELï¼šå†…æ ¸è®¾å¤‡åç§°ï¼Œä¾‹å¦‚ï¼šsda,cdromã€‚</li><li>DEVPATHï¼šè®¾å¤‡çš„devpathè·¯å¾„ã€‚</li><li>SUBSYSTEMï¼šè®¾å¤‡çš„å­ç³»ç»Ÿåç§°ï¼Œä¾‹å¦‚ï¼šsdaçš„å­ç³»ç»Ÿä¸ºblockã€‚</li><li>BUSï¼šè®¾å¤‡åœ¨devpath é‡Œçš„æ€»çº¿åç§°ï¼Œä¾‹å¦‚ï¼šusbã€‚</li><li>DRIVERï¼šè®¾å¤‡åœ¨devpath é‡Œçš„è®¾å¤‡é©±åŠ¨åç§°ï¼Œä¾‹å¦‚ï¼šide-cdromã€‚</li><li>IDï¼šè®¾å¤‡åœ¨devpath é‡Œçš„è¯†åˆ«å·ã€‚</li><li>SYSFS{filename}ï¼šè®¾å¤‡çš„devpath è·¯å¾„ä¸‹ï¼Œè®¾å¤‡çš„å±æ€§æ–‡ä»¶â€œfilenameâ€é‡Œçš„å†…å®¹ã€‚</li></ul><blockquote><p>ä¾‹å¦‚ï¼šSYSFS{model}&#x3D;&#x3D;â€œST936701SSâ€è¡¨ç¤ºï¼šå¦‚æœè®¾å¤‡çš„å‹å·ä¸ºST936701SSï¼Œåˆ™è¯¥è®¾å¤‡åŒ¹é…è¯¥åŒ¹é…é”®ã€‚</p><p>åœ¨ä¸€æ¡è§„åˆ™ä¸­ï¼Œå¯ä»¥è®¾å®šæœ€å¤šäº”æ¡SYSFSçš„åŒ¹é…é”®ã€‚</p></blockquote><ul><li>ENV{key}ï¼šç¯å¢ƒå˜é‡ã€‚åœ¨ä¸€æ¡è§„åˆ™ä¸­ï¼Œå¯ä»¥è®¾å®šæœ€å¤šäº”æ¡ç¯å¢ƒå˜é‡çš„åŒ¹é…é”®ã€‚</li><li>PROGRAMï¼šè°ƒç”¨å¤–éƒ¨å‘½ä»¤ã€‚</li><li>RESULTï¼šå¤–éƒ¨å‘½ä»¤PROGRAM çš„è¿”å›ç»“æœã€‚ä¾‹å¦‚ï¼š</li></ul><blockquote><p>PROGRAM&#x3D;&#x3D;â€&#x2F;lib&#x2F;udev&#x2F;scsi_id-g -s $devpathâ€, RESULT&#x3D;&#x3D;â€œ35000c50000a7ef67â€</p><p>è°ƒç”¨å¤–éƒ¨å‘½ä»¤&#x2F;lib&#x2F;udev&#x2F;scsi_idæŸ¥è¯¢è®¾å¤‡çš„SCSIIDï¼Œå¦‚æœè¿”å›ç»“æœä¸º35000c50000a7ef67ï¼Œåˆ™è¯¥è®¾å¤‡åŒ¹é…è¯¥åŒ¹é…é”®ã€‚</p></blockquote><h3 id="5-3-udev-çš„é‡è¦èµ‹å€¼é”®"><a href="#5-3-udev-çš„é‡è¦èµ‹å€¼é”®" class="headerlink" title="5.3 udev çš„é‡è¦èµ‹å€¼é”®"></a>5.3 udev çš„é‡è¦èµ‹å€¼é”®</h3><ul><li>NAMEï¼šåœ¨&#x2F;devä¸‹äº§ç”Ÿçš„è®¾å¤‡æ–‡ä»¶åã€‚åªæœ‰ç¬¬ä¸€æ¬¡å¯¹æŸä¸ªè®¾å¤‡çš„NAMEçš„èµ‹å€¼è¡Œä¸ºç”Ÿæ•ˆï¼Œä¹‹ååŒ¹é…çš„è§„åˆ™å†å¯¹è¯¥è®¾å¤‡çš„NAMEèµ‹å€¼è¡Œä¸ºå°†è¢«å¿½ç•¥ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•è§„åˆ™å¯¹è®¾å¤‡çš„NAMEèµ‹å€¼ï¼Œudevå°†ä½¿ç”¨å†…æ ¸è®¾å¤‡åç§°æ¥äº§ç”Ÿè®¾å¤‡æ–‡ä»¶ã€‚</li><li>SYMLINKï¼šä¸º&#x2F;dev&#x2F;ä¸‹çš„è®¾å¤‡æ–‡ä»¶äº§ç”Ÿç¬¦å·é“¾æ¥ã€‚ç”±äºudevåªèƒ½ä¸ºæŸä¸ªè®¾å¤‡äº§ç”Ÿä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ºäº†ä¸è¦†ç›–ç³»ç»Ÿé»˜è®¤çš„udevè§„åˆ™æ‰€äº§ç”Ÿçš„æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨ç¬¦å·é“¾æ¥ã€‚</li><li>OWNER, GROUP, MODEï¼šä¸ºè®¾å¤‡è®¾å®šæƒé™ã€‚</li><li>ENV{key}ï¼šå¯¼å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚</li><li>RUN:è¿è¡Œåé¢çš„ç¨‹åºã€‚</li></ul><h3 id="5-4-udev-çš„å€¼å’Œå¯è°ƒç”¨çš„æ›¿æ¢æ“ä½œç¬¦"><a href="#5-4-udev-çš„å€¼å’Œå¯è°ƒç”¨çš„æ›¿æ¢æ“ä½œç¬¦" class="headerlink" title="5.4 udev çš„å€¼å’Œå¯è°ƒç”¨çš„æ›¿æ¢æ“ä½œç¬¦"></a>5.4 udev çš„å€¼å’Œå¯è°ƒç”¨çš„æ›¿æ¢æ“ä½œç¬¦</h3><p>åœ¨é”®å€¼å¯¹ä¸­çš„é”®å’Œæ“ä½œç¬¦éƒ½ä»‹ç»å®Œäº†ï¼Œæœ€åæ˜¯å€¼(value)ã€‚Linuxç”¨æˆ·å¯ä»¥éšæ„åœ°å®šåˆ¶udevè§„åˆ™æ–‡ä»¶çš„å€¼ã€‚ä¾‹å¦‚ï¼šmy_root_disk,my_printerã€‚åŒæ—¶ä¹Ÿå¯ä»¥å¼•ç”¨ä¸‹é¢çš„æ›¿æ¢æ“ä½œç¬¦ï¼š</p><ul><li>$kernel, %kï¼šè®¾å¤‡çš„å†…æ ¸è®¾å¤‡åç§°ï¼Œä¾‹å¦‚ï¼šsdaã€cdromã€‚</li><li>$number, %nï¼šè®¾å¤‡çš„å†…æ ¸å·ç ï¼Œä¾‹å¦‚ï¼šsda3çš„å†…æ ¸å·ç æ˜¯3ã€‚</li><li>$devpath, %pï¼šè®¾å¤‡çš„devpathè·¯å¾„ã€‚</li><li>$id, %bï¼šè®¾å¤‡åœ¨devpathé‡Œçš„IDå·ã€‚</li><li>$sysfs{file}ï¼Œ%s{file}ï¼šè®¾å¤‡çš„sysfsé‡Œfileçš„å†…å®¹ã€‚å…¶å®å°±æ˜¯è®¾å¤‡çš„å±æ€§å€¼ã€‚ä¾‹å¦‚ï¼šsysfs{size}è¡¨ç¤ºè¯¥è®¾å¤‡(ç£ç›˜) çš„å¤§å°ã€‚</li><li>$env{key}, %E{key}ï¼šä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ã€‚</li><li>$major, %Mï¼šè®¾å¤‡çš„majorå·ã€‚</li><li>$minor %mï¼šè®¾å¤‡çš„minorå·ã€‚</li><li>$result, %cï¼šPROGRAMè¿”å›çš„ç»“æœã€‚</li><li>$parent, %Pï¼šçˆ¶è®¾å¤‡çš„è®¾å¤‡æ–‡ä»¶åã€‚</li><li>$root, %rï¼šudev_rootçš„å€¼ï¼Œé»˜è®¤æ˜¯&#x2F;dev&#x2F;ã€‚</li><li>$tempnode, %Nï¼šä¸´æ—¶è®¾å¤‡åã€‚</li><li>%%ï¼šç¬¦å·%æœ¬èº«ã€‚</li><li>$$ï¼š ç¬¦ å· ï¼šç¬¦å·ï¼šç¬¦å·æœ¬èº«ã€‚</li></ul><p>æ³¨æ„ï¼šåœ¨åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œè¦åŒ¹é…æ‰€æœ‰çš„æ¯”è¾ƒé”®éƒ½æ»¡è¶³æ—¶ï¼Œæ‰ç®—åŒ¹é…æˆåŠŸã€‚</p><h2 id="6-udevçš„ä½¿ç”¨æ–¹æ³•"><a href="#6-udevçš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="6.udevçš„ä½¿ç”¨æ–¹æ³•"></a>6.udevçš„ä½¿ç”¨æ–¹æ³•</h2><ol><li>ä½¿ç”¨udevadm å‘½ä»¤æ¥æŸ¥çœ‹è®¾å¤‡çš„ä¿¡æ¯ï¼šåœ¨ä½¿ç”¨udevæ—¶éœ€è¦è·å¾—è¯¥è®¾å¤‡çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¥ç”¨äºåŒ¹é…è§„åˆ™ã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">udevadm info -a -p $(udevadm info -q path -n /dev/sdb)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­&#x2F;dev&#x2F;sdbæ˜¯æ’å…¥è®¾å¤‡åè®¾å¤‡åœ¨&#x2F;devä¸‹çš„åå­—ã€‚</p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs shell">Udevadm info starts with the device specified by the devpath and then<br>walks up the chain of parent devices. It prints for every device<br>found, all possible attributes in the udev rules key format.<br>A rule to match, can be composed by the attributes of the device<br>and the attributes from one single parent device.<br><br>  looking at device &#x27;/devices/pci0000:00/0000:00:10.0/host20/target20:0:1/20:0:1:0/block/sdb&#x27;:<br>    KERNEL==&quot;sdb&quot;<br>    SUBSYSTEM==&quot;block&quot;<br>    DRIVER==&quot;&quot;<br>    ATTR&#123;alignment_offset&#125;==&quot;0&quot;<br>    ATTR&#123;capability&#125;==&quot;50&quot;<br>    ATTR&#123;discard_alignment&#125;==&quot;0&quot;<br>    ATTR&#123;events&#125;==&quot;&quot;<br>    ATTR&#123;events_async&#125;==&quot;&quot;<br>    ATTR&#123;events_poll_msecs&#125;==&quot;-1&quot;<br>    ATTR&#123;ext_range&#125;==&quot;256&quot;<br>    ATTR&#123;hidden&#125;==&quot;0&quot;<br>    ATTR&#123;inflight&#125;==&quot;       0        0&quot;<br>    ATTR&#123;range&#125;==&quot;16&quot;<br>    ATTR&#123;removable&#125;==&quot;0&quot;<br>    ATTR&#123;ro&#125;==&quot;0&quot;<br>    ATTR&#123;size&#125;==&quot;41943040&quot;<br>    ATTR&#123;stat&#125;==&quot;      85        0     4184       20        0        0        0        0        0        8       20&quot;<br><br>  looking at parent device &#x27;/devices/pci0000:00/0000:00:10.0/host20/target20:0:1/20:0:1:0&#x27;:<br>    KERNELS==&quot;20:0:1:0&quot;<br>    SUBSYSTEMS==&quot;scsi&quot;<br>    DRIVERS==&quot;sd&quot;<br>    ATTRS&#123;blacklist&#125;==&quot;&quot;<br>    ATTRS&#123;device_blocked&#125;==&quot;0&quot;<br>    ATTRS&#123;device_busy&#125;==&quot;0&quot;<br>    ATTRS&#123;dh_state&#125;==&quot;detached&quot;<br>    ATTRS&#123;eh_timeout&#125;==&quot;10&quot;<br>    ATTRS&#123;evt_capacity_change_reported&#125;==&quot;0&quot;<br>    ATTRS&#123;evt_inquiry_change_reported&#125;==&quot;0&quot;<br>    ATTRS&#123;evt_lun_change_reported&#125;==&quot;0&quot;<br>    ATTRS&#123;evt_media_change&#125;==&quot;0&quot;<br>    ATTRS&#123;evt_mode_parameter_change_reported&#125;==&quot;0&quot;<br>    ATTRS&#123;evt_soft_threshold_reached&#125;==&quot;0&quot;<br>    ATTRS&#123;inquiry&#125;==&quot;&quot;<br>    ATTRS&#123;iocounterbits&#125;==&quot;32&quot;<br>    ATTRS&#123;iodone_cnt&#125;==&quot;0x7a&quot;<br>    ATTRS&#123;ioerr_cnt&#125;==&quot;0x3&quot;<br>    ATTRS&#123;iorequest_cnt&#125;==&quot;0x7a&quot;<br>    ATTRS&#123;model&#125;==&quot;VMware Virtual S&quot;<br>    ATTRS&#123;queue_depth&#125;==&quot;32&quot;<br>    ATTRS&#123;queue_ramp_up_period&#125;==&quot;120000&quot;<br>    ATTRS&#123;queue_type&#125;==&quot;simple&quot;<br>    ATTRS&#123;rev&#125;==&quot;1.0 &quot;<br>    ATTRS&#123;scsi_level&#125;==&quot;3&quot;<br>    ATTRS&#123;state&#125;==&quot;running&quot;<br>    ATTRS&#123;timeout&#125;==&quot;180&quot;<br>    ATTRS&#123;type&#125;==&quot;0&quot;<br>    ATTRS&#123;vendor&#125;==&quot;VMware, &quot;<br><br>  looking at parent device &#x27;/devices/pci0000:00/0000:00:10.0/host20/target20:0:1&#x27;:<br>    KERNELS==&quot;target20:0:1&quot;<br>    SUBSYSTEMS==&quot;scsi&quot;<br>    DRIVERS==&quot;&quot;<br><br>  looking at parent device &#x27;/devices/pci0000:00/0000:00:10.0/host20&#x27;:<br>    KERNELS==&quot;host20&quot;<br>    SUBSYSTEMS==&quot;scsi&quot;<br>    DRIVERS==&quot;&quot;<br><br>  looking at parent device &#x27;/devices/pci0000:00/0000:00:10.0&#x27;:<br>    KERNELS==&quot;0000:00:10.0&quot;<br>    SUBSYSTEMS==&quot;pci&quot;<br>    DRIVERS==&quot;mptspi&quot;<br>    ATTRS&#123;broken_parity_status&#125;==&quot;0&quot;<br>    ATTRS&#123;class&#125;==&quot;0x010000&quot;<br>    ATTRS&#123;config&#125;==&quot;&quot;<br>    ATTRS&#123;consistent_dma_mask_bits&#125;==&quot;32&quot;<br>    ATTRS&#123;d3cold_allowed&#125;==&quot;0&quot;<br>    ATTRS&#123;device&#125;==&quot;0x0030&quot;<br>    ATTRS&#123;dma_mask_bits&#125;==&quot;32&quot;<br>    ATTRS&#123;driver_override&#125;==&quot;(null)&quot;<br>    ATTRS&#123;enable&#125;==&quot;1&quot;<br>    ATTRS&#123;irq&#125;==&quot;17&quot;<br>    ATTRS&#123;local_cpulist&#125;==&quot;0-3&quot;<br>    ATTRS&#123;local_cpus&#125;==&quot;00000000,00000000,00000000,0000000f&quot;<br>    ATTRS&#123;msi_bus&#125;==&quot;1&quot;<br>    ATTRS&#123;numa_node&#125;==&quot;-1&quot;<br>    ATTRS&#123;revision&#125;==&quot;0x01&quot;<br>    ATTRS&#123;subsystem_device&#125;==&quot;0x1976&quot;<br>    ATTRS&#123;subsystem_vendor&#125;==&quot;0x15ad&quot;<br>    ATTRS&#123;vendor&#125;==&quot;0x1000&quot;<br><br>  looking at parent device &#x27;/devices/pci0000:00&#x27;:<br>    KERNELS==&quot;pci0000:00&quot;<br>    SUBSYSTEMS==&quot;&quot;<br>    DRIVERS==&quot;&quot;<br></code></pre></td></tr></table></figure><ol start="2"><li>ç¼–å†™.rulesæ–‡ä»¶çš„è§„åˆ™ï¼šè¿›å…¥&#x2F;etc&#x2F;udev&#x2F;rules.dæ–‡ä»¶å¤¹ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /etc/udev/rules.d<br></code></pre></td></tr></table></figure><p>æ–°å»ºæ–‡ä»¶10-usb.rulesï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi 10-usb.rules<br></code></pre></td></tr></table></figure><p>åœ¨10-usb.rulesæ–‡ä»¶ä¸­è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">KERNEL==&quot;sdb&quot;,SUBSYSTEM==&quot;block&quot;,ACTION==&quot;add&quot;,SYMLINK+=&quot;USB_link&quot;<br></code></pre></td></tr></table></figure><p>ç„¶åä¿å­˜ï¼Œé€€å‡ºã€‚</p><ol start="3"><li>ä½¿å¾—udevæ–‡ä»¶ç”Ÿæ•ˆçš„æ–¹æ³•ï¼šé€šå¸¸ï¼Œä½¿å¾—é…ç½®åçš„æ–‡ä»¶ç”Ÿæ•ˆï¼Œéœ€è¦é‡‡ç”¨çƒ­æ’æ‹”çš„æ–¹æ³•æ›´æ–°udevè§„åˆ™ï¼Œä¸è¿‡æœ‰æ›´ç®€å•çš„æ–¹æ³•å¦‚ä¸‹ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">udevadm test /sys/class/block/sdb<br></code></pre></td></tr></table></figure><p>4.ç»“æœå¦‚ä¸‹ï¼šåœ¨&#x2F;devæ–‡ä»¶å¤¹ä¸‹</p><img src="/2023/02/16/udev%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86/20201228214401604.png"><h2 id="7-çƒ­æ’æ‹”èƒ½è‡ªåŠ¨è®¾å¤‡ï¼Œå†·æ’æ‹”æ€ä¹ˆåŠï¼Ÿ"><a href="#7-çƒ­æ’æ‹”èƒ½è‡ªåŠ¨è®¾å¤‡ï¼Œå†·æ’æ‹”æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="7.çƒ­æ’æ‹”èƒ½è‡ªåŠ¨è®¾å¤‡ï¼Œå†·æ’æ‹”æ€ä¹ˆåŠï¼Ÿ"></a>7.çƒ­æ’æ‹”èƒ½è‡ªåŠ¨è®¾å¤‡ï¼Œå†·æ’æ‹”æ€ä¹ˆåŠï¼Ÿ</h2><p>ç”±äºå†·æ’æ‹”çš„è®¾å¤‡å¼€æœºæ—¶å°±å·²ç»å­˜åœ¨ï¼Œåœ¨udevå¯åŠ¨å‰å·²ç»è¢«æ’å…¥ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œsysfsä¸‹çš„è®¾å¤‡éƒ½å­˜åœ¨ueventæ–‡ä»¶ï¼Œå‘è¯¥æ–‡ä»¶å†™ä¸€ä¸ªâ€œaddâ€,å†…æ ¸ä¼šé‡æ–°å‘é€netlinkï¼Œä¹‹åudevå°±å¯ä»¥æ”¶åˆ°è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯äº†ï¼Œä»è€Œåˆ›å»º&#x2F;devä¸‹å¯¹åº”çš„è®¾å¤‡èŠ‚ç‚¹ã€‚</p><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul><li><a href="https://blog.csdn.net/chengziwang/article/details/111873757">https://blog.csdn.net/chengziwang/article/details/111873757</a></li><li><a href="https://gitee.com/low-level-of-logic/RaspberryPi/blob/master/docs/">https://gitee.com/low-level-of-logic/RaspberryPi/blob/master/docs/</a></li><li><a href="https://blog.csdn.net/woyimibayi/article/details/78320915">https://blog.csdn.net/woyimibayi/article/details/78320915</a></li><li><a href="http://m.wfuyu.com/server/23483.html">http://m.wfuyu.com/server/23483.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linuxå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Kernel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€å®éªŒã€‘/devç›®å½•æ— æ³•åŒæ—¶æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿ</title>
    <link href="/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    <url>/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="ã€å®éªŒã€‘-x2F-devç›®å½•æ— æ³•åŒæ—¶æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿ"><a href="#ã€å®éªŒã€‘-x2F-devç›®å½•æ— æ³•åŒæ—¶æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ã€å®éªŒã€‘&#x2F;devç›®å½•æ— æ³•åŒæ—¶æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿ"></a>ã€å®éªŒã€‘&#x2F;devç›®å½•æ— æ³•åŒæ—¶æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿ</h1><p>å…ˆä»‹ç»ä¸€ä¸‹æˆ‘çš„å¼€å‘æ¿ï¼ŒNXPçš„IMX6ULLï¼Œé‡Œé¢æ˜¯åŸç”Ÿçš„Linuxå†…æ ¸ï¼Œç‰ˆæœ¬ä¸º<code>4.1.5</code>ã€‚</p><p>ä¸‹é¢å¼€å§‹åšå®éªŒï¼Œè¯æ˜&#x2F;devç›®å½•æ— æ³•åŒæ—¶æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚</p><h2 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h2><p><strong>1.å¼€æœºåæŸ¥çœ‹å½“å‰çš„æŒ‚è½½çš„è®¾å¤‡</strong></p><img src="/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/image-20230215220652226.png" alt="image-20230215220652226" style="zoom:67%;"><blockquote><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶devtmpfså¤§å°ä¸º88.3M</p></blockquote><p><strong>2.å°è¯•æ‰‹åŠ¨æŒ‚è½½&#x2F;dev</strong></p><img src="/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/image-20230215220610703.png" alt="image-20230215220610703" style="zoom:67%;"><p>æˆ‘ä»¬çŸ¥é“tmpfsæŒ‚è½½åé»˜è®¤æ˜¯RAMçš„ä¸€åŠ</p><img src="/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/image-20230215220830308.png" alt="image-20230215220830308" style="zoom:67%;"><blockquote><p>å¯ä»¥å‘ç°devtmpfsè·Ÿéštmpfsä¸€èµ·åŠæˆäº†RAMçš„ä¸€åŠå¤§å°</p></blockquote><p><strong>3.å†æ¬¡ç¡®è®¤æŒ‚è½½æƒ…å†µ</strong></p><img src="/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/image-20230215220510027.png"><p><strong>4.æŸ¥çœ‹æ­¤æ—¶&#x2F;devç›®å½•æ˜¯å¦æ­£å¸¸</strong></p><img src="/2023/02/15/%E3%80%90%E5%AE%9E%E9%AA%8C%E3%80%91-dev%E7%9B%AE%E5%BD%95%E6%97%A0%E6%B3%95%E5%90%8C%E6%97%B6%E6%8C%82%E8%BD%BD%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/image-20230215221013735.png"><blockquote><p>æ­¤æ—¶&#x2F;devç›®å½•ä¸‹ä¸ºç©ºï¼Œè®¿é—®ä¸åˆ°ä»»ä½•ç›®å½•</p></blockquote><h2 id="å®éªŒç»“è®º"><a href="#å®éªŒç»“è®º" class="headerlink" title="å®éªŒç»“è®º"></a>å®éªŒç»“è®º</h2><p>é€šè¿‡å®éªŒæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><ul><li>å¯ä»¥åŒæ—¶ç»™<code>/dev</code>æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯æœ‰é—®é¢˜</li><li>å½“ç³»ç»Ÿä»¥<code>devtmpfs</code>æŒ‚è½½åï¼Œå†æ¬¡ä»¥<code>tmpfs</code>æŒ‚è½½åï¼Œ<code>devtmpfs</code>ä¼šéš<code>tmpfs</code>å¤§å°ä¸€èµ·å˜åŒ–ï¼Œå¦‚æœ<code>tmpfs</code>æŒ‚è½½æ—¶ä¸æŒ‡æ˜å¤§å°ï¼Œé»˜è®¤ä¸ºå†…å­˜çš„ä¸€åŠ</li><li>ç»™<code>/dev</code>æŒ‚è½½ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿåï¼Œ<code>/dev</code>ç›®å½•æ— æ³•æ­£å¸¸è®¿é—®</li></ul><p><strong>è¯´æ˜ï¼šæœ¬æ–‡æ°´å¹³æœ‰é™ï¼Œå¯èƒ½å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼Œè¯·æŒ‡æ­£ï¼</strong></p>]]></content>
    
    
    <categories>
      
      <category>Androidå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tmpfsæ–‡ä»¶ç³»ç»Ÿä¸å®‰å“</title>
    <link href="/2023/02/14/tmpfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%AE%89%E5%8D%93/"/>
    <url>/2023/02/14/tmpfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%AE%89%E5%8D%93/</url>
    
    <content type="html"><![CDATA[<h1 id="tmpfsæ–‡ä»¶ç³»ç»Ÿä¸å®‰å“"><a href="#tmpfsæ–‡ä»¶ç³»ç»Ÿä¸å®‰å“" class="headerlink" title="tmpfsæ–‡ä»¶ç³»ç»Ÿä¸å®‰å“"></a>tmpfsæ–‡ä»¶ç³»ç»Ÿä¸å®‰å“</h1><h2 id="1-ä»€ä¹ˆæ˜¯tmpfsæ–‡ä»¶ç³»ç»Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯tmpfsæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯tmpfsæ–‡ä»¶ç³»ç»Ÿ"></a>1.ä»€ä¹ˆæ˜¯tmpfsæ–‡ä»¶ç³»ç»Ÿ</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹Kernelæ–‡æ¡£å¯¹äºtmpfsæ–‡ä»¶ç³»ç»Ÿçš„æè¿°ï¼š<a href="https://www.kernel.org/doc/Documentation/filesystems/tmpfs.txt">https://www.kernel.org/doc/Documentation/filesystems/tmpfs.txt</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">Tmpfs is a file system <span class="hljs-built_in">which</span> keeps all files <span class="hljs-keyword">in</span> virtual memory.<br><br>Everything <span class="hljs-keyword">in</span> tmpfs is temporary <span class="hljs-keyword">in</span> the sense that no files will be created on your hard drive. If you unmount a tmpfs instance, everything stored there <span class="hljs-keyword">in</span> is lost.<br><br>tmpfs puts everything into the kernel internal caches and grows andshrinks to accommodate the files it contains and is able to swap unneeded pages out to swap space. It has maximum size limits <span class="hljs-built_in">which</span> can be adjusted on the fly via <span class="hljs-string">&#x27;mount -o remount ...&#x27;</span><br><br>If you compare it to ramfs (<span class="hljs-built_in">which</span> was the template to create tmpfs) you gain swapping and <span class="hljs-built_in">limit</span> checking. Another similar thing is the RAMdisk (/dev/ram*), <span class="hljs-built_in">which</span> simulates a fixed size hard disk <span class="hljs-keyword">in</span> physical RAM, <span class="hljs-built_in">where</span> you have to create an ordinary filesystem on top. Ramdisks cannot swap and you <span class="hljs-keyword">do</span> not have the possibility to resize them. <br></code></pre></td></tr></table></figure><ul><li><p>tmpfsæ˜¯ä¸€ä¸ªå°†æ‰€æœ‰æ–‡ä»¶ä¿å­˜åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p></li><li><p>tmpfsä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œå› ä¸ºä¸ä¼šåœ¨ç¡¬ç›˜ä¸Šåˆ›å»ºä»»ä½•æ–‡ä»¶ã€‚å¦‚æœå¸è½½tmpfså®ä¾‹ï¼Œå­˜å‚¨åœ¨å…¶ä¸­çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¸¢å¤±äº†</p></li><li><p>tmpfså°†æ‰€æœ‰å†…å®¹æ”¾å…¥å†…æ ¸å†…éƒ¨ç¼“å­˜ï¼Œå¹¶è¿›è¡Œå¢é•¿å’Œæ”¶ç¼©ä»¥å®¹çº³å…¶ä¸­åŒ…å«çš„æ–‡ä»¶ï¼Œå¹¶èƒ½å¤Ÿå°†ä¸éœ€è¦çš„é¡µé¢äº¤æ¢å‡ºæ¥ä»¥äº¤æ¢ç©ºé—´ã€‚å®ƒå…·æœ‰sizeé™åˆ¶ï¼Œå¯ä»¥é€šè¿‡â€œmount-o remountâ€¦â€è¿›è¡ŒåŠ¨æ€è°ƒæ•´</p></li><li><p>å¦‚æœå°†å…¶ä¸ramfsï¼ˆåˆ›å»ºtmpfsçš„æ¨¡æ¿ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™ä¼šè·å¾—äº¤æ¢å’Œé™åˆ¶æ£€æŸ¥ã€‚å¦ä¸€ä¸ªç±»ä¼¼çš„ä¸œè¥¿æ˜¯RAMdiskï¼ˆ&#x2F;dev&#x2F;ram*ï¼‰ï¼Œå®ƒåœ¨ç‰©ç†ramä¸­æ¨¡æ‹Ÿå›ºå®šå¤§å°çš„ç¡¬ç›˜ï¼Œæ‚¨å¿…é¡»åœ¨ä¸Šé¢åˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶ç³»ç»Ÿã€‚Ramdisksæ— æ³•äº’æ¢ï¼Œæ‚¨æ— æ³•è°ƒæ•´å…¶å¤§å°ã€‚</p></li></ul><p><strong>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹tmpfsçš„ç‰¹ç‚¹ï¼š</strong></p><ol><li>ç”±äºæ˜¯æ„å»ºåœ¨å†…å­˜ä¸­ï¼Œå­˜æ”¾åœ¨tmpfsä¸­çš„æ‰€æœ‰æ•°æ®åœ¨å¸è½½æˆ–è€…æ–­åä¸¢å¤±ã€‚ã€ä¸´æ—¶æ€§ã€‘</li><li>å†…å­˜çš„è®¿é—®é€Ÿåº¦è¿œè¿œå¤§äºç£ç›˜IOæ“ä½œï¼Œå³ä½¿ä½¿ç”¨äº†è™šæ‹Ÿå†…å­˜ï¼Œæ€§èƒ½ä»ç„¶ä¼˜äºç£ç›˜ã€‚ã€å¿«é€Ÿè¯»å†™ã€‘</li><li>tmpfsä¸€å¼€å§‹ä½¿ç”¨å¾ˆå°çš„ç©ºé—´ï¼Œä½†æ˜¯éšç€æ–‡ä»¶çš„å¤åˆ¶å’Œåˆ›å»ºï¼Œtmpfsæ–‡ä»¶ç³»ç»Ÿä¼šåˆ†é…æ›´å¤šçš„å†…å­˜ï¼Œå¹¶æŒ‰ç…§éœ€æ±‚åŠ¨æ€å¢åŠ æ–‡ä»¶ç³»ç»Ÿçš„ç©ºé—´ï¼Œè€Œä¸”tmpfsæ–‡ä»¶ç³»ç»Ÿä¼šåŠ¨æ€ç¼©å°æ–‡ä»¶å¹¶é‡Šæ”¾å†…å­˜èµ„æº</li><li>åƒæ™®é€šå—è®¾å¤‡éœ€è¦mkfsæ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿåæ‰å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯tmpfsæ˜¯ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œåªè¦æŒ‚è½½å°±å¯ä»¥ä½¿ç”¨ã€‚</li></ol><h2 id="2-Androidä¸­çš„tmpfsæ–‡ä»¶ç³»ç»Ÿ"><a href="#2-Androidä¸­çš„tmpfsæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="2.Androidä¸­çš„tmpfsæ–‡ä»¶ç³»ç»Ÿ"></a>2.Androidä¸­çš„tmpfsæ–‡ä»¶ç³»ç»Ÿ</h2><p>Androidä¸­æŒ‚è½½tmpfsæ–‡ä»¶ç³»ç»Ÿçš„æ—¶æœºä¸»è¦åœ¨å®‰å“initè¿›ç¨‹ä¸­çš„ç¬¬ä¸€é˜¶æ®µæŒ‚è½½å’Œç¬¬äºŒé˜¶æ®µæŒ‚è½½ã€åŸºäºAndroid Sã€‘</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">FirstStageMain</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> </span>&#123;<br><br>    <span class="hljs-built_in">CHECKCALL</span>(<span class="hljs-built_in">mount</span>(<span class="hljs-string">&quot;tmpfs&quot;</span>, <span class="hljs-string">&quot;/dev&quot;</span>, <span class="hljs-string">&quot;tmpfs&quot;</span>, MS_NOSUID, <span class="hljs-string">&quot;mode=0755&quot;</span>));<br>    <br>    <span class="hljs-built_in">CHECKCALL</span>(<span class="hljs-built_in">mount</span>(<span class="hljs-string">&quot;tmpfs&quot;</span>, <span class="hljs-string">&quot;/mnt&quot;</span>, <span class="hljs-string">&quot;tmpfs&quot;</span>, MS_NOEXEC | MS_NOSUID | MS_NODEV,<br>                    <span class="hljs-string">&quot;mode=0755,uid=0,gid=1000&quot;</span>));<br>    <br>    <span class="hljs-built_in">CHECKCALL</span>(<span class="hljs-built_in">mount</span>(<span class="hljs-string">&quot;tmpfs&quot;</span>, <span class="hljs-string">&quot;/debug_ramdisk&quot;</span>, <span class="hljs-string">&quot;tmpfs&quot;</span>, MS_NOEXEC | MS_NOSUID | MS_NODEV,<br>                    <span class="hljs-string">&quot;mode=0755,uid=0,gid=0&quot;</span>));<br>    <br>    <span class="hljs-built_in">CHECKCALL</span>(<span class="hljs-built_in">mount</span>(<span class="hljs-string">&quot;tmpfs&quot;</span>, kSecondStageRes, <span class="hljs-string">&quot;tmpfs&quot;</span>, MS_NOEXEC | MS_NOSUID | MS_NODEV,<br>                    <span class="hljs-string">&quot;mode=0755,uid=0,gid=0&quot;</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br># --------------------------------------------------------------------------------------<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">SecondStageMain</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> </span>&#123;<br>    <span class="hljs-built_in">MountExtraFilesystems</span>();<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">MountExtraFilesystems</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-comment">// /apex is used to mount APEXes</span><br>    <span class="hljs-built_in">CHECKCALL</span>(<span class="hljs-built_in">mount</span>(<span class="hljs-string">&quot;tmpfs&quot;</span>, <span class="hljs-string">&quot;/apex&quot;</span>, <span class="hljs-string">&quot;tmpfs&quot;</span>, MS_NOEXEC | MS_NOSUID | MS_NODEV,<br>                    <span class="hljs-string">&quot;mode=0755,uid=0,gid=0&quot;</span>));<br><br>    <span class="hljs-comment">// /linkerconfig is used to keep generated linker configuration</span><br>    <span class="hljs-built_in">CHECKCALL</span>(<span class="hljs-built_in">mount</span>(<span class="hljs-string">&quot;tmpfs&quot;</span>, <span class="hljs-string">&quot;/linkerconfig&quot;</span>, <span class="hljs-string">&quot;tmpfs&quot;</span>, MS_NOEXEC | MS_NOSUID | MS_NODEV,<br>                    <span class="hljs-string">&quot;mode=0755,uid=0,gid=0&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®‰å“çœŸå®è¿è¡Œç¯å¢ƒä¸­çš„æŒ‚è½½æƒ…å†µ</p><img src="/2023/02/14/tmpfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%AE%89%E5%8D%93/image-20230214223605505.png" style="zoom:80%;"><p>ğŸ–ã€ä¸ªäººçŒœæƒ³ã€‘ä¸ºä»€ä¹ˆç±»ä¼¼&#x2F;devï¼Œ&#x2F;apexè¿™ç§éœ€è¦ä½¿ç”¨tmpfsæ–‡ä»¶ç³»ç»Ÿï¼š</p><ul><li>åƒå®‰å“çš„è®¾å¤‡åˆ›å»ºåéƒ½åœ¨&#x2F;devç›®å½•ä¸‹ï¼Œé©±åŠ¨ä¼šä»¥&#x2F;dev&#x2F;xxxçš„æ–‡ä»¶å½¢å¼å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿå¤§é‡çš„IOæ“ä½œï¼Œæ˜¾ç„¶ä½¿ç”¨tmpfsæ›´å¿«</li><li>åƒARTï¼ŒVNDKç­‰éƒ½å­˜åœ¨äº&#x2F;apexä¸­ï¼Œå®‰å“å¯åŠ¨çš„æ—¶å€™è™šæ‹ŸæœºARTåˆ›å»ºéƒ½åœ¨&#x2F;apexä¸­</li></ul><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul><li><a href="https://www.bilibili.com/video/BV1HG4y1K76E/">https://www.bilibili.com/video/BV1HG4y1K76E/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linuxå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹åŠ¨æŒ‚è½½apexåŒ…åˆ°loopè®¾å¤‡</title>
    <link href="/2023/02/04/%E6%89%8B%E5%8A%A8%E6%8C%82%E8%BD%BDapex%E5%8C%85%E5%88%B0loop%E8%AE%BE%E5%A4%87/"/>
    <url>/2023/02/04/%E6%89%8B%E5%8A%A8%E6%8C%82%E8%BD%BDapex%E5%8C%85%E5%88%B0loop%E8%AE%BE%E5%A4%87/</url>
    
    <content type="html"><![CDATA[<h1 id="ã€å®éªŒã€‘æ‰‹åŠ¨æŒ‚è½½apexé•œåƒ"><a href="#ã€å®éªŒã€‘æ‰‹åŠ¨æŒ‚è½½apexé•œåƒ" class="headerlink" title="ã€å®éªŒã€‘æ‰‹åŠ¨æŒ‚è½½apexé•œåƒ"></a>ã€å®éªŒã€‘æ‰‹åŠ¨æŒ‚è½½apexé•œåƒ</h1><h2 id="1-loopè®¾å¤‡"><a href="#1-loopè®¾å¤‡" class="headerlink" title="1.loopè®¾å¤‡"></a>1.loopè®¾å¤‡</h2><p>åœ¨ç±» UNIX ç³»ç»Ÿé‡Œï¼Œloop è®¾å¤‡æ˜¯ä¸€ç§ä¼ªè®¾å¤‡(pseudo-device)ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è¯´æ˜¯ä»¿çœŸè®¾å¤‡ã€‚å®ƒèƒ½ä½¿æˆ‘ä»¬åƒå—è®¾å¤‡ä¸€æ ·è®¿é—®ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>è¿™è¦å…ˆä»mountçš„æµç¨‹æ¥ç†è§£ï¼ŒæŒ‚è½½æ“ä½œï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠè®¾å¤‡ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿ&#x2F;ç›®å½•æ–‡ä»¶è¿æ¥åˆ°æŒ‡å®šçš„ç›®å½•ï¼ˆdirectoryï¼‰ä¸‹ï¼Œåœ¨æ“ä½œç³»ç»Ÿå±‚é¢å°±æ˜¯æŠŠæŒ‚è½½è®¾å¤‡å’ŒæŒ‚è½½ç›®å½•çš„å¯¹åº”å…³ç³»åŠ åˆ°å†…æ ¸ä¸­çš„Vfsmounté‡Œçš„å¯¹åº”è¡¨å•é‡Œï¼ˆå†…æ ¸å¯åŠ¨åä¼šä»ç¡¬ç›˜ä¸ŠåŠ è½½åˆ°å†…å­˜é‡Œï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—®ç›®å½•è·¯å¾„æ¥è®¿é—®è®¾å¤‡ä¸Šçš„æ•°æ®äº†ã€‚</p><p>loop mountæ˜¯å¦ä¸€ç§mountæ–¹å¼ï¼Œå¦‚æœè¯´æ™®é€šmountè§£å†³äº†å®é™…ç¡¬ä»¶å­˜å‚¨è®¾å¤‡çš„æŒ‚è½½ï¼Œbind mountè§£å†³äº†ç›®å½•åˆ°ç›®å½•çš„æŒ‚è½½ï¼Œé‚£ä¹ˆloop mountåˆ™è§£å†³äº†å°†<strong>æ¡£æ¡ˆæ–‡ä»¶</strong>åˆ°ç›®å½•çš„æŒ‚è½½</p><p>æ¡£æ¡ˆï¼Œè‹±æ–‡Archiveï¼Œä¸æ–‡ä»¶ï¼ˆfileï¼‰ä¸åŒï¼Œæ˜¯ä¸€ä¸ªæ‰“åŒ…å¥½çš„æ–‡ä»¶é›†ï¼Œé‡Œé¢ä¸€èˆ¬åŒ…å«è®¸å¤šæ–‡ä»¶, æ¯”å¦‚ tarï¼Œjarï¼Œiso ï¼Œimgå°±æ˜¯å¸¸è§çš„æ¡£æ¡ˆæ ¼å¼</p><p>é‚£åˆæ˜¯æ€ä¹ˆå®ç°å°†æ¡£æ¡ˆæ–‡ä»¶æŒ‚è½½åˆ°ç›®å½•ä¸‹å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs she">å®é™…ä¸Šï¼Œç³»ç»Ÿå…ˆæŠŠæ¡£æ¡ˆæ–‡ä»¶ï¼ˆæ¯”å¦‚æŸä¸ª.isoæ–‡ä»¶ï¼‰æ˜ å°„åˆ°loopè®¾å¤‡ä¸Š<br>#losetup  /dev/loop0   xxxx.iso        ä½¿ç³»ç»Ÿè¯¯è®¤ä¸ºxxxx.isoä¸ºå­˜å‚¨è®¾å¤‡/dev/loop0<br><br>å†æ¬ºéª—mountå‘½ä»¤ï¼Œä½¿ä»–è®¤ä¸º  /dev/loop0çœŸçš„æ˜¯ä¸ªè®¾å¤‡åœ¨è¿è¡Œï¼ŒæŒ‚è½½åˆ°æŒ‡å®šç›®å½•<br>#mount   -t   xxxx.iso   /dev/loop0    /loopè®¾å¤‡è·¯å¾„    <br><br></code></pre></td></tr></table></figure><p>ä½†å‰ææ˜¯ï¼Œè¢«è®¿é—®çš„loopè®¾å¤‡é‡Œçš„æ¡£æ¡ˆæ–‡ä»¶å…·æœ‰linuxè¯†åˆ«çš„æ–‡ä»¶ç³»ç»Ÿï¼Œåƒtar, jar, zip è¿™æ ·çš„æ¡£æ¡ˆï¼Œåªæ˜¯ä¸€ç§å‹ç¼©æ ¼å¼ï¼Œæœ¬èº«ä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå³ä½¿é€šè¿‡loop mountæŒ‚è½½ä¸Šå»äº†ï¼Œç›´æ¥è®¿é—®ä»–ä¹Ÿè¯»ä¸å‡ºä»€ä¹ˆæ•°æ®ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œå°±åƒåœ¨windowsä¸‹ä¸è£…ä»»ä½•è§£å‹è½¯ä»¶ï¼Œå°±æ— æ³•æ‰“å¼€å‹ç¼©æ–‡ä»¶ä¸€æ ·ã€‚<u><strong>æ‰€æœ‰ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯æ‹¿imgã€isoæ˜ å°„åˆ°loopè®¾å¤‡ã€‚</strong></u></p><h2 id="2-apexåŒ…ç»“æ„"><a href="#2-apexåŒ…ç»“æ„" class="headerlink" title="2.apexåŒ…ç»“æ„"></a>2.apexåŒ…ç»“æ„</h2><p>APEXæ–‡ä»¶æ ¼å¼å¦‚ä¸‹</p><img src="/2023/02/04/%E6%89%8B%E5%8A%A8%E6%8C%82%E8%BD%BDapex%E5%8C%85%E5%88%B0loop%E8%AE%BE%E5%A4%87/20200601191934566.png"><p>ä»é¡¶å±‚çœ‹ï¼ŒAPEXæ–‡ä»¶æ˜¯ä¸€ä¸ªZipæ–‡ä»¶ï¼Œå…¶ä¸­çš„æ–‡ä»¶å‡æ˜¯æœªå‹ç¼©çš„ã€‚</p><p>å…¶ä¸­çš„å››ä¸ªæ–‡ä»¶æœ‰<code>apex_manifest.json</code>ï¼Œ<code>AndroidManifest.xml</code>ï¼Œ<code>apex_pubkey</code>ï¼Œ<code>apex_payload.img</code></p><ul><li><p>apex_manifest.jsonæ–‡ä»¶åŒ…æ‹¬package nameå’Œç‰ˆæœ¬ï¼Œç”¨æ¥æ ‡è¯†è¯¥APEXæ–‡ä»¶</p></li><li><p>AndroidManifest.xmlå¯ä»¥å…è®¸APEXæ–‡ä»¶ä½¿ç”¨ä¸€äº›apkçš„å·¥å…·ï¼Œåƒadbã€package managerã€ app install appç­‰ã€‚ä¸¾ä¸ªä¾‹å­APEXæ–‡ä»¶å¯ä»¥ä½¿ç”¨aaptæ£€æŸ¥æ–‡ä»¶çš„metadataã€‚è¯¥æ–‡ä»¶è¿˜åŒ…æ‹¬packcage nameå’Œç‰ˆæœ¬å·ï¼Œè¿™äº›å†…å®¹é€šå¸¸ä¹Ÿä¼šå†apex_manifest.jsonæ–‡ä»¶ä¸­ã€‚</p></li><li><p>apex_payload.imgæ˜¯ä¾èµ–dm-verityçš„EXT4æ–‡ä»¶ç³»ç»Ÿé•œåƒã€‚è¯¥é•œåƒåœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªå›ç¯è®¾å¤‡åŠ è½½ã€‚å…·ä½“åœ°è¯´ï¼Œmetadataå’Œhash treeæ˜¯é€šè¿‡libavbåˆ›å»ºçš„ã€‚apex_payload.imgè¿˜æ²¡æœ‰è¢«è§£æï¼Œå› ä¸ºè¦æ±‚è¯¥æ–‡ä»¶æ˜¯å¯æŒ‚è½½çš„ã€‚ä¸€äº›å¸¸è§„æ–‡ä»¶åŒ…å«åœ¨è¯¥é•œåƒä¸­ã€‚</p></li><li><p>apex_pubkeyæ˜¯ç”¨æ¥ç»™æ–‡ä»¶ç³»ç»Ÿç­¾åçš„å…¬é’¥ã€‚è¯¥å…¬é’¥ç¡®ä¿ä¸‹è½½çš„apexæ–‡ä»¶æ˜¯ä»¥ç¼–è¯‘é˜¶æ®µç›¸åŒçš„æ–¹å¼ç­¾åã€‚</p></li></ul><h2 id="3-å¼€å§‹å®éªŒ"><a href="#3-å¼€å§‹å®éªŒ" class="headerlink" title="3.å¼€å§‹å®éªŒ"></a>3.å¼€å§‹å®éªŒ</h2><ol><li><p><strong>å°†apexè§£å‹ç¼©ï¼Œä¸Šä¼ åˆ°Linuxä¸­</strong></p><img src="/2023/02/04/%E6%89%8B%E5%8A%A8%E6%8C%82%E8%BD%BDapex%E5%8C%85%E5%88%B0loop%E8%AE%BE%E5%A4%87/image-20230204111723539.png"></li></ol><p>å…¶å®apexåŒ…å°±æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œå°†åç¼€åæ”¹æˆ<code>.zip</code>ï¼Œè‡ªè¡Œä½¿ç”¨Windowsè§£å‹å·¥å…·è¿›è¡Œè§£å‹</p><p><strong>ä¸Šä¼ åæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹å®ƒçš„æ–‡ä»¶ç»“æ„å’Œå®ƒçš„æ–‡ä»¶ç³»ç»Ÿå±æ€§</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">amx@amxxxx:~/Android/system$ file apex_payload.img <br>apex_payload.img: Linux rev 1.0 ext2 filesystem data, UUID=7d1522e1-9dfa-5edb-a43e-98e3a4d20250 (extents) (large files) (huge files)<br><br>amx@amxxxx:~/Android/system$ tune2fs -l apex_payload.img <br>tune2fs 1.44.5 (15-Dec-2018)<br>Filesystem volume name:   &lt;none&gt;<br>Last mounted on:          &lt;not available&gt;<br>Filesystem UUID:          7d1522e1-9dfa-5edb-a43e-98e3a4d20250<br>Filesystem magic number:  0xEF53<br>Filesystem revision <span class="hljs-comment">#:    1 (dynamic)</span><br>Filesystem features:      ext_attr dir_index filetype extent sparse_super large_file huge_file uninit_bg dir_nlink extra_isize shared_blocks<br>Filesystem flags:         signed_directory_hash <br>Default mount options:    user_xattr acl<br>Filesystem state:         clean<br>Errors behavior:          Continue<br>Filesystem OS <span class="hljs-built_in">type</span>:       Linux<br>Inode count:              32<br>Block count:              8213<br>Reserved block count:     0<br>Free blocks:              8<br>Free inodes:              5<br>First block:              0<br>Block size:               4096<br>Fragment size:            4096<br>Blocks per group:         32768<br>Fragments per group:      32768<br>Inodes per group:         32<br>Inode blocks per group:   2<br>Filesystem created:       Thu Jan  1 08:00:01 1970<br>Last mount time:          n/a<br>Last write time:          Thu Jan  1 08:00:01 1970<br>Mount count:              0<br>Maximum mount count:      -1<br>Last checked:             Thu Jan  1 08:00:01 1970<br>Check interval:           0 (&lt;none&gt;)<br>Lifetime writes:          32 MB<br>Reserved blocks uid:      0 (user root)<br>Reserved blocks gid:      0 (group root)<br>First inode:              11<br>Inode size:               256<br>Required extra isize:     32<br>Desired extra isize:      32<br>Default directory <span class="hljs-built_in">hash</span>:   half_md4<br>Directory Hash Seed:      7d1522e1-9dfa-5edb-a43e-98e3a4d20250<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>æŸ¥çœ‹å½“å‰ç©ºé—²çš„loopè®¾å¤‡</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">amx@amxxxx:~/Android/system$ sudo losetup -f<br>/dev/loop0<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“å‰ç©ºé—²çš„loopè®¾å¤‡ä¸º<code>/dev/loop0</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“ç®—å°†apexä¸&#x2F;dev&#x2F;loop0è¿›è¡Œå…³è”</p><ol start="3"><li><strong>å°†apexé•œåƒä¸loopè®¾å¤‡å…³è”</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">amx@amxxxx:~/Android/system$ sudo losetup /dev/loop0 apex_payload.img<br></code></pre></td></tr></table></figure><ol start="4"><li><strong>å°†loopè®¾å¤‡æŒ‚è½½åˆ°ç›®æ ‡èŠ‚ç‚¹ä¸Š</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">amx@amxxxx:~/Android/system$ sudo mount -o ro /dev/loop0 /home/amx/Android/apex/com.android.i18n<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æ¨¡ä»¿äº†å®‰å“å°†å®ƒæŒ‚è½½åˆ°äº†<code>/home/amx/Android/apex/com.android.i18n</code></p><blockquote><p>è¿™é‡Œåªèƒ½ä½¿ç”¨roåªè¯»å½¢å¼æŒ‚è½½ï¼Œå› ä¸ºapex_playload.imgé‡‡ç”¨äº†ext4æ–‡ä»¶ç³»ç»Ÿï¼Œä¸”åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ äº†<code>shared_block</code>å±æ€§ï¼Œè¯¥å±æ€§ä¸å…è®¸éšæ„ä¿®æ”¹é•œåƒæ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸ºäº†å°†é•œåƒæ–‡ä»¶å°½é‡å‹ç¼©åˆ°æœ€å°ï¼ˆä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥å…±äº«å—ï¼‰ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡æ”¹å˜inodeç»“æ„æ”¹å˜è¿™ä¸ªå±æ€§ï¼Œä½†æ˜¯æœ‰ç‚¹éš¾åº¦ï¼Œéœ€è¦äº†è§£extæ–‡ä»¶ç³»ç»Ÿæ‰è¡Œã€‚</p></blockquote><ol start="5"><li><strong>æŸ¥çœ‹æ˜¯å¦æŒ‚è½½æˆåŠŸ</strong></li></ol><img src="/2023/02/04/%E6%89%8B%E5%8A%A8%E6%8C%82%E8%BD%BDapex%E5%8C%85%E5%88%B0loop%E8%AE%BE%E5%A4%87/image-20230204111215939.png"><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥åƒè®¿é—®å—è®¾å¤‡ä¸€æ ·è®¿é—®apexåŒ…å•¦</p><ol start="6"><li><strong>è¯´æ˜</strong></li></ol><p>çœŸå®çš„å®‰å“ç¯å¢ƒä¸­æ˜¯å…ˆsystem&#x2F;apexä¸‹é¢çš„apexåŒ…æŒ‚è½½åˆ°å¯¹åº”çš„ç‰ˆæœ¬ç›®å½•ä¸‹ï¼Œä¾‹å¦‚adbä¼šå…ˆæŒ‚è½½åˆ°<code>/apex/com.android.adb@300009</code>ï¼Œç„¶åå†å°†<code>/apex/com.android.adb@300009</code>ä»¥bindæ–¹å¼æŒ‚è½½åˆ°<code>/apex/com.android.adb</code></p><h2 id="4-å‚è€ƒ"><a href="#4-å‚è€ƒ" class="headerlink" title="4.å‚è€ƒ"></a>4.å‚è€ƒ</h2><ul><li><a href="https://blog.csdn.net/shengxia1999/article/details/52081286?spm=1001.2014.3001.5506">https://blog.csdn.net/shengxia1999/article/details/52081286?spm=1001.2014.3001.5506</a></li><li><a href="https://blog.csdn.net/qq_28351465/article/details/106458089?spm=1001.2014.3001.5506">https://blog.csdn.net/qq_28351465/article/details/106458089?spm=1001.2014.3001.5506</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å®‰å“å¼€æœºåŠ¨ç”»</title>
    <link href="/2023/01/25/%E5%AE%89%E5%8D%93%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB/"/>
    <url>/2023/01/25/%E5%AE%89%E5%8D%93%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="å®‰å“Så¼€æœºåŠ¨ç”»æµç¨‹"><a href="#å®‰å“Så¼€æœºåŠ¨ç”»æµç¨‹" class="headerlink" title="å®‰å“Så¼€æœºåŠ¨ç”»æµç¨‹"></a>å®‰å“Så¼€æœºåŠ¨ç”»æµç¨‹</h1><p>å¼€æœºåŠ¨ç”»æ˜¯<strong>åœ¨SurfaceFlingerå®ä¾‹é€šè¿‡è°ƒç”¨startBootAnim()å¯åŠ¨çš„</strong>ï¼ŒBootAnimæ˜¯å¦‚ä½•å¯åŠ¨å’Œç»“æŸçš„ï¼Œæ€»ä½“æ¡†æ¶å›¾å¦‚ä¸‹ï¼š</p><img src="/2023/01/25/%E5%AE%89%E5%8D%93%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB/æ•´ä½“æ¶æ„2.png"><h2 id="1-SurfaceFlingerè¿›ç¨‹å¯åŠ¨"><a href="#1-SurfaceFlingerè¿›ç¨‹å¯åŠ¨" class="headerlink" title="1.SurfaceFlingerè¿›ç¨‹å¯åŠ¨"></a>1.SurfaceFlingerè¿›ç¨‹å¯åŠ¨</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/frameworks/native/services/surfaceflinger/surfaceflinger.rc</span><br>service surfaceflinger /system/bin/surfaceflinger<br>    class core animation<br>    user system<br>    group graphics drmrpc readproc<br>    capabilities SYS_NICE<br>    onrestart restart zygote<br>    task_profiles HighPerformance<br>    socket pdx/system/vr/display/client     stream 0666 system graphics u:object_r:pdx_display_client_endpoint_socket:s0<br>    socket pdx/system/vr/display/manager    stream 0666 system graphics u:object_r:pdx_display_manager_endpoint_socket:s0<br>    socket pdx/system/vr/display/vsync      stream 0666 system graphics u:object_r:pdx_display_vsync_endpoint_socket:s0<br><br></code></pre></td></tr></table></figure><p>initè¿›ç¨‹ä¼šæ ¹æ®surfaceflinger.rcé…ç½®å¯åŠ¨surfaceflingerè¿›ç¨‹ï¼Œsurfaceflingerè¿›ç¨‹(&#x2F;system&#x2F;bin&#x2F;surfaceflinger)å¯åŠ¨ï¼Œä¼šèµ°åˆ°mainå‡½æ•°é‡Œé¢ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/frameworks/native/services/surfaceflinger/Android.bp</span><br>filegroup &#123;<br>    name: &quot;surfaceflinger_binary_sources&quot;,<br>    srcs: [<br>        &quot;:libsurfaceflinger_sources&quot;,<br>        &quot;main_surfaceflinger.cpp&quot;,<br>    ],<br>&#125;<br><br>cc_binary &#123;<br>    name: &quot;surfaceflinger&quot;,<br>    defaults: [&quot;libsurfaceflinger_binary&quot;],<br>    init_rc: [&quot;surfaceflinger.rc&quot;],<br>    srcs: [<br>        &quot;:surfaceflinger_binary_sources&quot;,<br>        // Note: SurfaceFlingerFactory is not in the filegroup so that it<br>        // can be easily replaced.<br>        &quot;SurfaceFlingerFactory.cpp&quot;,<br>    ],<br>    shared_libs: [<br>        &quot;libSurfaceFlingerProp&quot;,<br>    ],<br><br>     logtags: [&quot;EventLog/EventLogTags.logtags&quot;],<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¼–è¯‘surfaceflingeräºŒè¿›åˆ¶è¿›ç¨‹çš„æºæ–‡ä»¶ä¸º<code>surfaceflinger_binary_sources</code>å’Œ<code>SurfaceFlingerFactory.cpp</code>ï¼Œå…¶ä¸­surfaceflinger_binary_sourcesæ¥æºäº<code>main_surfaceflinger.cpp</code></p><h2 id="2-æ³¨å†Œå¯åŠ¨surfaceflingeræœåŠ¡"><a href="#2-æ³¨å†Œå¯åŠ¨surfaceflingeræœåŠ¡" class="headerlink" title="2.æ³¨å†Œå¯åŠ¨surfaceflingeræœåŠ¡"></a>2.æ³¨å†Œå¯åŠ¨surfaceflingeræœåŠ¡</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// /frameworks/native/services/surfaceflinger/main_surfaceflinger.cpp</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">char</span>**)</span> </span>&#123;<br><span class="hljs-comment">// ...</span><br><br>    sp&lt;SurfaceFlinger&gt; flinger = surfaceflinger::<span class="hljs-built_in">createSurfaceFlinger</span>(); <span class="hljs-comment">//åˆ›å»ºsurfaceflingeræœåŠ¡å®ä¾‹</span><br><br><span class="hljs-comment">// ...</span><br>    flinger-&gt;<span class="hljs-built_in">init</span>();  <span class="hljs-comment">// åˆå§‹åŒ–flingerå®ä¾‹</span><br><br>    <span class="hljs-comment">// å‘ServiceManageræ³¨å†ŒsurfaceflingeræœåŠ¡</span><br>    <span class="hljs-function">sp&lt;IServiceManager&gt; <span class="hljs-title">sm</span><span class="hljs-params">(defaultServiceManager())</span></span>;<br>    sm-&gt;<span class="hljs-built_in">addService</span>(<span class="hljs-built_in">String16</span>(SurfaceFlinger::<span class="hljs-built_in">getServiceName</span>()), flinger, <span class="hljs-literal">false</span>,<br>                   IServiceManager::DUMP_FLAG_PRIORITY_CRITICAL | IServiceManager::DUMP_FLAG_PROTO);<br><br><span class="hljs-comment">// ...</span><br><br>    flinger-&gt;<span class="hljs-built_in">run</span>();   <span class="hljs-comment">// å¯åŠ¨surfaceflingeræœåŠ¡</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨SurfaceFlingerå¯¹è±¡çš„initæ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// /frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SurfaceFlinger::init</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    mStartPropertySetThread = <span class="hljs-built_in">getFactory</span>().<span class="hljs-built_in">createStartPropertySetThread</span>(presentFenceReliable);<br><br>    <span class="hljs-keyword">if</span> (mStartPropertySetThread-&gt;<span class="hljs-built_in">Start</span>() != NO_ERROR) &#123;<br>        <span class="hljs-built_in">ALOGE</span>(<span class="hljs-string">&quot;Run StartPropertySetThread failed!&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">ALOGV</span>(<span class="hljs-string">&quot;Done initializing&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>SurfaceFlingerè°ƒç”¨initæ–¹æ³•æ—¶ä¼šè·å–mStartPropertySetThreadï¼Œè°ƒç”¨è¯¥å¯¹è±¡çš„Startæ–¹æ³•ï¼Œå…¶å®æ˜¯å‡†å¤‡å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»å¯åŠ¨BootAnimation</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// /frameworks/native/services/surfaceflinger/StartPropertySetThread.cpp</span><br><span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">StartPropertySetThread::Start</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">run</span>(<span class="hljs-string">&quot;SurfaceFlinger::StartPropertySetThread&quot;</span>, PRIORITY_NORMAL);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">StartPropertySetThread::threadLoop</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Set property service.sf.present_timestamp, consumer need check its readiness</span><br>    <span class="hljs-built_in">property_set</span>(kTimestampProperty, mTimestampPropertyValue ? <span class="hljs-string">&quot;1&quot;</span> : <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-comment">// æ¸…é™¤BootAnimationé€€å‡ºæ ‡å¿—ä½service.bootanim.exit</span><br>    <span class="hljs-built_in">property_set</span>(<span class="hljs-string">&quot;service.bootanim.exit&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-comment">// è®¾ç½®bootanimçš„è¿›åº¦ä¸º0</span><br>    <span class="hljs-built_in">property_set</span>(<span class="hljs-string">&quot;service.bootanim.progress&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-comment">// é€šè¿‡service.bootanim.exit</span><br>    <span class="hljs-built_in">property_set</span>(<span class="hljs-string">&quot;ctl.start&quot;</span>, <span class="hljs-string">&quot;bootanim&quot;</span>);<br>    <span class="hljs-comment">// ç«‹å³é€€å‡º</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¿™é‡Œä¸€å¼€å§‹çœ‹èµ·æ¥æ¯”è¾ƒç–‘æƒ‘ï¼Œé¦–å…ˆæ˜¯StartPropertySetThread::Startå‡½æ•°ï¼Œåœ¨<code>StartPropertySetThread.h</code>è¡¨æ˜StartPropertySetThreadç»§æ‰¿è‡ªçˆ¶ç±»Threadï¼Œè€Œçˆ¶ç±»Threadæ˜¯ç”±&lt;utils&#x2F;Thread.h&gt; å¼•å…¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å­ç±»å¼•ç”¨çˆ¶ç±»æ–¹æ³•ï¼Œè¿™é‡Œçš„runå‡½æ•°å°±æ˜¯å°±æ˜¯threadçš„runæ–¹æ³•ã€‚è¿™é‡Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»è¿è¡Œï¼Œçº¿ç¨‹åä¸ºâ€StartPropertySetThreadâ€ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§ä¸ºPRIORITY_NORMALã€‚çº¿ç¨‹å¯åŠ¨ä»¥åï¼Œæœ€ç»ˆä¼šè°ƒç”¨ <code>_threadLoop</code> å‡½æ•°ï¼Œå®ƒä¼šå»è°ƒç”¨threadLoopå‡½æ•°ã€‚è¿™é‡Œæ•´ä¸ªå‡½æ•°è°ƒç”¨æ ˆå°±æ¸…æ¥šäº†ï¼š</li></ul><img src="/2023/01/25/%E5%AE%89%E5%8D%93%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB/çº¿ç¨‹å‡½æ•°è°ƒç”¨.png"><ul><li>å½“ç³»ç»Ÿå±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œinitè¿›ç¨‹å°±ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿå±æ€§å˜åŒ–é€šçŸ¥ï¼Œè¿™ä¸ªé€šçŸ¥æœ€ç»ˆæ˜¯ç”±åœ¨initè¿›ç¨‹ä¸­çš„å‡½æ•°handle_property_set_fdæ¥å¤„ç†</li></ul><h2 id="3-bootanimè¿›ç¨‹å¯åŠ¨"><a href="#3-bootanimè¿›ç¨‹å¯åŠ¨" class="headerlink" title="3.bootanimè¿›ç¨‹å¯åŠ¨"></a>3.bootanimè¿›ç¨‹å¯åŠ¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// /frameworks/base/cmds/bootanimation/bootanimation_main.cpp</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    setpriority(PRIO_PROCESS, <span class="hljs-number">0</span>, ANDROID_PRIORITY_DISPLAY);<br><br>    <span class="hljs-type">bool</span> noBootAnimation = bootAnimationDisabled();<br>    ALOGI_IF(noBootAnimation,  <span class="hljs-string">&quot;boot animation disabled&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!noBootAnimation) &#123;<br>        <span class="hljs-comment">// å¯åŠ¨Binderçº¿ç¨‹æ± </span><br>        sp&lt;ProcessState&gt; <span class="hljs-title function_">proc</span><span class="hljs-params">(ProcessState::self())</span>;<br>        ProcessState::self()-&gt;startThreadPool();<br>        <br>        sp&lt;BootAnimation&gt; boot = new BootAnimation(audioplay::createAnimationCallbacks());<br><br>        waitForSurfaceFlinger();<br>        <br>        boot-&gt;run(<span class="hljs-string">&quot;BootAnimation&quot;</span>, PRIORITY_DISPLAY);<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">bootAnimationDisabled</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> value[PROPERTY_VALUE_MAX];<br>    <span class="hljs-comment">// å¦‚æœdebug.sf.nobootanimation=1ï¼Œåˆ™ä¸ä¼šæ˜¾ç¤ºåŠ¨ç”»</span><br>    property_get(<span class="hljs-string">&quot;debug.sf.nobootanimation&quot;</span>, value, <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-keyword">if</span> (atoi(value) &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><span class="hljs-comment">// å¦‚æœro.boot.quiescent=1ï¼Œåˆ™ä¸æ˜¾ç¤ºå¼€æœºåŠ¨ç”»</span><br>    property_get(<span class="hljs-string">&quot;ro.boot.quiescent&quot;</span>, value, <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-keyword">if</span> (atoi(value) &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// Only show the bootanimation for quiescent boots if this system property is set to enabled</span><br>        <span class="hljs-keyword">if</span> (!property_get_bool(<span class="hljs-string">&quot;ro.bootanim.quiescent.enabled&quot;</span>, <span class="hljs-literal">false</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ¤æ–­å®ŒBootAnimationæ˜¯ä¸æ˜¯disabledä¹‹åï¼Œå¦‚æœnoBootAnimationä¸ºfalseï¼Œåˆ™åˆ›å»ºä¸€ä¸ªBootAnimationå¯¹è±¡ã€‚åˆ›å»ºå®Œäº†BootAnimationå¯¹è±¡åï¼Œè°ƒç”¨å…¶runæ–¹æ³•ï¼Œç”±äºBootAnimationä¹Ÿç»§æ‰¿äº†Threadï¼Œæ‰€ä»¥æœ€ç»ˆä¹Ÿä¼šèµ°åˆ°å¯¹åº”çš„threadLoopæ–¹æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">BootAnimation::threadLoop</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">bool</span> r;<br><br>    <span class="hljs-keyword">if</span> (mZipFileName == <span class="hljs-literal">NULL</span>) &#123;<br>        ...<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        r = <span class="hljs-built_in">movie</span>();  <span class="hljs-comment">// è°ƒç”¨movieæ–¹æ³•</span><br>    &#125;<br>    <span class="hljs-comment">// é”€æ¯ opengl å’Œ egl</span><br>    <span class="hljs-built_in">eglMakeCurrent</span>(mDisplay, EGL_NO_SURFACE, EGL_NO_SURFACE, EGL_NO_CONTEXT);<br>    <span class="hljs-built_in">eglDestroyContext</span>(mDisplay, mContext);<br>    <span class="hljs-built_in">eglDestroySurface</span>(mDisplay, mSurface);<br>    mFlingerSurface.<span class="hljs-built_in">clear</span>();<br>    mFlingerSurfaceControl.<span class="hljs-built_in">clear</span>();<br>    <span class="hljs-built_in">eglTerminate</span>(mDisplay);<br>    IPCThreadState::<span class="hljs-built_in">self</span>()-&gt;<span class="hljs-built_in">stopProcess</span>();<br>    <span class="hljs-keyword">return</span> r;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">BootAnimation::movie</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    String8 desString;<br>    <span class="hljs-comment">// è¯»å– desc.txt é…ç½®æ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">readFile</span>(<span class="hljs-string">&quot;desc.txt&quot;</span>, desString)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-type">char</span> <span class="hljs-type">const</span>* s = desString.<span class="hljs-built_in">string</span>();<br><br>    <span class="hljs-comment">// è§£ææè¿°æ–‡ä»¶</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        ...<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i=<span class="hljs-number">0</span> ; i&lt;pcount ; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> r=<span class="hljs-number">0</span> ; !part.count || r&lt;part.count ; r++) &#123;<br>            <span class="hljs-comment">// opengl ç»˜åˆ¶æ“ä½œ</span><br>            <span class="hljs-built_in">glClearColor</span>(<br>                    part.backgroundColor[<span class="hljs-number">0</span>],<br>                    part.backgroundColor[<span class="hljs-number">1</span>],<br>                    part.backgroundColor[<span class="hljs-number">2</span>],<br>                    <span class="hljs-number">1.0f</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> j=<span class="hljs-number">0</span> ; j&lt;fcount &amp;&amp; (!<span class="hljs-built_in">exitPending</span>() || part.playUntilComplete) ; j++) &#123;<br>                <span class="hljs-function"><span class="hljs-type">const</span> Animation::Frame&amp; <span class="hljs-title">frame</span><span class="hljs-params">(part.frames[j])</span></span>;<br>                <span class="hljs-type">nsecs_t</span> lastFrame = <span class="hljs-built_in">systemTime</span>();<br>                ...<br>                <span class="hljs-keyword">if</span> (r &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-built_in">glBindTexture</span>(GL_TEXTURE_2D, frame.tid);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    ...<br>                    <span class="hljs-built_in">initTexture</span>(frame);<br>                &#125;<br>                <br>                <span class="hljs-comment">// specify the y center as ceiling((mHeight - animation.height) / 2)</span><br>                <span class="hljs-comment">// which is equivalent to mHeight - (yc + animation.height)</span><br>                <span class="hljs-built_in">glDrawTexiOES</span>(xc, mHeight - (yc + animation.height),<br>                              <span class="hljs-number">0</span>, animation.width, animation.height);<br>                <span class="hljs-built_in">eglSwapBuffers</span>(mDisplay, mSurface);<br><br>                <span class="hljs-comment">// ä¸æ–­ç»˜åˆ¶æ—¶æ£€æµ‹æ˜¯å¦éœ€è¦é€€å‡º</span><br>                <span class="hljs-built_in">checkExit</span>();<br>            &#125;<br>            <span class="hljs-comment">// å¦‚æœé€€å‡ºäº†å°±è·³å‡ºç»“æŸç»˜åˆ¶</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">exitPending</span>() &amp;&amp; !part.count)<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// free the textures for this part</span><br>        <span class="hljs-keyword">if</span> (part.count != <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> j=<span class="hljs-number">0</span> ; j&lt;fcount ; j++) &#123;<br>                <span class="hljs-function"><span class="hljs-type">const</span> Animation::Frame&amp; <span class="hljs-title">frame</span><span class="hljs-params">(part.frames[j])</span></span>;<br>                <span class="hljs-built_in">glDeleteTextures</span>(<span class="hljs-number">1</span>, &amp;frame.tid);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-comment">// è¯»å– service.bootanim.exit å€¼æ˜¯å¦æ˜¯ 1 </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> EXIT_PROP_NAME <span class="hljs-string">&quot;service.bootanim.exit&quot;</span></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BootAnimation::checkExit</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Allow surface flinger to gracefully request shutdown</span><br>    <span class="hljs-type">char</span> value[PROPERTY_VALUE_MAX];<br>    <span class="hljs-built_in">property_get</span>(EXIT_PROP_NAME, value, <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-type">int</span> exitnow = <span class="hljs-built_in">atoi</span>(value);<br>    <span class="hljs-keyword">if</span> (exitnow) &#123;<br>        <span class="hljs-built_in">requestExit</span>();<br>        <span class="hljs-keyword">if</span> (mAudioPlayer != <span class="hljs-literal">NULL</span>) &#123;<br>            mAudioPlayer-&gt;<span class="hljs-built_in">requestExit</span>();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨åŠ¨ç”»åº•å±‚é‡‡ç”¨çš„æ˜¯ opengles çš„æ–¹å¼æ¥æ¸²æŸ“ç»˜åˆ¶çš„ï¼Œç»˜åˆ¶çš„å†…å®¹æ˜¯æœ¬åœ°çš„ä¸€ä¸ªå¯åŠ¨åŠ¨ç”»èµ„æºåŒ…ï¼Œåœ¨ç»˜åˆ¶çš„è¿‡ç¨‹ä¸­ä¼šä¸æ–­çš„åˆ¤æ–­æ˜¯å¦éœ€è¦é€€å‡ºï¼Œè¯»å–çš„å­—æ®µæ˜¯ service.bootanim.exit ï¼Œä¸º 1 ä»£è¡¨éœ€è¦ break é€€å‡ºå¾ªç¯ç»˜åˆ¶ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ° service.bootanim.exit åœ¨å“ªé‡Œè®¾ç½®ä¸º 1 çš„ï¼Œä¾¿å¯æ‰¾åˆ°é€€å‡ºå¯åŠ¨åŠ¨ç”»çš„å…¥å£ã€‚å…³é—­åŠ¨ç”»çš„å…¥å£è¿˜æ˜¯åœ¨ SurfaceFlinger ä¸­åªæ˜¯è¿™ä¸ªè°ƒç”¨æµç¨‹æ¯”è¾ƒå¤æ‚è€Œå·²ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-type">void</span> <span class="hljs-title">handleResumeActivity</span><span class="hljs-params">(IBinder token,</span></span><br><span class="hljs-params"><span class="hljs-function">                                boolean clearHide, boolean isForward, boolean reallyResume)</span> </span>&#123;<br>    ActivityClientRecord r = <span class="hljs-built_in">performResumeActivity</span>(token, clearHide);<br>    <span class="hljs-keyword">if</span> (r != null) &#123;<br>        <span class="hljs-keyword">if</span> (!r.onlyLocalRequest) &#123;<br>            r.nextIdle = mNewActivities;<br>            mNewActivities = r;<br>            <span class="hljs-comment">// æ·»åŠ äº†ä¸€ä¸ª IdleHandler æ¶ˆæ¯</span><br>            Looper.<span class="hljs-built_in">myQueue</span>().<span class="hljs-built_in">addIdleHandler</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Idler</span>());<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        ...<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> Idler implements MessageQueue.IdleHandler &#123;<br>    @Override<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> boolean <span class="hljs-built_in">queueIdle</span>() &#123;<br>        ActivityClientRecord a = mNewActivities;<br>        <span class="hljs-keyword">if</span> (a != null) &#123;<br>            mNewActivities = null;<br>            IActivityManager am = ActivityManagerNative.<span class="hljs-built_in">getDefault</span>();<br>            ActivityClientRecord prev;<br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-keyword">if</span> (a.activity != null &amp;&amp; !a.activity.mFinished) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-comment">// è°ƒç”¨ AMS çš„ activityIdle</span><br>                        am.<span class="hljs-built_in">activityIdle</span>(a.token, a.createdConfig, stopProfiling);<br>                    &#125; <span class="hljs-built_in">catch</span> (RemoteException ex) &#123;<br>                        <span class="hljs-comment">// Ignore</span><br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">while</span> (a != null);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><br>@<span class="hljs-function">Override</span><br><span class="hljs-function">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">void</span> <span class="hljs-title">activityIdle</span><span class="hljs-params">(IBinder token, Configuration config, boolean stopProfiling)</span> </span>&#123;<br>    <span class="hljs-built_in">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br>        ActivityStack stack = ActivityRecord.<span class="hljs-built_in">getStackLocked</span>(token);<br>        <span class="hljs-keyword">if</span> (stack != null) &#123;<br>            ActivityRecord r = mStackSupervisor.<span class="hljs-built_in">activityIdleInternalLocked</span>(token, <span class="hljs-literal">false</span>, config);<br>        &#125;<br>    &#125;<br>    Binder.<span class="hljs-built_in">restoreCallingIdentity</span>(origId);<br>&#125;<br><br><span class="hljs-comment">// Checked.</span><br><span class="hljs-function"><span class="hljs-keyword">final</span> ActivityRecord <span class="hljs-title">activityIdleInternalLocked</span><span class="hljs-params">(<span class="hljs-keyword">final</span> IBinder token, boolean fromTimeout,</span></span><br><span class="hljs-params"><span class="hljs-function">                                                Configuration config)</span> </span>&#123;<br>    ActivityRecord r = ActivityRecord.forTokenLocked(token);<br>    <span class="hljs-keyword">if</span> (r != null) &#123;<br>        ...<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isFrontStack</span>(r.task.stack) || fromTimeout) &#123;<br>                booting = <span class="hljs-built_in">checkFinishBootingLocked</span>();<br>            &#125;<br>    &#125;<br>    ...<br>        <span class="hljs-keyword">return</span> r;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> boolean <span class="hljs-title">checkFinishBootingLocked</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> boolean booting = mService.mBooting;<br>    boolean enableScreen = <span class="hljs-literal">false</span>;<br>    mService.mBooting = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (!mService.mBooted) &#123;<br>        mService.mBooted = <span class="hljs-literal">true</span>;<br>        enableScreen = <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (booting || enableScreen) &#123;<br>        mService.<span class="hljs-built_in">postFinishBooting</span>(booting, enableScreen);<br>    &#125;<br>    <span class="hljs-keyword">return</span> booting;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enableScreenAfterBoot</span><span class="hljs-params">()</span> </span>&#123;<br>    mWindowManager.<span class="hljs-built_in">enableScreenAfterBoot</span>();<br>    <span class="hljs-built_in">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br>        <span class="hljs-built_in">updateEventDispatchingLocked</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">performEnableScreen</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">synchronized</span>(mWindowMap) &#123;<br>        <span class="hljs-keyword">if</span> (!mBootAnimationStopped) &#123;<br>            <span class="hljs-comment">// å‘SurfaceFlinger è¿›ç¨‹å‘èµ·å…³é—­å¼€æœºç•Œé¢çš„æ¶ˆæ¯</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                IBinder surfaceFlinger = ServiceManager.<span class="hljs-built_in">getService</span>(<span class="hljs-string">&quot;SurfaceFlinger&quot;</span>);<br>                <span class="hljs-keyword">if</span> (surfaceFlinger != null) &#123;<br>                    Parcel data = Parcel.<span class="hljs-built_in">obtain</span>();<br>                    data.<span class="hljs-built_in">writeInterfaceToken</span>(<span class="hljs-string">&quot;android.ui.ISurfaceComposer&quot;</span>);<br>                    <span class="hljs-comment">// å‘SurfaceComposerå‘é€</span><br>                    surfaceFlinger.<span class="hljs-built_in">transact</span>(IBinder.FIRST_CALL_TRANSACTION, <span class="hljs-comment">// BOOT_FINISHED</span><br>                                            data, null, <span class="hljs-number">0</span>);<br>                    data.<span class="hljs-built_in">recycle</span>();<br>                &#125;<br>            &#125; <span class="hljs-built_in">catch</span> (RemoteException ex) &#123;<br>                ...<br>            &#125;<br>            mBootAnimationStopped = <span class="hljs-literal">true</span>;<br>        &#125;<br>        ...<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ----------------------------------------------------------------------</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">ISurfaceComposerTag</span> &#123;<br>    BOOT_FINISHED = IBinder::FIRST_CALL_TRANSACTION,<br>    <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// /frameworks/native/libs/gui/ISurfaceComposer.cpp</span><br><span class="hljs-type">status_t</span> BnSurfaceComposer::<span class="hljs-built_in">onTransact</span>(<br>    <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data, Parcel* reply, <span class="hljs-type">uint32_t</span> flags)&#123;<br>    <span class="hljs-keyword">switch</span>(code) &#123;<br>            <span class="hljs-comment">// ...</span><br>        <span class="hljs-keyword">case</span> BOOT_FINISHED: &#123;<br>            <span class="hljs-built_in">CHECK_INTERFACE</span>(ISurfaceComposer, data, reply);<br>            <span class="hljs-built_in">bootFinished</span>();<br>            <span class="hljs-keyword">return</span> NO_ERROR;<br>        &#125;<br>            <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">// ----------------------------------------------------------------------</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SurfaceFlinger::bootFinished</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// æŠŠ service.bootanim.exit å±æ€§è®¾ç½®ä¸º 1 ï¼Œbootanim è¿›ç¨‹è¯»åˆ° 1 æ—¶å°±ä¼šé€€å‡ºå¼€æœºå¯åŠ¨åŠ¨ç”»</span><br>    <span class="hljs-built_in">property_set</span>(<span class="hljs-string">&quot;service.bootanim.exit&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é—­å¼€æœºå¯åŠ¨åŠ¨ç”»çš„æµç¨‹è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæˆ‘ä»¬æ¥ç¼•ä¸€ç¼•æ•´ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬çš„ Launcher è¿›ç¨‹å¯åŠ¨åä¼šå¯åŠ¨æˆ‘ä»¬ Launcher Activity ç•Œé¢ï¼Œè€Œ Activity çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨éƒ½æ˜¯ç”± ActivityThread æ¥æ‰§è¡Œçš„ï¼Œå…¶ä¸­å°±ä¼šæ‰§è¡Œåˆ° handleResumeActivity æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä¼šæ·»åŠ ä¸€ä¸ª IdleHandler æ¶ˆæ¯ï¼Œä¼šè°ƒç”¨åˆ° AMS çš„ activityIdle æ–¹æ³•ï¼ŒAMS ä¼šè°ƒç”¨ WMS çš„ enableScreenAfterBoot æ–¹æ³•ï¼ŒWMS ä¼šè·¨è¿›ç¨‹é€šçŸ¥ SurfaceFlinger å»å…³é—­æˆ‘ä»¬çš„å¼€æœºå¯åŠ¨åŠ¨ç”»ã€‚</p><h2 id="4-å¼€æœºåŠ¨ç”»åŒ…é‡Œæœ‰ä»€ä¹ˆ"><a href="#4-å¼€æœºåŠ¨ç”»åŒ…é‡Œæœ‰ä»€ä¹ˆ" class="headerlink" title="4.å¼€æœºåŠ¨ç”»åŒ…é‡Œæœ‰ä»€ä¹ˆ"></a>4.å¼€æœºåŠ¨ç”»åŒ…é‡Œæœ‰ä»€ä¹ˆ</h2><p>è¿™é‡Œå»ºè®®å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š&#x2F;frameworks&#x2F;base&#x2F;cmds&#x2F;bootanimation&#x2F;FORMAT.md</p><p>å¼€æœºåŠ¨ç”»æŒ‡çš„æ˜¯ä»¥bootanimation.zipæ–¹å¼å­˜åœ¨ï¼Œå¯åŠ¨çš„æ—¶å€™ä¼šä¾æ¬¡é€‰æ‹©ä¸€ä¸ªbootanimation.zipåŠ è½½</p><ol><li>&#x2F;system&#x2F;media&#x2F;bootanimation-encrypted.zip (if getprop(â€œvold.decryptâ€) &#x3D; â€˜1â€™)</li><li>&#x2F;system&#x2F;media&#x2F;bootanimation.zip</li><li>&#x2F;oem&#x2F;media&#x2F;bootanimation.zip</li></ol><p><code>bootanimation.zip</code> æ–‡ä»¶ä¸­åŒ…å«ï¼š</p><img src="/2023/01/25/%E5%AE%89%E5%8D%93%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB/å‹ç¼©æ–‡ä»¶.png"><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">desc.txt - a text file<br>part0  \<br>part1   \  directories full of PNG frames<br>...     /<br>partN  /<br></code></pre></td></tr></table></figure><p><strong>â€œdesc.txtâ€</strong>ï¼š<strong>ç”¨æ¥æè¿°ç”¨æˆ·è‡ªå®šä¹‰çš„å¼€æœºåŠ¨ç”»æ˜¯å¦‚ä½•æ˜¾ç¤ºçš„</strong>ã€‚</p><p>ä»¥ä¸‹é¢çš„ä¾‹å­ä¸ºä¾‹ï¼š</p><blockquote><p>1280 720 1</p><p>p 1 1 part0</p><p>p 0 1 part1</p></blockquote><p>ç¬¬ä¸€è¡Œçš„ä¸‰ä¸ªæ•°å­—åˆ†åˆ«è¡¨ç¤ºå¼€æœºåŠ¨ç”»åœ¨å±å¹•ä¸­çš„æ˜¾ç¤ºå®½åº¦ã€é«˜åº¦ä»¥åŠå¸§é€Ÿ(fps)ã€‚å‰©ä½™çš„æ¯ä¸€è¡Œéƒ½ç”¨æ¥æè¿°ä¸€ä¸ªåŠ¨ç”»ç‰‡æ–­ï¼Œè¿™äº›è¡Œå¿…é¡»è¦ä»¥å­—ç¬¦â€œpâ€æ¥å¼€å¤´ï¼Œåé¢ç´§è·Ÿç€ä¸¤ä¸ªæ•°å­—ä»¥åŠä¸€ä¸ªæ–‡ä»¶ç›®å½•è·¯å¾„åç§°ã€‚</p><p>ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸€ä¸ªç‰‡æ–­çš„å¾ªç¯æ˜¾ç¤ºæ¬¡æ•°ï¼Œå¦‚æœå®ƒçš„å€¼ç­‰äº0ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºæ— é™å¾ªç¯åœ°æ˜¾ç¤ºè¯¥åŠ¨ç”»ç‰‡æ–­ã€‚</p><p>ç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºæ¯ä¸€ä¸ªç‰‡æ–­åœ¨ä¸¤æ¬¡å¾ªç¯æ˜¾ç¤ºä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚è¿™ä¸ªæ—¶é—´é—´éš”æ˜¯ä»¥ä¸€ä¸ªå¸§çš„æ—¶é—´ä¸ºå•ä½çš„ã€‚</p><p>æ–‡ä»¶ç›®å½•ä¸‹é¢ä¿å­˜çš„æ˜¯ä¸€ç³»åˆ—pngæ–‡ä»¶ï¼Œè¿™äº›pngæ–‡ä»¶ä¼šè¢«ä¾æ¬¡æ˜¾ç¤ºåœ¨å±å¹•ä¸­ã€‚</p><h2 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼š"></a>å‚è€ƒèµ„æ–™ï¼š</h2><ul><li><a href="https://blog.51cto.com/u_11176305/3796348">https://blog.51cto.com/u_11176305/3796348</a></li><li><a href="https://www.cnblogs.com/lufeibin/p/13529981.html">https://www.cnblogs.com/lufeibin/p/13529981.html</a></li><li><a href="https://blog.csdn.net/weixin_36044720/article/details/117277602?spm=1001.2014.3001.5506">https://blog.csdn.net/weixin_36044720/article/details/117277602?spm=1001.2014.3001.5506</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Androidå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android-Trebleè®¡åˆ’</title>
    <link href="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/"/>
    <url>/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<ul><li>ğŸ•Šï¸æœ¬æ–‡æ¥è‡ªè§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=zbebx1Kvqho">https://www.youtube.com/watch?v=zbebx1Kvqho</a></li><li>å¼•ç”¨éƒ¨åˆ†åšå®¢ï¼š<a href="https://new.qq.com/rain/a/20191016A070PF00">https://new.qq.com/rain/a/20191016A070PF00</a></li><li><a href="https://www.freesion.com/article/69471423144/">https://www.freesion.com/article/69471423144/</a></li></ul><h2 id="1-Andriodè¿›å…¥Trebleä¹‹å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜"><a href="#1-Andriodè¿›å…¥Trebleä¹‹å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜" class="headerlink" title="1.Andriodè¿›å…¥Trebleä¹‹å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜"></a>1.Andriodè¿›å…¥Trebleä¹‹å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜</h2><p>åœ¨Android 8.0ï¼ˆAndroid Oreoï¼‰ä¹‹å‰é‚£ä¸ªæ—¶ä»£ï¼Œè‹¹æœæ‰‹æœºä¸€æ—¦æœ‰äº†æ–°çš„ç³»ç»Ÿæ›´æ–°ï¼Œç”¨æˆ·éƒ½èƒ½åœ¨çŸ­æ—¶é—´å†…æ›´æ–°ç³»ç»Ÿï¼Œå¯¹ç”¨æˆ·æ¥è¯´å®åœ¨å¤ªç®€å•äº†ï¼Œç”¨æˆ·åªéœ€è¦ç‚¹å‡»æ›´æ–°ä¸‹è½½æ–°ç³»ç»Ÿå°±å¯ä»¥å®Œç¾çš„æ‹¥æœ‰æœ€æ–°çš„ç³»ç»ŸåŠŸèƒ½ã€‚è€Œå¯¹äºå®‰å“ç”¨æˆ·è€Œè¨€ï¼Œå½“å®‰å“å‘å¸ƒæ–°çš„æºç ä»¥åï¼Œä¼šç»è¿‡ä¸‹é¢ä¸€ç³»åˆ—çš„æ“ä½œï¼Œç”¨æˆ·æ‰èƒ½ç”¨ä¸ŠçœŸæ­£çš„å…¨æ–°å®‰å“ç³»ç»Ÿã€‚</p><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/ç”Ÿæˆè¿‡ç¨‹.png" style="zoom: 80%;"><ol><li>å‘å¸ƒæºç ï¼šGoogleå°†æ–°ç³»ç»Ÿæºç å‘å¸ƒè‡³AOSP</li><li>å¯åŠ¨ç¡¬ä»¶é€‚é…ï¼šèŠ¯ç‰‡åˆ¶é€ å•†å¦‚<strong>ä¸‰æ˜Ÿ</strong>ã€<strong>é«˜é€š</strong>ã€<strong>è”å‘ç§‘</strong>ã€<strong>åä¸º</strong>ç­‰å¯¹æºç è¿›è¡Œä¿®æ”¹ï¼Œç¡®ä¿è‡ªå®¶çš„èŠ¯ç‰‡åœ¨æ–°ç‰ˆAndroidèƒ½æ­£å¸¸è¿è¡Œå’Œå‘æŒ¥æ€§èƒ½</li><li>OEMé€‚é…ï¼šOEM å‚å•†è¿›ä¸€æ­¥ä¿®æ”¹æ–°ç³»ç»Ÿ</li><li>OEMæµ‹è¯•ï¼šOEM å‚å•†å¯¹ç³»ç»Ÿè¿›è¡Œå†…éƒ¨æµ‹è¯•</li><li>æ¨é€ç»™ç”¨æˆ·ï¼šè¯•æ— è¯¯åçš„æ–°ç‰ˆç³»ç»Ÿé€šè¿‡ OTA æ¨é€ç»™ç”¨æˆ·</li></ol><p>è¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œç”¨è°·æ­Œå¼€å‘å›¢é˜Ÿçš„è¯æ¥è¯´ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šèŠ±è´¹5-12ä¸ªæœˆçš„æ—¶é—´â€¦â€¦å¯„ğŸ“</p><p>è™½ç„¶Googleåœ¨æäº¤AOSPæºç ä¸Šéå¸¸è¿…é€Ÿï¼Œä½†æ˜¯èŠ¯ç‰‡åˆ¶é€ å•†å’ŒOEMå‚å•†å¾€å¾€å› ä¸ºæŠ€æœ¯é—®é¢˜ã€ç¬¬ä¸‰æ–¹ç³»ç»Ÿå®šåˆ¶åŸå› ç­‰å¯¼è‡´æ•´ä½“çš„è¿›ç¨‹åæ…¢ï¼Œæœ€ç»ˆå½¢æˆäº†ç”¨æˆ·èŒ«èŒ«ç„¶çš„ç­‰å¾…ï¼Œä»ä»¥å¾€çš„æ•°æ®ç»Ÿè®¡æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒAndroidæ‰‹æœºä¸­æ–°ç³»ç»Ÿçš„è¦†ç›–ç‡å¯¥å¯¥æ— å‡ ã€‚</p><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/licheng.png" style="zoom: 50%;"><blockquote><p>å¯ä»¥çœ‹åˆ°è‡ªä»å®‰å“8.0é€€å‡ºTrebleä»¥æ¥ï¼Œå®‰å“9.0å¼€å§‹çªé£çŒ›è¿›ï¼Œæ›´æ–°çš„ç”¨æˆ·å‡ ä¹æ˜¯8.0çš„ä¸€å€</p></blockquote><h2 id="2-Trebleè®¡åˆ’"><a href="#2-Trebleè®¡åˆ’" class="headerlink" title="2.Trebleè®¡åˆ’"></a>2.Trebleè®¡åˆ’</h2><h3 id="2-1-Trebleç®€ä»‹"><a href="#2-1-Trebleç®€ä»‹" class="headerlink" title="2.1 Trebleç®€ä»‹"></a>2.1 Trebleç®€ä»‹</h3><p>Android 8.0 ç‰ˆæœ¬çš„ä¸€é¡¹æ–°å…ƒç´ æ˜¯ Project Trebleã€‚è¿™æ˜¯ Androidæ¶æ„æ–¹é¢çš„ä¸€é¡¹é‡å¤§æ”¹å˜ï¼Œä¸»è¦è§£å†³Android ç‰ˆæœ¬ç¢ç‰‡åŒ–é—®é¢˜ï¼Œæ›´æ–¹ä¾¿å¿«æ·çš„å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚å…¶ä¸­æœ€æ ¸å¿ƒçš„ä¸€ç‚¹æ˜¯å°†AOSPä»£ç å’Œä¾›åº”å•†ï¼ˆVendorï¼‰ä»£ç åšå¥½è§£è€¦ã€‚è´´ä¸€å¼ å¼ æ¶æ„å‰åçš„å¯¹æ¯”å›¾ï¼š</p><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/æ¶æ„å˜åŒ–.png"><ul><li>å‡çº§å‰ï¼šFrameworkä»£ç å’ŒVendorçš„ä»£ç è€¦åˆï¼Œå³ä½¿è°·æ­Œå‘å¸ƒä¼šå®Œæœ€æ–°AOSPä»£ç ï¼Œè®¾å¤‡å‚å•†ä¹Ÿéœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å¤„ç†å’ŒVendorä»£ç é€‚é…é—®é¢˜ã€Reworkedã€‘ï¼Œæ‰€ä»¥å‡çº§ä¼šèŠ±è´¹å¾ˆå¤§é‡çš„æ—¶é—´</li></ul><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/æ–°æ¶æ„.png"><ul><li>æ–°çš„æ¶æ„ï¼šTrebleåœ¨Frameworkå’ŒVendorå®ç°ä»£ç ä¸­é—´å®šä¹‰ä¸€ä¸ªç¨³å®šçš„æ¥å£ï¼Œè¿™æ ·Frameworkä»£ç å’ŒVendorçš„ä»£ç å®ç°è§£è€¦ï¼Œè¿™æ ·è®¾å¤‡å‚å•†èƒ½å¤Ÿå¿«é€Ÿçš„å‡çº§AOSPï¼Œåªè¦æ¥å£ä¸å˜ï¼Œç³»ç»Ÿè¿˜èƒ½æ­£å¸¸èµ·æ¥ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹ä»¥å‰çš„Frameworkå±‚å’ŒHALå±‚æ˜¯æ€ä¹ˆäº¤äº’çš„ï¼Ÿ</p><p><strong>Android Oä¹‹å‰ç‰ˆæœ¬çš„æ¡†æ¶ï¼š</strong></p><p>åœ¨æ­¤ä¹‹å‰çš„Android ç³»ç»Ÿæ¶æ„å½“ä¸­ï¼ŒAndroid Framework ä¸Android HALæ˜¯æ‰“åŒ…æˆä¸€ä¸ªsystem.imgçš„ï¼Œè€Œä¸”Framework ä¸HALä¹‹é—´æ˜¯ç´§è€¦åˆçš„ï¼Œé€šè¿‡é“¾æ¥çš„æ–¹å¼ä½¿ç”¨ç›¸åº”çš„ç¡¬ä»¶ç›¸å…³soåº“ã€‚è€ç‰ˆæœ¬çš„android çš„ç³»ç»Ÿæ¡†æ¶å½“ä¸­frameworkä¸HALä¹‹é—´çš„ä¸€èˆ¬æ¶æ„æ¡†æ¶æ˜¯ï¼š</p><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/æ¡†æ¶.png"><p>æ‰€ä»¥æ¯æ¬¡Android frameworkçš„å‡çº§éœ€è¦å¯¹åº”çš„Android HALå‡çº§ã€‚æ‰€ä»¥è¿™æ ·æ¯æ¬¡Android å‡çº§éƒ½éœ€è¦Android è®¾å¤‡åˆ¶é€ å•†æŠ•å…¥å¤§é‡çš„äººåŠ›ç‰©ç†å»å‡çº§ç›¸åº”çš„Vendor HAL Implemetation.</p><p><strong>Android OåŠä¹‹åçš„ç‰ˆæœ¬çš„æ¡†æ¶ï¼š</strong></p><p>åœ¨Android Oä»¥åŠä»¥åçš„ç‰ˆæœ¬å½“ä¸­ï¼ŒAndroid æ›´æ–°äº†æ–°çš„æ¡†æ¶è®¾è®¡åœ¨æ–°çš„æ¡†æ¶è®¾è®¡å½“ä¸­ï¼Œå¼•å…¥äº†ä¸€å¥—å«HIDLçš„è¯­è¨€æ¥å®šä¹‰Freameworkä¸HALä¹‹é—´çš„æ¥å£ï¼Œæ–°çš„æ¶æ„å¦‚ä¸‹å›¾ï¼š</p><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/HIDL.png"><p>è·Ÿä»¥å¾€çš„Android ç‰ˆæœ¬ç›¸æ¯”è¾ƒï¼ŒAndroid Oé‡Œä½¿ç”¨HIDLæ¥è§£è€¦System Framework ä¸Vendor HAL Implemetationä¹‹é—´çš„å…³ç³»ã€ï¼Œä»è€Œç®€åŒ–é™ä½Androidç³»ç»Ÿå‡çº§çš„å½±å“ä¸éš¾åº¦ã€‚å¹¶ä¸”ç›®å‰çœ‹èµ·æ¥ï¼ŒAndroid Frameworkä¸Vendor HAL Implemetationä¼šå­˜æ”¾åœ¨ä¸åŒçš„åˆ†åŒºå½“ä¸­ï¼ŒAndroid Frameworkä¼šåœ¨systemåˆ†åŒºå½“ä¸­ï¼Œè€ŒVendor HAL Implemetationä¼šåœ¨ä¸€ä¸ªæ–°å®šä¹‰çš„åˆ†åŒº(Vendor.img)å½“ä¸­ï¼Œè¿™æ ·åˆ·æ–°çš„system.img æ‰ä¸ä¼šå½±å“åˆ°Vendor HAL Implemetationã€‚</p><p><strong>æ›´æ¸…æ™°çš„è°ƒç”¨å…³ç³»</strong></p><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/Oä¹‹å‰.png" style="zoom:70%;"><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/Oä¹‹å.png" style="zoom:70%;"><h3 id="2-2-Trebleæ–°æŠ€æœ¯"><a href="#2-2-Trebleæ–°æŠ€æœ¯" class="headerlink" title="2.2 Trebleæ–°æŠ€æœ¯"></a>2.2 Trebleæ–°æŠ€æœ¯</h3><img src="/2023/01/14/Android-Treble%E8%AE%A1%E5%88%92/æ¶æ„å¯¹æ¯”.png"><p><strong>Trebleæ¶æ„ä¸­ä¸ºäº†å®ç°ç³»ç»Ÿå’Œä¾›åº”å•†çš„åˆ†ç¦»ï¼Œå¼•å…¥äº†è®¸å¤šæ–°æŠ€æœ¯ã€‚å…³é”®æŠ€æœ¯åŒ…æ‹¬ï¼š</strong></p><ul><li>HIDLï¼šHALæ¥å£å®šä¹‰è¯­è¨€ï¼Œç”¨äºæŒ‡å®šHALå’Œå…¶ä»–ç”¨æˆ·ä¹‹é—´çš„æ¥å£çš„ä¸€ç›´æ¥å£æè¿°è¯­è¨€(IDL)</li><li>HALï¼šè¿è¡ŒAndroid8.0æˆ–è€…æ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡å¿…é¡»æ”¯æŒä½¿ç”¨HIDLè¯­è¨€ç¼–å†™çš„HALï¼Œåˆ†ä¸ºbinderized HALï¼ˆç»‘å®šå¼ï¼‰å’Œpassthrough HALï¼ˆç›´é€šå¼ï¼‰ã€‚</li><li>è®¾å¤‡æ ‘å åŠ å±‚(DTO)ï¼šå°†è®¾å¤‡æ•°(DT)åˆ†å‰²ä¸ºä¸»DTå’Œå åŠ DTã€‚å åŠ DTç”±ODMå‚å•†æä¾›ï¼Œå­˜æ”¾åœ¨ODMåˆ†åŒºã€‚é€šè¿‡å¯¹å åŠ DTçš„ä¿®æ”¹å‡çº§ï¼Œå¯ä»¥å®ç°åœ¨DTä¸­å¢åŠ è®¾å¤‡èŠ‚ç‚¹å’Œä¿®æ”¹è®¾å¤‡å±æ€§ã€‚</li><li>ä¾›åº”å•†åŸç”Ÿå¼€å‘å¥—ä»¶(VNDK)ï¼šæä¾›äº†ä¸€ç»„è®©ä¾›åº”å•†å®ç°å…¶HALçš„ä¸“ç”¨åº“ã€‚</li><li>ä¾›åº”å•†æ¥å£å¯¹è±¡(VINTF)ï¼šç”¨äºæ±‡æ€»è®¾å¤‡çš„ç›¸å…³ä¿¡æ¯å¹¶é€šè¿‡å¯æŸ¥è¯¢çš„APIæä¾›è¯¥ä¿¡æ¯ã€‚</li><li>SELinuxï¼šAndroid8.0å®ç°SELinuxç­–ç•¥çš„æ¨¡å—åŒ–å’Œå…¼å®¹æ€§ï¼Œç›®æ ‡æ˜¯ä½¿SOCä¾›åº”å•†å’ŒODMç”Ÿäº§å•†èƒ½å¤Ÿä»¥éš”ç¦»æ–¹å¼è‡ªå®šä¹‰SELinuxé…ç½®ï¼Œè€Œæ— éœ€è·¨åˆ†åŒºä¿®æ”¹ã€‚</li></ul><h2 id="ä¿®æ”¹å†å²"><a href="#ä¿®æ”¹å†å²" class="headerlink" title="ä¿®æ”¹å†å²"></a>ä¿®æ”¹å†å²</h2><ul><li>2023&#x2F;01&#x2F;14ï¼šé¦–æ¬¡ç¼–å†™ã€ŠAndroid-Trebleè®¡åˆ’ã€‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Androidå­¦ä¹ ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Androidå­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•æ­å»ºhexoéƒ¨ç½²åˆ°github</title>
    <link href="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/"/>
    <url>/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ğŸ“æœ¬æ–‡çš„å†…å®¹æ˜¯è®°å½•æ­å»ºhexoåšå®¢ï¼Œå¹¶ä¸”éƒ¨ç½²åˆ°githubä¸Š<br>ğŸ–å“ˆå“ˆå“ˆï¼Œæˆ‘å°±æ˜¯è¯¾ä»£è¡¨<br>ğŸ”æ‰€æœ‰å†…å®¹å‡æ¥è‡ªäºï¼š<strong>Bç«™CodeSheep</strong></p></blockquote><h2 id="1-å®‰è£…Nodejs"><a href="#1-å®‰è£…Nodejs" class="headerlink" title="1.å®‰è£…Nodejs"></a>1.å®‰è£…Nodejs</h2><h3 id="1-1-å®‰è£…Nodejs"><a href="#1-1-å®‰è£…Nodejs" class="headerlink" title="1.1 å®‰è£…Nodejs"></a>1.1 å®‰è£…Nodejs</h3><p>Nodejså®˜ç½‘ï¼š<a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/nodejså®‰è£….png" alt="image-20230114121402814" style="zoom: 67%;"><p>ç›´æ¥æ— è„‘ä¸‹ä¸€æ­¥å®‰è£…ï¼Œå®‰è£…å®Œæˆå<code>node -v</code>æŸ¥çœ‹ç‰ˆæœ¬ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ</p><h3 id="1-2-æ›´æ¢é•œåƒ"><a href="#1-2-æ›´æ¢é•œåƒ" class="headerlink" title="1.2 æ›´æ¢é•œåƒ"></a>1.2 æ›´æ¢é•œåƒ</h3><p>ç”±äºnpmåŒ…ç®¡ç†å·¥å…·å®åœ¨å¤ªæ…¢äº†ï¼Œæ‰€ä»¥æ‰“ç®—ä½¿ç”¨æ·˜å®é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g cnpm --registry=https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p>æœ€åå¯ä»¥é€šè¿‡<code>cnpm -v</code>æŸ¥çœ‹ä¸€ä¸‹cnpmæ˜¯å¦å®‰è£…æˆåŠŸ</p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/å®‰è£…npm.png" alt="image-20230114121402814" style="zoom: 67%;"><h2 id="2-å®‰è£…Hexoå¹¶åˆå§‹åŒ–hexoé¡¹ç›®"><a href="#2-å®‰è£…Hexoå¹¶åˆå§‹åŒ–hexoé¡¹ç›®" class="headerlink" title="2.å®‰è£…Hexoå¹¶åˆå§‹åŒ–hexoé¡¹ç›®"></a>2.å®‰è£…Hexoå¹¶åˆå§‹åŒ–hexoé¡¹ç›®</h2><h3 id="2-1-å®‰è£…hexo"><a href="#2-1-å®‰è£…hexo" class="headerlink" title="2.1 å®‰è£…hexo"></a>2.1 å®‰è£…hexo</h3><p>å…ˆé€šè¿‡npmå®‰è£…hexo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install -g hexo-cli<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä»¥åï¼Œå¯ä»¥é€šè¿‡<code>hexo -v</code> æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><h3 id="2-2-åˆå§‹åŒ–hexoé¡¹ç›®"><a href="#2-2-åˆå§‹åŒ–hexoé¡¹ç›®" class="headerlink" title="2.2 åˆå§‹åŒ–hexoé¡¹ç›®"></a>2.2 åˆå§‹åŒ–hexoé¡¹ç›®</h3><ol><li>æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾hexoçš„æ‰€æœ‰å†…å®¹</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir hexo-blog<br></code></pre></td></tr></table></figure><ol start="2"><li>è¿›å…¥è¯¥é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œè¿›è¡Œåˆå§‹åŒ–</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init<br></code></pre></td></tr></table></figure><ol start="3"><li>æœ¬åœ°æ‰“å¼€è¯¥é¡¹ç›®</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>localhost:4000</code>è¿›è¡Œè®¿é—®</p><h3 id="2-3-åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®"><a href="#2-3-åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®" class="headerlink" title="2.3 åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®"></a>2.3 åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</h3><p>åˆ›å»ºè‡ªå·±çš„æ–°åšå®¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new &quot;å¦‚ä½•æ­å»ºhexoéƒ¨ç½²åˆ°github&quot;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆé™æ€æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g<br></code></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>localhost:4000</code>è¿›è¡Œè®¿é—®</p><h2 id="3-å°†hexoéƒ¨ç½²åˆ°github"><a href="#3-å°†hexoéƒ¨ç½²åˆ°github" class="headerlink" title="3.å°†hexoéƒ¨ç½²åˆ°github"></a>3.å°†hexoéƒ¨ç½²åˆ°github</h2><h3 id="3-1-æ–°å»ºä¸€ä¸ªgithubä»“åº“"><a href="#3-1-æ–°å»ºä¸€ä¸ªgithubä»“åº“" class="headerlink" title="3.1 æ–°å»ºä¸€ä¸ªgithubä»“åº“"></a>3.1 æ–°å»ºä¸€ä¸ªgithubä»“åº“</h3><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåˆ›å»ºçš„ä»“åº“åå¿…é¡»ä¸ä½ çš„usernameæ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚æˆ‘çš„usrnameæ˜¯anmuxixixiï¼Œåˆ™åˆ›å»ºçš„ä»“åº“åä¸ºanmuxixixi.github.ioï¼›è¯¦æƒ…è§GitHubå¦‚ä½•åˆ›å»ºä¸€ä¸ªPage</p></blockquote><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/åˆ›å»ºgithub.jpg" alt="image-20230114121402814" style="zoom: 60%;"><h3 id="3-2-å®‰å“hexoé’ˆå¯¹gitçš„deployç»„ä»¶"><a href="#3-2-å®‰å“hexoé’ˆå¯¹gitçš„deployç»„ä»¶" class="headerlink" title="3.2 å®‰å“hexoé’ˆå¯¹gitçš„deployç»„ä»¶"></a>3.2 å®‰å“hexoé’ˆå¯¹gitçš„deployç»„ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install --save hexo-deployer-git<br></code></pre></td></tr></table></figure><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/å®‰è£…æ’ä»¶.png" alt="image-20230114121402814" style="zoom: 80%;"><h3 id="3-2-éƒ¨ç½²åˆ°github"><a href="#3-2-éƒ¨ç½²åˆ°github" class="headerlink" title="3.2 éƒ¨ç½²åˆ°github"></a>3.2 éƒ¨ç½²åˆ°github</h3><p>æ‰“å¼€é¡¹ç›®çš„<code>_config.xml</code>ï¼Œè®¾ç½®<code>deploy</code>å±æ€§</p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/è®¾ç½®deploy.png" alt="image-20230114121402814" style="zoom: 80%;"><blockquote><p> è¿™ä¸ªrepoå¯¹åº”çš„ä»“åº“åå°±æ˜¯æˆ‘ä»¬çš„<strong>githubä»“åº“åœ°å€</strong></p></blockquote><p>å°†å…¶éƒ¨ç½²åˆ°githubä¸Š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo cl</span><br><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo d</span><br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è¾“å…¥<code>https://anmuxixixi.github.io/</code></p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/æ‰“å¼€ä»“åº“.png" alt="image-20230114121402814" style="zoom: 50%;"><h2 id="4-è®¾ç½®ä¸»é¢˜"><a href="#4-è®¾ç½®ä¸»é¢˜" class="headerlink" title="4.è®¾ç½®ä¸»é¢˜"></a>4.è®¾ç½®ä¸»é¢˜</h2><h3 id="4-1-å®‰è£…ä¸»é¢˜"><a href="#4-1-å®‰è£…ä¸»é¢˜" class="headerlink" title="4.1 å®‰è£…ä¸»é¢˜"></a>4.1 å®‰è£…ä¸»é¢˜</h3><ul><li>Hexoå®˜æ–¹è®¾ç½®ä¸»é¢˜çš„ç½‘ç«™ï¼š<a href="https://hexo.io/themes/">https://hexo.io/themes/</a></li><li>Fluidä¸»é¢˜ï¼š<a href="https://github.com/fluid-dev/hexo-theme-fluid">https://github.com/fluid-dev/hexo-theme-fluid</a></li><li>Fluidä¸»é¢˜æ–‡æ¡£ï¼š<a href="https://hexo.fluid-dev.com/docs/guide/">https://hexo.fluid-dev.com/docs/guide/</a></li></ul><p>æ‰“å¼€githubï¼Œä¸‹è½½å¥½Fluidä¸»é¢˜ï¼Œå°†å…¶è§£å‹æ”¾åœ¨themesæ–‡ä»¶å¤¹ä¸‹</p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/ä¸‹è½½ä¸»é¢˜.png" alt="image-20230114121402814" style="zoom: 80%;"><p>æ‰“å¼€<code>_config.xml</code>ï¼Œè®¾ç½®<code>theme</code>ä¸º<code>fluid</code>ï¼Œè®¾ç½®<code>language</code>ä¸º<code>zh-CN</code></p><p>å¯åŠ¨åçœ‹ä¸‹æ•´ä½“çš„æ•ˆæœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo cl &amp;&amp; hexo g &amp;&amp; hexo s<br></code></pre></td></tr></table></figure><h3 id="4-2-ç®€å•çš„é¡µé¢è®¾ç½®"><a href="#4-2-ç®€å•çš„é¡µé¢è®¾ç½®" class="headerlink" title="4.2 ç®€å•çš„é¡µé¢è®¾ç½®"></a>4.2 ç®€å•çš„é¡µé¢è®¾ç½®</h3><ol><li>ä¿®æ”¹ç½‘é¡µå¯¼èˆªæ æ ‡é¢˜</li></ol><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/ä¿®æ”¹ç½‘é¡µæ ‡é¢˜.png" alt="image-20230114203236266" style="zoom:67%;"><p>å…¶å¯¹åº”çš„æ•ˆæœå¦‚ä¸‹</p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/æ ‡é¢˜æ .png"><ol start="2"><li>ä¿®æ”¹èƒŒæ™¯å›¾ç‰‡</li></ol><p>è‡ªå·±å¤åˆ¶ä¸€å¼ å›¾ç‰‡ï¼Œå°†åå­—ä¿®æ”¹ä¸º<code>default.png</code></p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/èƒŒæ™¯.png"><ol start="3"><li>ä¿®æ”¹ä¸­é—´æ‰“å­—æœºæ–‡å­—</li></ol><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/æ‰“å­—æœº.png" alt="image-20230114203653973" style="zoom:79%;"><ol start="4"><li>æ•´ä½“æ•ˆæœå¦‚ä¸‹</li></ol><p><a href="https://anmuxixixi.github.io/">https://anmuxixixi.github.io/</a></p><p>æ¬¢è¿å“å°ğŸŒ­</p><img src="/2023/01/14/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BAhexo%E9%83%A8%E7%BD%B2%E5%88%B0github/zhengti.png">]]></content>
    
    
    <categories>
      
      <category>è½¯ä»¶å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>



<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="OneAmx">
  <meta name="keywords" content="">
  
    <meta name="description" content="f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ğŸ’Œ æ„Ÿè°¢HZero.chenï¼Œè®©æˆ‘å¯¹f2fsæ–‡ä»¶ç³»ç»Ÿçš„å¸ƒå±€æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†~æ–‡ç« è®¸å¤šå›¾ç‰‡éƒ½æ¥æ¥è‡ªäºä»–çš„æ–‡ç« ï¼Œä»…ä½œæœ¬äººå­¦ä¹ å¤‡å¿˜ 1.å‡†å¤‡å®éªŒç¯å¢ƒæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªé•œåƒï¼Œå°†å…¶æ ¼å¼åŒ–ä¸ºf2fsæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸loopè®¾å¤‡è¿›è¡Œç»‘å®šï¼Œéšåè¿›è¡ŒæŒ‚è½½ 12345sudo apt-get install -y f2fs-tools             &#x2F;&#x2F; å®‰è£…f2fså·¥å…·dd if&#x3D;&#x2F;de">
<meta property="og:type" content="article">
<meta property="og:title" content="f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€">
<meta property="og:url" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/index.html">
<meta property="og:site_name" content="ä¸€åªå®‰æ…•å˜»">
<meta property="og:description" content="f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ğŸ’Œ æ„Ÿè°¢HZero.chenï¼Œè®©æˆ‘å¯¹f2fsæ–‡ä»¶ç³»ç»Ÿçš„å¸ƒå±€æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†~æ–‡ç« è®¸å¤šå›¾ç‰‡éƒ½æ¥æ¥è‡ªäºä»–çš„æ–‡ç« ï¼Œä»…ä½œæœ¬äººå­¦ä¹ å¤‡å¿˜ 1.å‡†å¤‡å®éªŒç¯å¢ƒæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªé•œåƒï¼Œå°†å…¶æ ¼å¼åŒ–ä¸ºf2fsæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸loopè®¾å¤‡è¿›è¡Œç»‘å®šï¼Œéšåè¿›è¡ŒæŒ‚è½½ 12345sudo apt-get install -y f2fs-tools             &#x2F;&#x2F; å®‰è£…f2fså·¥å…·dd if&#x3D;&#x2F;de">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719212612079.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/1.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719213848821.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/2.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/3.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/4.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/5.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/6.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719233445458.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719234855034.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719235441702.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719235854137.png">
<meta property="og:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230723231428571.png">
<meta property="article:published_time" content="2023-07-19T13:18:29.000Z">
<meta property="article:modified_time" content="2023-07-23T15:30:36.308Z">
<meta property="article:author" content="OneAmx">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719212612079.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ - ä¸€åªå®‰æ…•å˜»</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"5f9d3edcc5e93f7fb0c85cf03554f3aa","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5f9d3edcc5e93f7fb0c85cf03554f3aa";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ä¸€åªå®‰æ…•å˜»</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-07-19 21:18" pubdate>
          2023å¹´7æœˆ19æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          88 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          æµè§ˆ <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€"><a href="#f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€" class="headerlink" title="f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€"></a>f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</h1><p>ğŸ’Œ æ„Ÿè°¢<a target="_blank" rel="noopener" href="https://blog.csdn.net/jasonactions/article/details/122409327">HZero.chen</a>ï¼Œè®©æˆ‘å¯¹f2fsæ–‡ä»¶ç³»ç»Ÿçš„å¸ƒå±€æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†~æ–‡ç« è®¸å¤šå›¾ç‰‡éƒ½æ¥æ¥è‡ªäºä»–çš„æ–‡ç« ï¼Œä»…ä½œæœ¬äººå­¦ä¹ å¤‡å¿˜</p>
<h2 id="1-å‡†å¤‡å®éªŒç¯å¢ƒ"><a href="#1-å‡†å¤‡å®éªŒç¯å¢ƒ" class="headerlink" title="1.å‡†å¤‡å®éªŒç¯å¢ƒ"></a>1.å‡†å¤‡å®éªŒç¯å¢ƒ</h2><p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªé•œåƒï¼Œå°†å…¶æ ¼å¼åŒ–ä¸ºf2fsæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸loopè®¾å¤‡è¿›è¡Œç»‘å®šï¼Œéšåè¿›è¡ŒæŒ‚è½½</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install -y f2fs-tools             // å®‰è£…f2fså·¥å…·<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=f2fs.img bs=4K count=51200  // åˆ›å»º200Mçš„f2fs.img<br>mkfs.f2fs -l f2fs f2fs.img                     // æ ¼å¼åŒ–ä¸ºf2fs<br>sudo losetup /dev/loop0 f2fs.img               // å°†loop0ä¸f2fs.imgç»‘å®šã€å¯ä»¥é€šè¿‡losetup -fæŸ¥çœ‹å½“å‰ç©ºé—²loopè®¾å¤‡ã€‘<br>sudo mount /dev/loop0 ./mntf2fs/               // å°†loop0è¿›è¡ŒæŒ‚è½½<br></code></pre></td></tr></table></figure>

<p>ä¸ºäº†æ¨¡æ‹ŸçœŸå®çš„f2fsæ–‡ä»¶ç³»ç»Ÿçš„flashè®¾å¤‡ï¼Œæˆ‘ä»¬å¾€é‡Œé¢æ”¾ä¸€äº›ææ–™</p>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719212612079.png" srcset="/img/loading.gif" lazyload alt="image-20230719212612079" style="zoom: 80%;">

<ul>
<li>foo.txtæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œé‡Œé¢åªæœ‰ä¸€å¥è¯å°±æ˜¯hello amx</li>
<li>meinv.jpgæ˜¯ä¸€ä¸ªjpgæ ¼å¼çš„å›¾ç‰‡ï¼Œå¤§å°çº¦ä¸º5.40Mb</li>
</ul>
<h2 id="2-æ•´ä½“å¸ƒå±€"><a href="#2-æ•´ä½“å¸ƒå±€" class="headerlink" title="2.æ•´ä½“å¸ƒå±€"></a>2.æ•´ä½“å¸ƒå±€</h2><blockquote>
<p>è¿™å¼ å›¾æ¥è‡ªäºè®ºæ–‡ï¼šã€Š<strong>F2FS: A New File System for Flash Storage</strong>ã€‹</p>
</blockquote>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/1.png" srcset="/img/loading.gif" lazyload alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 80%;">

<p>å¯ä»¥çœ‹åˆ°æ•´ä½“å¸ƒå±€æ˜¯å¸¸è§„çš„æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€æ–¹å¼ï¼š<strong>è¶…çº§å— + å…ƒæ•°æ®åŒº + ç”¨æˆ·æ•°æ®åŒº</strong>ï¼›</p>
<ul>
<li>å…ƒæ•°æ®åŒºåˆ†ä¸ºäº†CPã€SITã€NATã€SSAå››ä¸ªåŒºåŸŸï¼Œè¿™å››ä¸ªåŒºåŸŸéƒ½æ˜¯ä»¥Segmentä¸ºå•ä½è¿›è¡Œå¯¹é½çš„ã€‚</li>
<li>å› f2fsä¸ºæ—¥å¿—ç»“æ„æ–‡ä»¶ç³»ç»ŸLFSï¼Œæ‰€ä»¥å…¶ç”¨æˆ·æ•°æ®åŒºä¹Ÿç§°ä¸ºæ—¥å¿—åŒºMain Areaã€‚f2fsä¸åŒäºä¼ ç»Ÿçš„LFSå°†æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªæ—¥å¿—é‡Œé¢ï¼Œf2fså°†å…¶åˆ’åˆ†ä¸ºäº†Node Segmentå’ŒData Segmentï¼Œåˆæ ¹æ®å…¶æ˜¯å¦ç»å¸¸æ”¹åŠ¨åˆ’åˆ†ä¸ºäº†Hotã€Warmå’ŒColdï¼Œå› æ­¤æ€»å…±æ˜¯6ç§å½¢å¼ã€‚</li>
</ul>
<hr>
<p><strong>f2fsåŸºæœ¬æ•°æ®å•ä½</strong></p>
<ul>
<li><strong>block</strong>: F2FSçš„æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½æ˜¯blockï¼Œå¤§å°ä¸º4KBï¼Œæ•´ä¸ªflashè®¾å¤‡è¢«æ ¼å¼åŒ–ä¸ºå¤šä¸ªblockç»„æˆçš„ç»“æ„ã€‚å¾ˆå¤šæ•°æ®ç»“æ„ä¹Ÿè¢«è®¾è®¡ä¸º4KBçš„å¤§å°ï¼Œè¿™æ˜¯å› ä¸ºå¾ˆå¤šflashè®¾å¤‡å•æ¬¡IOçš„è¯»å†™éƒ½æ˜¯åŸºäº4KBçš„å€æ•°è¿›è¡Œã€‚</li>
<li><strong>segment</strong>: segmentæ˜¯ç®¡ç†blockçš„ç»“æ„ï¼Œä¸€ä¸ªsegmentçš„å¤§å°æ˜¯512ä¸ªblockï¼Œä¹Ÿå°±æ˜¯2MBã€‚</li>
<li><strong>section</strong>: é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªsegmentç­‰äºä¸€ä¸ªsectionï¼Œsectionæ˜¯GCçš„åŸºæœ¬æ“ä½œå•ä½ï¼Œæ¯æ¬¡GCéƒ½ä¼šä»sectionä¸­é€‰å‡ºç‰¹å®šçš„segmentè¿›è¡Œå›æ”¶ã€‚F2FSå°†sectionåˆ†ä¸ºäº†6ç±»ï¼Œåˆ†åˆ«æ˜¯hot-nodeï¼Œwarm-nodeï¼Œcold-nodeï¼Œhot-dataï¼Œwarm-dataï¼Œcold-dataï¼Œhot-&gt;coldè¡¨ç¤ºäº†æ•°æ®çš„ä»é«˜åˆ°ä½çš„ä¿®æ”¹é¢‘ç‡ï¼Œé€šè¿‡ä¸åŒç±»å‹sectionï¼šè¿›è¡Œgcçš„æ—¶å€™å¯é’ˆå¯¹ä½¿ç”¨hotçš„sectionè¿›è¡Œgcï¼Œä»¥é™ä½gcçš„æ—¶é—´å¼€é”€ã€‚</li>
<li><strong>zone</strong>: é»˜è®¤æƒ…å†µä¸€ä¸ªzoneç­‰äºä¸€ä¸ªsectionï¼Œä¸ç‰©ç†è®¾å¤‡æœ‰å…³ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç”¨ä¸ä¸Š</li>
</ul>
<h3 id="2-1-è¶…çº§å—SuperBlock"><a href="#2-1-è¶…çº§å—SuperBlock" class="headerlink" title="2.1 è¶…çº§å—SuperBlock"></a>2.1 è¶…çº§å—SuperBlock</h3><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œf2fsçš„superblockä¸æ˜¯ä»0x0å¼€å§‹ï¼Œè€Œæ˜¯é¢„ç•™äº†1KBï¼Œå³å…¶åç§»é‡ä¸º0x400</p>
<blockquote>
<p>è¯»è€…å¯ä»¥é€šè¿‡<strong>hexdump</strong>å‘½ä»¤æŸ¥çœ‹supeblockæˆ–è€…é€šè¿‡<strong>ultra edit</strong>æ‰‹åŠ¨æŸ¥çœ‹</p>
</blockquote>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719213848821.png" srcset="/img/loading.gif" lazyload alt="image-20230719213848821" style="zoom:80%;">

<p>ğŸ”´ <strong>æ³¨æ„</strong>ï¼šæˆ‘ä»¬è¿™é‡Œåªå…³æ³¨Diskæœ¬èº«çš„å¸ƒå±€æ–¹å¼ï¼Œè€Œä¸å…³æ³¨å…¶åœ¨å†…å­˜ä¸­çš„è¡¨ç°å½¢å¼ï¼</p>
<p>å…¶å¯¹åº”äº†<code>f2fs_super_block</code>ç»“æ„ä½“</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_super_block</span> &#123;</span><br>	__le32 magic;			<span class="hljs-comment">/* Magic Number */</span><br>	__le16 major_ver;		<span class="hljs-comment">/* Major Version */</span><br>	__le16 minor_ver;		<span class="hljs-comment">/* Minor Version */</span><br>	__le32 log_sectorsize;		<span class="hljs-comment">/* log2 sector size in bytes */</span><br>	__le32 log_sectors_per_block;	<span class="hljs-comment">/* log2 # of sectors per block */</span><br>	__le32 log_blocksize;		<span class="hljs-comment">/* log2 block size in bytes */</span><br>	__le32 log_blocks_per_seg;	<span class="hljs-comment">/* log2 # of blocks per segment */</span><br>	__le32 segs_per_sec;		<span class="hljs-comment">/* # of segments per section */</span><br>	__le32 secs_per_zone;		<span class="hljs-comment">/* # of sections per zone */</span><br>	__le32 checksum_offset;		<span class="hljs-comment">/* checksum offset inside super block */</span><br>	__le64 block_count;		<span class="hljs-comment">/* total # of user blocks */</span><br>	__le32 section_count;		<span class="hljs-comment">/* total # of sections */</span><br>	__le32 segment_count;		<span class="hljs-comment">/* total # of segments */</span><br>	__le32 segment_count_ckpt;	<span class="hljs-comment">/* # of segments for checkpoint */</span><br>	__le32 segment_count_sit;	<span class="hljs-comment">/* # of segments for SIT */</span><br>	__le32 segment_count_nat;	<span class="hljs-comment">/* # of segments for NAT */</span><br>	__le32 segment_count_ssa;	<span class="hljs-comment">/* # of segments for SSA */</span><br>	__le32 segment_count_main;	<span class="hljs-comment">/* # of segments for main area */</span><br>	__le32 segment0_blkaddr;	<span class="hljs-comment">/* start block address of segment 0 */</span><br>	__le32 cp_blkaddr;		<span class="hljs-comment">/* start block address of checkpoint */</span><br>	__le32 sit_blkaddr;		<span class="hljs-comment">/* start block address of SIT */</span><br>	__le32 nat_blkaddr;		<span class="hljs-comment">/* start block address of NAT */</span><br>	__le32 ssa_blkaddr;		<span class="hljs-comment">/* start block address of SSA */</span><br>	__le32 main_blkaddr;		<span class="hljs-comment">/* start block address of main area */</span><br>	__le32 root_ino;		<span class="hljs-comment">/* root inode number */</span><br>	__le32 node_ino;		<span class="hljs-comment">/* node inode number */</span><br>	__le32 meta_ino;		<span class="hljs-comment">/* meta inode number */</span><br>	__u8 uuid[<span class="hljs-number">16</span>];			<span class="hljs-comment">/* 128-bit uuid for volume */</span><br>	__le16 volume_name[MAX_VOLUME_NAME];	<span class="hljs-comment">/* volume name */</span><br>	__le32 extension_count;		<span class="hljs-comment">/* # of extensions below */</span><br>	__u8 extension_list[F2FS_MAX_EXTENSION][F2FS_EXTENSION_LEN];<span class="hljs-comment">/* extension array */</span><br>	__le32 cp_payload;<br>	__u8 version[VERSION_LEN];	<span class="hljs-comment">/* the kernel version */</span><br>	__u8 init_version[VERSION_LEN];	<span class="hljs-comment">/* the initial kernel version */</span><br>	__le32 feature;			<span class="hljs-comment">/* defined features */</span><br>	__u8 encryption_level;		<span class="hljs-comment">/* versioning level for encryption */</span><br>	__u8 encrypt_pw_salt[<span class="hljs-number">16</span>];	<span class="hljs-comment">/* Salt used for string2key algorithm */</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_device</span> <span class="hljs-title">devs</span>[<span class="hljs-title">MAX_DEVICES</span>];</span>	<span class="hljs-comment">/* device list */</span><br>	__le32 qf_ino[F2FS_MAX_QUOTAS];	<span class="hljs-comment">/* quota inode numbers */</span><br>	__u8 hot_ext_count;		<span class="hljs-comment">/* # of hot file extension */</span><br>	__le16  s_encoding;		<span class="hljs-comment">/* Filename charset encoding */</span><br>	__le16  s_encoding_flags;	<span class="hljs-comment">/* Filename charset encoding flags */</span><br>	__u8 reserved[<span class="hljs-number">306</span>];		<span class="hljs-comment">/* valid reserved region */</span><br>	__le32 crc;			<span class="hljs-comment">/* checksum of superblock */</span><br>&#125; __packed;<br></code></pre></td></tr></table></figure>



<ul>
<li><strong>ç¬¬ä¸€ä¸ªSuperBlock(sb#1)å¦‚ä¸‹æ‰€ç¤ºã€åç§»0x400ã€‘ï¼š</strong></li>
</ul>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/2.png" srcset="/img/loading.gif" lazyload alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:67%;">

<ul>
<li><strong>ç¬¬äºŒä¸ªSuperBlock(sb#2)å¦‚ä¸‹æ‰€ç¤ºã€åç§»0x1400ã€‘ï¼š</strong></li>
</ul>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/3.png" srcset="/img/loading.gif" lazyload alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 50%;">

<blockquote>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/634651371">https://zhuanlan.zhihu.com/p/634651371</a></p>
</blockquote>
<ul>
<li><p><strong>magic</strong>ï¼šf2fsçš„é­”æ•°å­—ï¼Œç”¨æ¥æ£€æŸ¥SuperBlockæ˜¯å¦ç ´æŸï¼Œå…¶å†…å®¹å›ºå®šä¸º0xF2F52010ã€‚</p>
</li>
<li><p><strong>major_verã€minor_ver</strong>ï¼šè¿™ä¸¤ä¸ªæ˜¯Linuxç”¨äºæ ‡è¯†ä¸€ä¸ªå—è®¾å¤‡çš„ä¸»æ¬¡å·ï¼Œä¸»æ¬¡å·å¯ä»¥ç¡®å®šç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªå—è®¾å¤‡ã€‚</p>
</li>
<li><p><strong>log_sectorsize</strong>ï¼šå—è®¾å¤‡ä¸­ä¸€ä¸ªæ‰‡åŒºå¤§å°ï¼Œæ™®é€šè®¾å¤‡æ˜¯512ï¼Œæ­¤å¤„æ˜¯å¯¹2å–å¯¹æ•°åçš„ç»“æœï¼Œæ‰€ä»¥æ˜¯9ã€‚</p>
</li>
<li><p><strong>log_sectors_per_block</strong>ï¼šä¸€ä¸ªblockå¯¹åº”æ‰‡åŒºæ•°ï¼Œå¹¶å¯¹2å–å¯¹æ•°åçš„ç»“æœï¼Œä¸€ä¸ªblockæ˜¯4KBï¼Œè€Œsectoræ˜¯512ï¼Œæ‰€ä»¥ç»“æœæ˜¯3ã€‚</p>
</li>
<li><p><strong>log_blocksize</strong>ï¼šä¸€ä¸ªblockå¤§å°å¯¹2å–å¯¹æ•°çš„ç»“æœï¼Œä¹Ÿå³log2(4096)ï¼Œç»“æœæ˜¯12ã€‚</p>
</li>
<li><p><strong>log_blocks_per_seg</strong>ï¼šä¸€ä¸ªsegmentå¯¹åº”çš„blockæ•°ç›®ï¼Œå¹¶å¯¹2å–å¯¹æ•°çš„ç»“æœï¼Œç»“æœæ˜¯9ã€‚</p>
</li>
<li><p><strong>segs_per_secã€secs_per_zone</strong>ï¼šåˆ†åˆ«æ˜¯ä¸€ä¸ªsectionå¯¹åº”çš„segmengæ•°é‡å’Œä¸€ä¸ªzoneå¯¹åº”çš„sectionæ•°é‡ï¼Œé»˜è®¤ä¸¤è€…å‡ä¸º1ã€‚</p>
</li>
<li><p><strong>crc_offsetã€crc</strong>ï¼šSuperBlockä¸­çš„crcå­—æ®µåç§»é‡ï¼Œcrcåˆ™æ˜¯è¯¥SuperBlockç»“æ„ä½“çš„crcè®¡ç®—ç»“æœï¼Œç”¨äºæ£€æŸ¥SuperBlockçš„æ­£ç¡®æ€§ã€‚å…¶ä¸­è¿™ä¸¤ä¸ªå­—æ®µç”±F2FS_FEATURE_SB_CHKSUMæ ‡è®°ä½æ§åˆ¶ï¼Œå¦‚æœè®¾ç½®äº†è¯¥æ ‡è®°ï¼Œmkfsæ‰ä¼šçœŸæ­£å†™å…¥è¿™ä¸¤ä¸ªå­—æ®µçš„å†…å®¹ã€‚</p>
</li>
<li><p><strong>block_count</strong>ï¼šæ•´ä¸ªå—è®¾å¤‡çš„blockä¸ªæ•°ï¼Œéœ€è¦åš4KBå¯¹é½ï¼Œå¦‚æœå¯¹åº”å¤šä¸ªè®¾å¤‡ï¼Œè®¡ç®—çš„æ˜¯æ‰€æœ‰è®¾å¤‡çš„blockä¸ªæ•°ã€‚</p>
</li>
<li><p><strong>section_count</strong>ï¼šMain Areaå¯¹åº”çš„sectionä¸ªæ•°ï¼Œå¦‚æœæ˜¯å¤šè®¾å¤‡ï¼Œéœ€è¦å…¨éƒ¨è®¡ç®—ã€‚</p>
</li>
<li><p><strong>segment_count_ckpt</strong>ï¼šCPåŒºåŸŸæ‰€å çš„segmentæ•°ï¼ŒCPåŒºåŸŸå›ºå®šå 2ä¸ªsegmentã€‚</p>
</li>
<li><p><strong>segment_count_sit</strong>ï¼šSITåŒºåŸŸæ‰€å ç”¨çš„segmentæ•°ï¼Œè¿™ä¸ªæ˜¯æ ¹æ®segment_countçš„å€¼ç¡®å®šçš„ï¼Œä¸€ä¸ªf2fs_sit_entryç»“æ„ä½“å 74å­—èŠ‚ï¼Œæ‰€ä»¥ä¸€ä¸ªblockå¯å®¹çº³56ä¸ªf2fs_sit_entryï¼Œä¹Ÿå³ä¸€ä¸ªsegmentå¯å®¹çº³28672ä¸ªf2fs_sit_entryï¼Œå¯¹åº”çš„æ˜¯56Gã€‚ä½†ç”±äºSITæœ‰ä¸€ä¸ªå¤‡ä»½åŒºåŸŸï¼Œæ‰€ä»¥æ¯56Gçš„å¤§å°å°±éœ€è¦2ä¸ªsegmentã€‚æ³¨æ„ï¼šSITåŒºåŸŸç®¡ç†ç³»ç»Ÿä¸­æ‰€æœ‰çš„segmentï¼ŒåŒ…æ‹¬CPåŒºåŸŸå’ŒSITåŒºåŸŸè‡ªèº«ã€‚</p>
</li>
<li><p><strong>segment_count_nat</strong>ï¼šNATåŒºåŸŸæ‰€å ç”¨çš„segmentæ•°ï¼Œå¯¹åº”çš„æ˜¯ä»NATåŒºåŸŸå¼€å§‹çš„æ‰€æœ‰blockï¼ˆåŒ…æ‹¬NATã€SSAã€Nodeã€DataåŒºåŸŸï¼‰ã€‚ä¸€ä¸ªf2fs_nat_entryå¤§å°æ˜¯9å­—èŠ‚ï¼Œæ‰€ä»¥ä¸€ä¸ªblockå¯¹åº”455ä¸ªf2fs_nat_entryã€‚åŒæ ·ï¼ŒNATåŒºåŸŸä¹Ÿæœ‰ä¸€ä¸ªå¤‡ä»½åŒºã€‚</p>
</li>
<li><p><strong>segment_count_ssa</strong>ï¼šSSAåŒºåŸŸæ‰€å ç”¨çš„segmengæ•°ï¼Œä¸€ä¸ªSSA Blockå¯¹åº”çš„æ˜¯ä¸€ä¸ªsegmentä¿¡æ¯ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSSAåŒºåŸŸä¸»è¦æ˜¯ç”¨äºGCæµç¨‹çš„ï¼Œå¦‚æœf2fsåœ¨mkfsçš„æ—¶å€™æŒ‡å®šäº†åªè¯»å±æ€§ï¼Œé‚£ä¹ˆè¯¥åŒºåŸŸä¹Ÿå°±æ²¡å¿…è¦çš„ã€‚å¯¹åº”çš„æ˜¯ä»SSAåŒºåŸŸå¼€å§‹çš„æ‰€æœ‰segmentçš„ç®¡ç†ã€‚SSAåŒºåŸŸä¸åšå¤‡ä»½ã€‚</p>
</li>
<li><p><strong>segment_count_main</strong>ï¼šMain AreaåŒºåŸŸå¯¹åº”çš„segmentæ•°ï¼ŒåŒ…æ‹¬Nodeå’ŒDataçš„åŒºåŸŸã€‚</p>
</li>
<li><p><strong>segment0_blkaddr</strong>ï¼šç¬¬ä¸€ä¸ªsegmentçš„å¼€å§‹å¯¹åº”çš„blockå·ï¼Œæ³¨æ„ï¼šæœ¬æ¥ç¬¬ä¸€ä¸ªsegmentåº”è¯¥å¯¹åº”çš„æ˜¯SuperBlockï¼Œä½†æ˜¯f2fsæ˜¯ä»CPåŒºåŸŸå¼€å§‹å¯¹segmentè¿›è¡Œç¼–ç çš„ï¼Œæ‰€ä»¥å¯¹åº”çš„æ˜¯CPåŒºåŸŸçš„å¼€å§‹blockã€‚</p>
</li>
<li><p>â­<strong>cp_blkaddr</strong>ï¼šCPåŒºåŸŸçš„èµ·å§‹blockå·ï¼Œå’Œsegment0_blkaddrä¸€æ ·ã€‚</p>
</li>
<li><p>â­<strong>sit_blkaddr</strong>ï¼šSITåŒºåŸŸçš„èµ·å§‹blockå·ã€‚</p>
</li>
<li><p>â­<strong>nat_blkaddr</strong>ï¼šNATåŒºåŸŸçš„èµ·å§‹blockå·ã€‚</p>
</li>
<li><p>â­<strong>ssa_blkaddr</strong>ï¼šSSAåŒºåŸŸçš„èµ·å§‹blockå·ã€‚</p>
</li>
<li><p>â­<strong>main_blkaddr</strong>ï¼šMain Areaå¼€å§‹çš„blockå·ã€‚</p>
</li>
<li><p><strong>root_inoã€meta_inoã€node_ino</strong>ï¼šåˆ†åˆ«æ˜¯root inodeå·ï¼Œå›ºå®šæ˜¯3ï¼›å…ƒæ•°æ®inodeå·ï¼Œå›ºå®šæ˜¯2ï¼›Nodeå¯¹åº”çš„inodeå·ï¼Œå›ºå®šæ˜¯1ã€‚å…¶ä¸­root_inoæ˜¯æ ¹ç›®å½•çš„inodeå·ï¼Œåœ¨æ–‡ä»¶ç³»ç»ŸæŒ‚è½½çš„æ˜¯æ—¶å€™åˆå§‹åŒ–ï¼Œè€Œmeta_inoåˆ™å¯¹åº”å…ƒæ•°æ®åŒºåŸŸï¼Œç¼“å­˜å…ƒæ•°æ®çš„page cacheï¼›node_inoåˆ™å¯¹åº”çš„æ˜¯æ‰€æœ‰nodeçš„page cache</p>
</li>
<li><p><strong>uuid</strong>ï¼šéšæœºå€¼ç›å€¼ï¼Œç”¨äºè®¡ç®—inodeçš„crcã€‚</p>
</li>
<li><p><strong>volume_name</strong>ï¼šåˆ†åŒºåã€‚</p>
</li>
<li><p><strong>extension_list</strong>ï¼šå¯ä»¥é€šè¿‡ioctlè®¾å®šå°†å“ªäº›æ–‡ä»¶æ ‡è®°ä¸ºcoldï¼Œä¸€èˆ¬æ˜¯è¯»å¤šå†™å°‘çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šmp3ã€gifç­‰ç­‰</p>
</li>
<li><p><strong>version</strong>ï¼šmkfsæ—¶çš„linuxçš„ç‰ˆæœ¬å·ã€‚</p>
</li>
<li><p><strong>feature</strong>ï¼šmkfsæŒ‡å®šçš„ç‰¹æ€§åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼šåŠ å¯†ã€SuperBlockçš„crcæ£€æŸ¥ç­‰ç­‰ã€‚&#x2F;sys&#x2F;fs&#x2F;f2fs&#x2F;features&#x2F;è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„ç‰¹æ€§ã€‚</p>
</li>
<li><p><strong>encrypt_pw_salt</strong>ï¼šå¯†é’¥çš„åŠ å¯†ç›å€¼ï¼Œå¯é€šè¿‡ioctlè·å–ã€‚</p>
</li>
<li><p><strong>devs</strong>ï¼šæ–‡ä»¶ç³»ç»Ÿå¯¹åº”çš„è®¾å¤‡åˆ—è¡¨ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½æœ‰å„è‡ªçš„åœ°å€è®¿é—®ï¼Œåœ¨å†™æ•°æ®çš„æ—¶å€™éœ€è¦éå†æ‰€æœ‰è®¾å¤‡ã€‚</p>
</li>
<li><p><strong>s_encodingã€s_encoding_flags</strong>ï¼šæ–‡ä»¶åç¼–ç æ ¼å¼ï¼Ÿ</p>
</li>
<li><p><strong>s_stop_reason</strong>ï¼šCPåœæ­¢çš„åŸå› ï¼ˆCPå¤±è´¥çš„åŸå› ï¼Ÿï¼‰</p>
</li>
<li><p><strong>s_errors</strong>ï¼šæ–‡ä»¶ç³»ç»ŸæŸåçš„åŸå› ã€‚</p>
</li>
</ul>
<h3 id="2-2-CheckPoint"><a href="#2-2-CheckPoint" class="headerlink" title="2.2 CheckPoint"></a>2.2 CheckPoint</h3><img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/4.png" srcset="/img/loading.gif" lazyload alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 67%;">

<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/5.png" srcset="/img/loading.gif" lazyload alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 67%;">

<blockquote>
<p>å¦‚ä¸Šä¸ºcp blockçš„æ€»ä½“å¸ƒå±€ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š<strong>nomal mode</strong>å’Œ<strong>compact mode</strong>.é€šè¿‡é•œåƒå¯çŸ¥ï¼Œæœ¬æ–‡åˆ›å»ºçš„é•œåƒçš„CPä¸ºcompact mode<br>ckpt_flagsçš„å€¼æ˜¯5ï¼Œé€šè¿‡ckpt_flags &amp; CP_COMPACT_SUM_FLAGçš„å€¼ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œå®ƒå°±æ˜¯compact mode.<br>cpåŒºåŸŸä¸»è¦åŒ…å«ä¸¤ä¸ªcp packï¼Œæ¯ä¸ªcp packå æ®ä¸€ä¸ªsegmentã€‚</p>
</blockquote>
<h4 id="2-2-1-cp-page-1"><a href="#2-2-1-cp-page-1" class="headerlink" title="2.2.1 cp page 1"></a>2.2.1 cp page 1</h4><p>å…¶å¯¹åº”çš„æ•°æ®ç»“æ„ä¸º<code>f2fs_checkpoint</code>ç»“æ„ä½“</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_checkpoint</span> &#123;</span><br>	__le64 checkpoint_ver;		<span class="hljs-comment">/* checkpoint block version number */</span><br>	__le64 user_block_count;	<span class="hljs-comment">/* # of user blocks */</span><br>	__le64 valid_block_count;	<span class="hljs-comment">/* # of valid blocks in main area */</span><br>	__le32 rsvd_segment_count;	<span class="hljs-comment">/* # of reserved segments for gc */</span><br>	__le32 overprov_segment_count;	<span class="hljs-comment">/* # of overprovision segments */</span><br>	__le32 free_segment_count;	<span class="hljs-comment">/* # of free segments in main area */</span><br><br>	<span class="hljs-comment">/* information of current node segments */</span><br>	__le32 cur_node_segno[MAX_ACTIVE_NODE_LOGS];<br>	__le16 cur_node_blkoff[MAX_ACTIVE_NODE_LOGS];<br>	<span class="hljs-comment">/* information of current data segments */</span><br>	__le32 cur_data_segno[MAX_ACTIVE_DATA_LOGS];<br>	__le16 cur_data_blkoff[MAX_ACTIVE_DATA_LOGS];<br>	__le32 ckpt_flags;		<span class="hljs-comment">/* Flags : umount and journal_present */</span><br>	__le32 cp_pack_total_block_count;	<span class="hljs-comment">/* total # of one cp pack */</span><br>	__le32 cp_pack_start_sum;	<span class="hljs-comment">/* start block number of data summary */</span><br>	__le32 valid_node_count;	<span class="hljs-comment">/* Total number of valid nodes */</span><br>	__le32 valid_inode_count;	<span class="hljs-comment">/* Total number of valid inodes */</span><br>	__le32 next_free_nid;		<span class="hljs-comment">/* Next free node number */</span><br>	__le32 sit_ver_bitmap_bytesize;	<span class="hljs-comment">/* Default value 64 */</span><br>	__le32 nat_ver_bitmap_bytesize; <span class="hljs-comment">/* Default value 256 */</span><br>	__le32 checksum_offset;		<span class="hljs-comment">/* checksum offset inside cp block */</span><br>	__le64 elapsed_time;		<span class="hljs-comment">/* mounted time */</span><br>	<span class="hljs-comment">/* allocation type of current segment */</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> alloc_type[MAX_ACTIVE_LOGS];<br><br>	<span class="hljs-comment">/* SIT and NAT version bitmap */</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> sit_nat_version_bitmap[<span class="hljs-number">1</span>];<br>&#125; __packed;<br></code></pre></td></tr></table></figure>

<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/6.png" srcset="/img/loading.gif" lazyload alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 50%;">

<blockquote>
<p>ä¸Šé¢ä¸ºHZero.chenåšå®¢ä¸­çš„æ•°æ®ï¼Œä¸‹é¢æ˜¯æˆ‘è‡ªå·±å®éªŒçš„æ•°æ®</p>
</blockquote>
<hr>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719233445458.png" srcset="/img/loading.gif" lazyload alt="image-20230719233445458" style="zoom:67%;">

<ul>
<li><p><strong>checkpoint_ver</strong>ï¼š0x69d7b561</p>
</li>
<li><p><strong>user_block_count</strong>ï¼š0x7a00(31232)ï¼Œ4096&#x2F;512&#x3D;8ä¸ªsegment,è€Œmain areaæœ‰56ä¸ªsegmentï¼Œå…¶å®ƒ48ä¸ªsegmentä¸ºoverprovision segment</p>
</li>
<li><p><strong>valid_block_count</strong>ï¼š0x56d(1389)</p>
</li>
<li><p><strong>rsvd_segment_count</strong>ï¼š0x15(31)ï¼Œä¿ç•™äº†21ä¸ªsegment</p>
</li>
<li><p><strong>overprov_segment_count</strong>ï¼š0x1f(31)</p>
</li>
<li><p><strong>free_segment_count</strong>ï¼š0x54(84)</p>
</li>
<li><p><strong>cur_node_segno</strong></p>
<ul>
<li>0x01ã€0x02</li>
</ul>
</li>
</ul>
<p>â€”-cur_node_blkoffâ€”-<br>0x00000006<br>0x0000000C<br>0x00000000</p>
<p>â€”-cur_data_segnoâ€”-<br>0x00000034<br>0x00000001<br>0x00000000|</p>
<p>â€”-cur_data_blkoffâ€”-<br>0x00000005<br>0x00000003<br>0x00000001</p>
<p>ckpt_flags:0x5</p>
<p>cp_pack_total_block_count:0x6</p>
<p>cp_pack_start_sum:0x1</p>
<p>valid_node_count:0x5</p>
<p>valid_inode_count:0x5</p>
<p>next_free_nid:0x8</p>
<p>sit_ver_bitmap_bytesize:0x40</p>
<p>nat_ver_bitmap_bytesize:0x40</p>
<p>checksum_offset:0xffc</p>
<p>elapsed_time:40</p>
<p>allocation type of current segment<br>0x00000000|0x00000000|0x00000000|0x00000000|0x00000000|0x00000000|0x00000000|<br>0x00000000|0x00000000|0x00000000|0x00000000|0x00000000|0x00000000|0x00000000|<br>0x00000000|0x00000000|</p>
<p>sit_nat_version_bitmap:0x0</p>
<p>&#x2F;&#x2F; TODO</p>
<h4 id="2-2-2-NAT-Journal"><a href="#2-2-2-NAT-Journal" class="headerlink" title="2.2.2 NAT Journal"></a>2.2.2 NAT Journal</h4><p>åœ¨f2fsä¸­å­˜åœ¨journalæœºåˆ¶ï¼Œé€šè¿‡è”åˆä½“<code>f2fs_journal</code>è¡¨ç¤ºï¼Œæ‰€ä»¥å®ƒæ—¢å¯ä»¥è¡¨ç¤ºNATï¼Œåˆå¯ä»¥è¡¨ç¤ºSIT</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_journal</span> &#123;</span><br>	<span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>		__le16 n_nats;<br>		__le16 n_sits;<br>	&#125;;<br>	<span class="hljs-comment">/* spare area is used by NAT or SIT journals or extra info */</span><br>	<span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>		<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nat_journal</span> <span class="hljs-title">nat_j</span>;</span><br>		<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sit_journal</span> <span class="hljs-title">sit_j</span>;</span><br>		<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_extra_info</span> <span class="hljs-title">info</span>;</span><br>	&#125;;<br>&#125; __packed;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œå…ˆä»¥NATä¸ºä¾‹ï¼Œå‰é¢16ä½å°ç«¯ä¸ºnatsï¼Œåé¢çš„æ˜¯nat_journalç»“æ„ä½“</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nat_journal</span> &#123;</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nat_journal_entry</span> <span class="hljs-title">entries</span>[<span class="hljs-title">NAT_JOURNAL_ENTRIES</span>];</span><br>	__u8 reserved[NAT_JOURNAL_RESERVED];<br>&#125; __packed;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nat_journal_entry</span> &#123;</span><br>	__le32 nid;<br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_nat_entry</span> <span class="hljs-title">ne</span>;</span><br>&#125; __packed;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_nat_entry</span> &#123;</span><br>	__u8 version;		<span class="hljs-comment">/* latest version of cached nat entry */</span><br>	__le32 ino;		<span class="hljs-comment">/* inode number */</span><br>	__le32 block_addr;	<span class="hljs-comment">/* block address */</span><br>&#125; __packed;<br></code></pre></td></tr></table></figure>

<p>è¯´ç™½äº†é‡Œé¢å­˜å‚¨çš„ä¹Ÿæ˜¯<strong>f2fs_nat_entry</strong></p>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719234855034.png" srcset="/img/loading.gif" lazyload alt="image-20230719234855034" style="zoom:67%;">

<p>å‰é¢2ä¸ªå­—èŠ‚0x05è¡¨ç¤ºnatsï¼Œéšåçš„4ä¸ªå­—èŠ‚0x00000003è¡¨ç¤ºçš„æ˜¯nidï¼Œåé¢å³ä½¿f2fs_nat_entryç»“æ„ä½“äº†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">00            version      0x00<br>00 00 00 03   ino          0x03(3)<br>00 00 10 04   block_addr   0x1004(4100)<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸€èˆ¬ä¼š<strong>dump.f2fs -n 0~-1 f2fs.img</strong>æŸ¥çœ‹natçš„ä¿¡æ¯ï¼Œç»“æœä¼šä¿å­˜åœ¨<code>dump_nat</code>ä¸­</p>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719235441702.png" srcset="/img/loading.gif" lazyload alt="image-20230719235441702" style="zoom:67%;">

<p>ä»¥ç¬¬ä¸€ä¸ª<strong>nid:3</strong>ä¸ºä¾‹ï¼Œä¸ä¸Šé¢çš„nat journalå®Œç¾çš„å¯¹ä¸Šäº†ï¼ŒåŒç†è¿™é‡Œé¢çš„ä¿¡æ¯éƒ½ä¸nat journalä¸€ä¸€å¯¹åº”ã€‚</p>
<h4 id="2-2-3-SIT-Journal"><a href="#2-2-3-SIT-Journal" class="headerlink" title="2.2.3 SIT Journal"></a>2.2.3 SIT Journal</h4><p>å¦‚2.2.2æ‰€è¯´ï¼Œf2fs_journalç»“æ„ä½“æ—¢èƒ½è¡¨ç¤ºnatï¼Œä¹Ÿèƒ½è¡¨ç¤ºsitã€å› ä¸ºå†…éƒ¨æˆå‘˜æ˜¯è”åˆä½“ã€‘ï¼Œé‚£ä¹ˆè¿™è¾¹åº”è¯¥è¡¨ç¤ºçš„æ˜¯sit</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sit_journal</span> &#123;</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sit_journal_entry</span> <span class="hljs-title">entries</span>[<span class="hljs-title">SIT_JOURNAL_ENTRIES</span>];</span><br>	__u8 reserved[SIT_JOURNAL_RESERVED];<br>&#125; __packed;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sit_journal_entry</span> &#123;</span><br>	__le32 segno;<br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_sit_entry</span> <span class="hljs-title">se</span>;</span><br>&#125; __packed;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_sit_entry</span> &#123;</span><br>	__le16 vblocks;				<span class="hljs-comment">/* reference above */</span><br>	__u8 valid_map[SIT_VBLOCK_MAP_SIZE];	<span class="hljs-comment">/* bitmap for valid blocks */</span><br>	__le64 mtime;				<span class="hljs-comment">/* segment age for cleaning */</span><br>&#125; __packed;<br></code></pre></td></tr></table></figure>

<p>è¯´ç™½äº†é‡Œé¢å­˜å‚¨çš„ä¹Ÿæ˜¯<strong>f2fs_sit_entry</strong></p>
<img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230719235854137.png" srcset="/img/loading.gif" lazyload alt="image-20230719235854137" style="zoom:67%;">

<h3 id="2-3-SIT"><a href="#2-3-SIT" class="headerlink" title="2.3 SIT"></a>2.3 SIT</h3><h3 id="2-4-NAT"><a href="#2-4-NAT" class="headerlink" title="2.4 NAT"></a>2.4 NAT</h3><img src="/2023/07/19/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80/image-20230723231428571.png" srcset="/img/loading.gif" lazyload alt="image-20230723231428571" style="zoom:80%;">

<p>è¿™é‡Œä¸€å¼€å§‹æˆ‘å¾ˆå¥‡æ€ªï¼Œä¸ºå•¥è¿™é‡Œåªæœ‰3ä¸ªinodeï¼Œå³node_ino:1ã€meta_ino:2ã€root_ino:3ï¼Œé‚£å…¶ä½™æ–‡ä»¶çš„inodeå»å“ªé‡Œäº†ï¼Œä¸æ˜¯è¯´NATç»´æŠ¤äº†ä¸€å¼ inode noå’Œblock addrçš„è¡¨å—ã€‚</p>
<p>è¿™é‡Œå…¶å®æ˜¯ç”±äºJournalæœºåˆ¶ï¼Œä¸ºäº†ä¸é¢‘ç¹è¯»å†™NATï¼Œæ‰€ä»¥å°†natçš„æ”¹åŠ¨å…ˆå­˜æ”¾åœ¨äº†nat journalä¸­ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆnat journalå’ŒNATåŒºåŸŸéƒ½æ˜¯æŒ‰ç…§<strong>f2fs_nat_entry</strong> æ’å¸ƒçš„</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">f2fs_nat_entry</span> &#123;</span><br>	__u8 version;		<span class="hljs-comment">/* latest version of cached nat entry */</span><br>	__le32 ino;		<span class="hljs-comment">/* inode number */</span><br>	__le32 block_addr;	<span class="hljs-comment">/* block address */</span><br>&#125; __packed;<br></code></pre></td></tr></table></figure>

<p>åªæœ‰å½“nat journalåŒºåŸŸæ’‘æ»¡äº†æ”¾ä¸ä¸‹äº†ï¼Œæ‰ä¼šåˆ·å†™åˆ°ç£ç›˜å¯¹åº”çš„NATåŒºåŸŸä¸­ã€‚</p>
<hr>
<p>æˆ‘ä»¬åšä¸ªå®éªŒï¼Œå†™ä¸€ä¸ªshellè„šæœ¬<code>f2fs.sh</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>for i in &#123;1..2000&#125;<br>do<br>fileName=&quot;hello&quot;$&#123;i&#125;<br>touch /home/amx/Desktop/f2fs/mntf2fs/$&#123;fileName&#125;.txt<br>echo &quot;hello amx&quot;$&#123;i&#125; &gt;&gt; /home/amx/Desktop/f2fs/mntf2fs/$&#123;fileName&#125;.txt<br>done<br></code></pre></td></tr></table></figure>

<blockquote>
<p>åŠŸèƒ½å°±æ˜¯åˆ›å»º2000ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºhello[i]ï¼Œå‘é‡Œé¢å†™å…¥hello amx[i]</p>
</blockquote>
<p>æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå†æ¬¡<code>hexdump -C -s 0xA00000 -n 2097152 f2fs.img</code>å°±å¯ä»¥çœ‹åˆ°NATåŒºåŸŸå·²ç»æ›´æ–°äº†ã€å¦‚æœæ²¡æ›´æ–°ï¼Œå°±æŠŠforå¾ªç¯æ¬¡æ•°æ”¾å¤§ã€‘ã€‚åç»­ç›´æ¥ <strong>rm -rf hello</strong>*åˆ æ‰è¿™äº›æ–‡ä»¶å³å¯</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</div>
      <div>http://example.com/2023/07/19/f2fsæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>OneAmx</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2023å¹´7æœˆ19æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/07/23/f2fs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FJournal%E6%9C%BA%E5%88%B6/" title="f2fsæ–‡ä»¶ç³»ç»ŸJournalæœºåˆ¶">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">f2fsæ–‡ä»¶ç³»ç»ŸJournalæœºåˆ¶</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/16/%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" title="å—è®¾å¤‡é©±åŠ¨">
                        <span class="hidden-mobile">å—è®¾å¤‡é©±åŠ¨</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
